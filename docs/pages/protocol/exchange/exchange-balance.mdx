import { Callout } from 'vocs/components'

# Exchange Balance

The Stablecoin Exchange allows you to hold token balances directly on the exchange contract. This eliminates the need for token transfers on every trade, significantly reducing gas costs for active traders and liquidity providers.

## Why Exchange Balances?

When you trade or provide liquidity on the exchange, constantly transferring tokens between your wallet and the exchange contract wastes gas. By maintaining a balance on the DEX, you can:

- **Save on gas costs** - Avoid ERC-20 transfer costs for each trade
- **Trade more efficiently** - Execute multiple swaps without transfers between each trade
- **Receive maker proceeds automatically** - When your limit orders are filled, proceeds are credited to your DEX balance instead of requiring a transfer for each fill

## Checking Your Balance

View your balance of any token held on the exchange:

```solidity
function balanceOf(
    address user,
    address token
) external view returns (uint128)
```

**Example:**
```solidity
uint128 balance = exchange.balanceOf(msg.sender, USDC_ADDRESS);
```

## Depositing to the Exchange

There is no explicit deposit function. When you execute a swap or place an order, the exchange automatically:

1. First checks if you have sufficient balance on the exchange
2. If insufficient, transfers the needed amount from your wallet to the exchange
3. Uses your exchange balance for the operation

This means depositing happens automatically as needed during trading activity.

## Withdrawing from the Exchange

Transfer tokens from your exchange balance back to your wallet:

```solidity
function withdraw(
    address token,
    uint128 amount
) external
```

**Parameters:**
- `token` - The token address to withdraw
- `amount` - The amount to withdraw

**Example:**
```solidity
// Withdraw 1000 USDC from exchange to your wallet
exchange.withdraw(USDC_ADDRESS, 1000e6);
```

<Callout type="warning">
  The withdraw function will revert if you attempt to withdraw more than your available balance on the exchange.
</Callout>

## How Balances Work

### When Swapping

- **Before swap**: Exchange checks your balance, transfers from wallet if needed
- **After swap**: Output tokens are transferred directly to your wallet (not kept on exchange)

### When Placing Orders

- **On placement**: Required tokens are debited from your exchange balance (or transferred from wallet if insufficient)
- **When filled**: Proceeds are credited to your exchange balance
- **On cancellation**: Unfilled portion is refunded to your exchange balance
