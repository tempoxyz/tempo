# `withFeePayer`

Creates a transport that routes transactions to a fee payer service when a `feePayer` is requested on an action. [Learn more about Fee Sponsorship](/documentation/protocol/transactions/spec-account-abstraction)

## Usage

:::code-group

```ts twoslash [example.ts]
// @noErrors
// [!include ~/snippets/unformatted/withFeePayer.ts:client]

// [!include ~/snippets/unformatted/withFeePayer.ts:usage]
```

```ts twoslash [viem.config.ts] filename="viem.config.ts"
// [!include ~/snippets/viem.config.ts:setup]
```

:::

### Example Fee Payer Service

Below is an end-to-end example of a client/server fee payer setup. 

See `server.ts` for the server-side implementation. It uses `Handler.feePayer` provided by `tempo.ts/server` to handle fee payer requests.

:::code-group

```ts twoslash [client.ts]
// @noErrors
// [!include ~/snippets/unformatted/withFeePayer.ts:client]

const hash = await client.sendTransactionSync({
  feePayer: true,
  to: '0x0000000000000000000000000000000000000000',
})
```

```ts twoslash [server.ts]
// @noErrors
// [!include ~/snippets/unformatted/withFeePayer.ts:server]
```

:::

## Return Type

```ts
type ReturnType = Transport<'feePayer'>
```

## Parameters

### defaultTransport

- **Type:** `Transport`

The default transport to use for regular (non-sponsored) transactions.

### relayTransport

- **Type:** `Transport`

The relay transport to use for sponsored transactions. This should point to a fee payer service that will sign and submit the transaction with a fee payer signature.

### Parameters (optional)

- **Type:** `withFeePayer.Parameters`

Options for `withFeePayer` usage.

#### `policy` (optional)

- **Type:** `'sign-only' | 'sign-and-broadcast'`
- **Default:** `'sign-only'`

Controls how the fee payer handles sponsored transactions:

- **`'sign-only'`**: Fee payer co-signs the transaction and returns it to the client transport, which then broadcasts it via the default transport.

- **`'sign-and-broadcast'`**: Fee payer co-signs and broadcasts the transaction directly. The fee payer service handles both signing and submission to the blockchain.
