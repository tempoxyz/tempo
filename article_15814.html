<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content="jokfUyyJMDiQe9I2LxlcAZg08OkWW3lVx3Ps5qJZ" />
    <title>Rust ä¼˜åŒ–æŠ€æœ¯éå®˜æ–¹æŒ‡å— | ç™»é“¾ç¤¾åŒº | åŒºå—é“¾æŠ€æœ¯ç¤¾åŒº</title>
    <meta name="keywords" content=" Rust,æ€§èƒ½ä¼˜åŒ–,é›¶æ‹·è´,å†…å­˜å¸ƒå±€,å¹¶è¡Œå¤„ç†,ç¼“å­˜, wtbt,åŒºå—é“¾æŠ€æœ¯æ–‡ç« " />
    <meta name="description" content="æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Rust è¯­è¨€åœ¨æ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿæ—¶å¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¹¶é€šè¿‡ä»¥å¤ªåŠå®¢æˆ·ç«¯ Reth çš„å®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†é›¶æ‹·è´æ“ä½œã€å†…å­˜å¸ƒå±€ä¼˜åŒ–ã€åˆ†é…æ¨¡å¼ã€å¹¶è¡Œå¤„ç†ã€ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ã€æµå¤„ç†ä¸å»¶è¿Ÿè®¡ç®—ã€æ•°æ®åº“ä¸ I/O..." />
    <meta name="google-site-verification" content="YhhQsMTTFYqo4YjHxCEf0WaDU5701Ehr3vAD1CmTH20" />

    <meta property="og:title" content="Rust ä¼˜åŒ–æŠ€æœ¯éå®˜æ–¹æŒ‡å— | ç™»é“¾ç¤¾åŒº | åŒºå—é“¾æŠ€æœ¯ç¤¾åŒº">
    <meta property="og:site_name" content="ç™»é“¾ç¤¾åŒº">
    <meta property="og:description" content="æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Rust è¯­è¨€åœ¨æ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿæ—¶å¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¹¶é€šè¿‡ä»¥å¤ªåŠå®¢æˆ·ç«¯ Reth çš„å®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†é›¶æ‹·è´æ“ä½œã€å†…å­˜å¸ƒå±€ä¼˜åŒ–ã€åˆ†é…æ¨¡å¼ã€å¹¶è¡Œå¤„ç†ã€ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ã€æµå¤„ç†ä¸å»¶è¿Ÿè®¡ç®—ã€æ•°æ®åº“ä¸ I/O...">

    <meta name="author" content="LBC Team" />
    <meta name="copyright" content="2022 learnblockchain.cn" />
    
    <!-- Bootstrap -->

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=20250704">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=20250704">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=20250704">

    <link href="https://img.learnblockchain.cn/static/css/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://learnblockchain.cn/static/css/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://learnblockchain.cn/css/default/global.css?v=20250704" rel="stylesheet" />
    <link href="https://learnblockchain.cn/css/default/skins/blue.css?v=20250704" rel="stylesheet" />
    <link href="https://learnblockchain.cn/static/js/fancybox/jquery.fancybox.min.css" rel="stylesheet">

    <link href="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/index.min.css" rel="stylesheet">
    <link href="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/custom.css" rel="stylesheet">
    <link href="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-math-ssr/index.min.css" rel="stylesheet">
    <link href="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-highlight/index.min.css" rel="stylesheet">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@NUpchain" />
    <meta name="twitter:title" content="Rust ä¼˜åŒ–æŠ€æœ¯éå®˜æ–¹æŒ‡å—" />
    <meta name="twitter:description" content="æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Rust è¯­è¨€åœ¨æ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿæ—¶å¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¹¶é€šè¿‡ä»¥å¤ªåŠå®¢æˆ·ç«¯ Reth çš„å®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†é›¶æ‹·è´æ“ä½œã€å†…å­˜å¸ƒå±€ä¼˜åŒ–ã€åˆ†é…æ¨¡å¼ã€å¹¶è¡Œå¤„ç†ã€ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ã€æµå¤„ç†ä¸å»¶è¿Ÿè®¡ç®—ã€æ•°æ®åº“ä¸ I/O ä¼˜åŒ–ã€ç¼–è¯‘æ—¶ä¼˜åŒ–ç­‰å…³é”®æŠ€æœ¯ã€‚å¼ºè°ƒåœ¨ä¼˜åŒ–å‰è¿›è¡Œæ€§èƒ½æµ‹é‡å’ŒéªŒè¯ï¼Œå¹¶åˆ†äº«äº†é¿å…è¿‡æ—©ä¼˜åŒ–å’Œè¿‡åº¦è®¾è®¡çš„ç»éªŒæ•™è®­ã€‚" />
    <meta property="og:title" content="Rust ä¼˜åŒ–æŠ€æœ¯éå®˜æ–¹æŒ‡å—">
    <meta property="og:description" content="æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Rust è¯­è¨€åœ¨æ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿæ—¶å¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¹¶é€šè¿‡ä»¥å¤ªåŠå®¢æˆ·ç«¯ Reth çš„å®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†é›¶æ‹·è´æ“ä½œã€å†…å­˜å¸ƒå±€ä¼˜åŒ–ã€åˆ†é…æ¨¡å¼ã€å¹¶è¡Œå¤„ç†ã€ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ã€æµå¤„ç†ä¸å»¶è¿Ÿè®¡ç®—ã€æ•°æ®åº“ä¸ I/O ä¼˜åŒ–ã€ç¼–è¯‘æ—¶ä¼˜åŒ–ç­‰å…³é”®æŠ€æœ¯ã€‚å¼ºè°ƒåœ¨ä¼˜åŒ–å‰è¿›è¡Œæ€§èƒ½æµ‹é‡å’ŒéªŒè¯ï¼Œå¹¶åˆ†äº«äº†é¿å…è¿‡æ—©ä¼˜åŒ–å’Œè¿‡åº¦è®¾è®¡çš„ç»éªŒæ•™è®­ã€‚">
    <meta property="og:url" content="https://learnblockchain.cn/article/15814">
    <meta name="twitter:url" content="https://learnblockchain.cn/article/15814">
            <meta name="twitter:image" content="https://img.learnblockchain.cn/attachments/2023/05/JTNDDUwL645851d6f3be3.png" />
        <meta name="og:image" content="https://img.learnblockchain.cn/attachments/2023/05/JTNDDUwL645851d6f3be3.png" />
    
    <style>
        .markdown-body img{
            display: block;
            margin: auto;
            max-width: 80%;
        }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<div class="global-nav mb-50">
    <nav style="border: none; background-color: transparent;" class="navbar navbar-inverse navbar-fixed-top">
        <div style="background-color: #0767c8;">
            <div style="height:50px; " class="container nav">
                <div class="visible-xs header-response">
                    <a href="https://learnblockchain.cn/search/show" style="display:block"><i class="fa fa-search" aria-hidden="true"></i></a>
                    <div class="m-header-logo m-header-logo-response"><h1><a href="/" style="height:34px; background-size: auto 44px;"></a></h1></div>
                                            <a href="https://learnblockchain.cn/login" class="pull-right login-btn"><i class="fa fa-user" aria-hidden="true"></i></a>
                                        <div class="bottom-nav">
                        <div class="opts">
                            <a class="opts-group " href="https://learnblockchain.cn/categories"><i class="fa fa-newspaper-o" aria-hidden="true"></i><span>æ–‡ç« </span></a>
                            <a  class="opts-group " href="https://learnblockchain.cn/videos"><i class="fa fa-play-circle " aria-hidden="true"></i><span>è§†é¢‘</span></a>
                            <a  class="opts-group " href="https://learnblockchain.cn/courses"><i class="fa fa-graduation-cap " aria-hidden="true"></i><span>è¯¾ç¨‹</span></a>
                            <a class="opts-group " href="https://learnblockchain.cn/maps/Roadmap"><i class="fa fa-sitemap" aria-hidden="true"></i><span>ç™¾ç§‘å›¾è°±</span></a>
                            <a  class="opts-group " href="https://learnblockchain.cn/openspace"><i class="fa fa-flag" aria-hidden="true"></i><span>é›†è®­è¥</span></a>
                        <div class="opts-group">
                            <div class="btn-group dropup">
                                <i class="fa fa-bars dropdown hoverDropdown" data-toggle="dropdown" aria-hidden="true" aria-expanded="false"><span>æ›´å¤š</span></i>
                                <ul class="dropdown-menu">
                                    <li><a href="https://learnblockchain.cn/questions">é—®ç­”</a></li>
                                    <li><a href="https://learnblockchain.cn/question/create">æé—®</a></li>
                                    <li><a href="https://learnblockchain.cn/article/create">å‘è¡¨æ–‡ç« </a></li>
                                    <li><a href="https://learnblockchain.cn/columns">ä¸“æ </a></li>
                                    <li><a href="https://learnblockchain.cn/activities">æ´»åŠ¨</a></li>
                                    <li><a href="https://learnblockchain.cn/manuals">æ–‡æ¡£</a></li>
                                    <li><a href="https://learnblockchain.cn/jobs">å·¥ä½œ</a></li>
                                    <li><a href="https://learnblockchain.cn/shop">é›†å¸‚</a></li>
                                    <li><a href="https://learnblockchain.cn/doings">å‘ç°</a></li>
                                    <!-- <li><a href="https://learnblockchain.cn/tags">è¯é¢˜</a></li> -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row hidden-xs">
                <div class="col-sm-8 col-md-9 col-lg-9">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#global-navbar">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <div class="logo"><a class="navbar-brand logo" href="https://learnblockchain.cn"></a></div>
                    </div>
                    <div class="collapse navbar-collapse" id="global-navbar">
                        <ul class="nav navbar-nav">
                            <li style="margin-left: 10px;" ><a href="https://learnblockchain.cn/categories">æ–‡ç« </a></li>
                            <li ><a href="https://learnblockchain.cn/questions">é—®ç­”</a></li>
                            <li ><a href="https://learnblockchain.cn/videos">è§†é¢‘</a></li>
                            <li ><a href="https://learnblockchain.cn/courses">è¯¾ç¨‹</a></li>
                            <li ><a href="https://learnblockchain.cn/openspace">é›†è®­è¥</a></li>
                            <li ><a href="https://learnblockchain.cn/columns">ä¸“æ </a></li>
                            <li ><a href="https://learnblockchain.cn/activities">æ´»åŠ¨</a></li>
                            <li ><a href="https://learnblockchain.cn/jobs">å·¥ä½œ</a></li>
                            <li ><a href="https://learnblockchain.cn/manuals">æ–‡æ¡£</a></li>
                            <li ><a href="https://learnblockchain.cn/shop">é›†å¸‚</a></li>
                            <!-- <li ><a href="https://learnblockchain.cn/article/2615"><img style="margin-top:-8px; margin-left: -26px; height: 36px"  src="/static/images/mile100.png"></img></a></li> -->
                        </ul>
                        <form role="search" id="top-search-form" action="https://learnblockchain.cn/search" method="GET" class="navbar-form hidden-sm hidden-xs pull-right" style="position: absolute;right: -35px;">
                            <span class="btn btn-link" style="top: 1px;"><span class="sr-only">æœç´¢</span><span class="glyphicon glyphicon-search"></span></span>
                            <input type="text" name="word" id="searchBox" class="form-control" placeholder="æœä¸€æœï¼Œå‘ç°æ›´å¤šç²¾å½©å†…å®¹" />
                        </form>
                </div>
                </div>
                <div class="col-sm-4 col-md-3 col-lg-3 text-right">
                                            <ul class="nav navbar-nav navbar-right">
                            <li><a href="https://learnblockchain.cn/login">ç™»å½•/æ³¨å†Œ</a></li>
                        </ul>
                                        </div>
                    </div>
            </div>
        </div>
        <!-- <div style="background-color: rgb(240,173,78,0.9);text-align: center;height: 35px;line-height: 35px;">
            <a style="color: #0c0c0c;
                    font-size: 16px;
                    text-underline-offset: 3px;
                    color: #212121;
                    letter-spacing:0.5px;
                    white-space: pre;"
                href="https://learnblockchain.cn/article/9021">   åœ¨ Gitcoin Grant ä¸ºç™»é“¾ç¤¾åŒºæèµ , æ”¯æŒç¤¾åŒºå‘å±• >>   </a>
        </div> -->
    </nav>
</div>
<div class="top-alert mt-60 clearfix text-center">
    <!--[if lt IE 9]>
    <div class="alert alert-danger topframe" role="alert">ä½ çš„æµè§ˆå™¨å®åœ¨<strong>å¤ªå¤ªå¤ªå¤ªå¤ªå¤ªæ—§äº†</strong>ï¼Œæ”¾å­¦åˆ«èµ°ï¼Œå‡çº§å®Œæµè§ˆå™¨å†è¯´
        <a target="_blank" class="alert-link" href="http://browsehappy.com">ç«‹å³å‡çº§</a>
    </div>
    <![endif]-->

    

    </div>

<div class="wrap">
            <div class="container">
            <input class="textCopyInput" id="textCopyInput" value="" />
    <div class="row mt-10">
        <div class="col-xs-12 col-md-9 main" id="article_content">
            <div class="widget-article">
                <h1 style="font-size: 24px;" class="title">Rust ä¼˜åŒ–æŠ€æœ¯éå®˜æ–¹æŒ‡å—</h1>
                
                <span  class="pull-right">
                                                        </span>

                <ul class="list-inline text-muted">
                                            <li><a href="https://learnblockchain.cn/extremelysunnyyk">Yong kang Chia</a></li>
                    
                    <li>å‘å¸ƒäº 2025-06-04 11:37</li>
                    <li>é˜…è¯» 2753</li>
                </ul>

                <div class="content mt-10">
                                            <div class="quote mb-20">
                        <p>æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Rust è¯­è¨€åœ¨æ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿæ—¶å¯åº”ç”¨çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¹¶é€šè¿‡ä»¥å¤ªåŠå®¢æˆ·ç«¯ Reth çš„å®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†é›¶æ‹·è´æ“ä½œã€å†…å­˜å¸ƒå±€ä¼˜åŒ–ã€åˆ†é…æ¨¡å¼ã€å¹¶è¡Œå¤„ç†ã€ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ã€æµå¤„ç†ä¸å»¶è¿Ÿè®¡ç®—ã€æ•°æ®åº“ä¸ I/O ä¼˜åŒ–ã€ç¼–è¯‘æ—¶ä¼˜åŒ–ç­‰å…³é”®æŠ€æœ¯ã€‚å¼ºè°ƒåœ¨ä¼˜åŒ–å‰è¿›è¡Œæ€§èƒ½æµ‹é‡å’ŒéªŒè¯ï¼Œå¹¶åˆ†äº«äº†é¿å…è¿‡æ—©ä¼˜åŒ–å’Œè¿‡åº¦è®¾è®¡çš„ç»éªŒæ•™è®­ã€‚</p>                        </div>
                                                                <textarea id="md_view_content" style="display:none;">![](https://img.learnblockchain.cn/2025/06/04/53243699_image.jpg)

Rustä¼˜åŒ–

Rustç‹¬ç‰¹çš„æ‰€æœ‰æƒæ¨¡å‹å’Œé›¶æˆæœ¬æŠ½è±¡ä½¿å…¶æˆä¸ºæ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿçš„å“è¶Šè¯­è¨€ã€‚ç„¶è€Œï¼Œå®ç°æœ€ä½³æ€§èƒ½éœ€è¦ç†è§£å’Œåº”ç”¨ç‰¹å®šçš„ä¼˜åŒ–æŠ€æœ¯ã€‚æœ¬æŒ‡å—å…¨é¢æ¢è®¨äº†æ¨åŠ¨ç”Ÿäº§ç³»ç»Ÿï¼ˆå¦‚Rethï¼ŒEthereumçš„æœ€å¿«æ‰§è¡Œå®¢æˆ·ç«¯ï¼‰çš„ä¼˜åŒ–ç­–ç•¥ã€‚

### åŸºç¡€ï¼šä¸ºä»€ä¹ˆä¼˜åŒ–å¾ˆé‡è¦

ç°ä»£åº”ç”¨ç¨‹åºï¼Œå°¤å…¶æ˜¯åœ¨åŒºå—é“¾åŸºç¡€è®¾æ–½ã€é‡‘èç³»ç»Ÿå’Œå®æ—¶å¤„ç†ç­‰é¢†åŸŸï¼Œéœ€è¦æç«¯æ€§èƒ½ã€‚ä¼˜åŒ–ä¸æœªä¼˜åŒ–çš„Ruståº”ç”¨ç¨‹åºä¹‹é—´çš„å·®å¼‚å¯èƒ½æ˜¯æ˜¾è‘—çš„â€”â€”æˆ‘ä»¬è°ˆè®ºçš„æ˜¯ååé‡æé«˜10å€ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘50%-90%ï¼Œä»¥åŠå¤„ç†æœ¬æ¥ä¸å¯èƒ½å®Œæˆçš„å·¥ä½œè´Ÿè½½çš„èƒ½åŠ›ã€‚

è¿™äº›ä¼˜åŒ–ä¸ä»…ä»…æ˜¯å­¦æœ¯ç»ƒä¹ ã€‚åœ¨Rethçš„å¼€å‘ä¸­ï¼Œç³»ç»Ÿåœ°åº”ç”¨è¿™äº›æŠ€æœ¯ä½¿åŒæ­¥é€Ÿåº¦æ¯”å…¶ä»–Ethereumå®¢æˆ·ç«¯å¿«2-5å€ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘30-50%ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†è¶…è¿‡10,000ä¸ªRPCè¯·æ±‚æ¯ç§’ã€‚

## ğŸš€ é›¶æ‹·è´æ“ä½œï¼šä½å‚æœå®

é›¶æ‹·è´æ“ä½œä»£è¡¨äº†Rustä¸­æœ€é«˜å½±å“ã€æœ€ä½åŠªåŠ›çš„ä¼˜åŒ–ä¹‹ä¸€ã€‚æ ¸å¿ƒåŸåˆ™å¾ˆç®€å•ï¼šé€šè¿‡åˆ©ç”¨Rustçš„æ‰€æœ‰æƒç³»ç»Ÿæ¥ä¼ é€’å¼•ç”¨è€Œä¸æ˜¯å¤åˆ¶æ•°æ®ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„æ•°æ®é‡å¤ã€‚

è€ƒè™‘åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶çš„æ€§èƒ½å·®å¼‚ã€‚å¤åˆ¶ä¸€ä¸ª1MBçš„å‘é‡æ¶‰åŠåˆ°åˆ†é…æ–°çš„å†…å­˜ã€å¤åˆ¶æ¯ä¸ªå­—èŠ‚ï¼Œæœ€ç»ˆé‡Šæ”¾åŸå§‹å†…å­˜â€”â€”å¯èƒ½éœ€è¦æˆåƒä¸Šä¸‡çš„CPUå‘¨æœŸå’Œç¼“å­˜å¤±æ•ˆç‡ã€‚ä¼ é€’ä¸€ä¸ªå¼•ç”¨ä»…éœ€è¦8ä¸ªå­—èŠ‚ï¼Œå‡ ä¹æ²¡æœ‰è®¡ç®—å¼€é”€ã€‚

```rust
// æ˜‚è´µï¼šå¤åˆ¶1MBçš„æ•°æ®
let large_data = vec![0u8; 1_000_000];
let processed = expensive_copy(large_data); // å¤åˆ¶æ•´ä¸ªå‘é‡
```

```rust
// é«˜æ•ˆï¼šä»…ä¼ é€’ä¸€ä¸ªå¼•ç”¨ï¼ˆ8å­—èŠ‚ï¼‰
let large_data = vec![0u8; 1_000_000];
let processed = zero_copy(&amp;large_data); // ä»…ä¼ é€’æŒ‡é’ˆ
```

çœŸæ­£çš„åŠ›é‡åœ¨äºè¿­ä»£å™¨é“¾ä¸­ï¼Œåœ¨è¿™é‡Œå¯ä»¥å®Œå…¨æ¶ˆé™¤ä¸­é—´é›†åˆï¼š

```rust
// åˆ›å»ºå¤šä¸ªä¸­é—´åˆ†é…
fn process_data_wasteful(items: Vec&lt;Item&gt;) -&gt; Vec&lt;ProcessedItem&gt; {
    let filtered: Vec&lt;Item&gt; = items.into_iter()
        .filter(|item| item.is_valid())
        .collect(); // åˆ†é…#1

    let mapped: Vec&lt;TempItem&gt; = filtered.into_iter()
        .map(|item| transform(item))
        .collect(); // åˆ†é…#2

    mapped.into_iter()
        .map(|temp| finalize(temp))
        .collect() // åˆ†é…#3
}
```

```rust
// é›¶ä¸­é—´åˆ†é…
fn process_data_efficient(items: Vec&lt;Item&gt;) -&gt; Vec&lt;ProcessedItem&gt; {
    items.into_iter()
        .filter(|item| item.is_valid())
        .map(|item| transform(item))
        .map(|temp| finalize(temp))
        .collect() // ä»…ä¸€ä¸ªåˆ†é…
}
```

æ™ºèƒ½å€Ÿç”¨æ¨¡å¼å°†æ­¤æ¦‚å¿µæ‰©å±•åˆ°APIè®¾è®¡ä¸­ã€‚è®¾è®¡è‰¯å¥½çš„å‡½æ•°åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å€Ÿç”¨æ‰€éœ€å†…å®¹å¹¶è¿”å›å¯¹ç°æœ‰æ•°æ®çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯è·å–æ‰€æœ‰æƒå¹¶å¼ºè¿«è°ƒç”¨è€…å…‹éš†æ•°æ®æˆ–å¤±å»è®¿é—®æƒï¼š

```rust
// å¼ºè¿«è°ƒç”¨è€…æ”¾å¼ƒæ‰€æœ‰æƒ
fn analyze_transactions_bad(txs: Vec&lt;Transaction&gt;) -&gt; Report {
    Report::new(txs) // è°ƒç”¨è€…å¤±å»å¯¹txsçš„è®¿é—®
}
```

```rust
// å…è®¸è°ƒç”¨è€…ä¿ç•™æ‰€æœ‰æƒ
fn analyze_transactions_good(txs: &amp;[Transaction]) -&gt; Report {
    Report::from_slice(txs) // è°ƒç”¨è€…ä»ç„¶å¯ä»¥ä½¿ç”¨txs
}

// ç”šè‡³æ›´å¥½ï¼šå°½å¯èƒ½è¿”å›å¼•ç”¨
fn find_largest_transaction(txs: &amp;[Transaction]) -&gt; Option&lt;&amp;Transaction&gt; {
    txs.iter().max_by_key(|tx| tx.value) // è¿”å›å¯¹ç°æœ‰æ•°æ®çš„å¼•ç”¨
}
```

## ğŸ§  å†…å­˜å¸ƒå±€ä¼˜åŒ–ï¼šä¸ç¡¬ä»¶ååŒå·¥ä½œ

ç°ä»£CPUå¹¶ä¸é€å­—èŠ‚åœ°è®¿é—®å†…å­˜â€”â€”å®ƒä»¬ä»¥64å­—èŠ‚çš„ç¼“å­˜è¡Œè·å–æ•°æ®ã€‚ç†è§£è¿™ä¸€ç¡¬ä»¶ç°å®èƒ½å¤Ÿé€šè¿‡ä»”ç»†çš„æ•°æ®ç»“æ„è®¾è®¡å®ç°æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚

ç³Ÿç³•çš„å†…å­˜å¸ƒå±€æµªè´¹äº†å®è´µçš„ç¼“å­˜ç©ºé—´ï¼Œå¹¶è¿«ä½¿ä¸å¿…è¦çš„å†…å­˜è®¿é—®ã€‚è€ƒè™‘ä¸€ä¸ªè·¨è¶Šå¤šä¸ªç¼“å­˜è¡Œçš„ä¸é«˜æ•ˆäº¤æ˜“ç»“æ„ï¼š

```rust
// ç³Ÿç³•çš„ç¼“å­˜å¸ƒå±€ - è·¨è¶Šå¤šä¸ªç¼“å­˜è¡Œï¼Œæµªè´¹
struct BadTransaction {
    hash: [u8; 32],        // 32å­—èŠ‚
    signature: [u8; 65],   // 65å­—èŠ‚ - è·¨è¶Šç¼“å­˜è¡Œè¾¹ç•Œ
    nonce: u64,            // 8å­—èŠ‚
    gas_limit: u64,        // 8å­—èŠ‚
}
```

```rust
// ä¼˜åŒ–å¸ƒå±€ - æŒ‰è®¿é—®æ¨¡å¼ç»„ç»‡æ•°æ®
#[repr(C)] // å¯é¢„æµ‹çš„å¸ƒå±€
struct GoodTransaction {
    // çƒ­æ•°æ®ï¼šç»å¸¸ä¸€èµ·è®¿é—®ï¼ˆ32å­—èŠ‚=åŠä¸ªç¼“å­˜è¡Œï¼‰
    nonce: u64,            // 8å­—èŠ‚
    gas_limit: u64,        // 8å­—èŠ‚
    gas_price: u64,        // 8å­—èŠ‚
    value: u64,            // 8å­—èŠ‚

    // æ¸©æš–æ•°æ®ï¼šå¶å°”è®¿é—®ï¼ˆ32å­—èŠ‚=åŠä¸ªç¼“å­˜è¡Œï¼‰
    to: [u8; 20],          // 20å­—èŠ‚
    _padding: [u8; 12],    // 12å­—èŠ‚çš„å¡«å……ä»¥å¯¹é½

    // å†·æ•°æ®ï¼šå¾ˆå°‘è®¿é—®ï¼ˆå•ç‹¬çš„ç¼“å­˜è¡Œï¼‰
    hash: [u8; 32],        // 32å­—èŠ‚
    signature: [u8; 65],   // 65å­—èŠ‚
}
```

æ•°ç»„ç»“æ„ï¼ˆSoAï¼‰æ¨¡å¼æ›´è¿›ä¸€æ­¥ï¼Œå®Œå…¨å°†çƒ­æ•°æ®å’Œå†·æ•°æ®åˆ†å¼€ï¼Œä»¥è¿›è¡Œåªéœ€ç‰¹å®šå­—æ®µçš„æ“ä½œï¼š

```rust
// ç»“æ„æ•°ç»„ - ä¸ºå•ä¸ªå­—æ®µåŠ è½½æ•´ä¸ªç»“æ„
struct AoSTransactions {
    transactions: Vec&lt;Transaction&gt;, // æ¯ä¸ªäº¤æ˜“100+å­—èŠ‚
}
```

```rust
impl AoSTransactions {
    fn sum_gas_limits(&amp;self) -&gt; u64 {
        self.transactions.iter()
            .map(|tx| tx.gas_limit) // ä¸º8å­—èŠ‚å­—æ®µåŠ è½½æ•´ä¸ª100å­—èŠ‚ç»“æ„
            .sum()
    }
}


// ç»“æ„æ•°ç»„ - é’ˆå¯¹ç‰¹å®šæ“ä½œçš„å®Œç¾ç¼“å­˜åˆ©ç”¨
struct SoATransactions {
    // çƒ­æ•°æ®èšé›†åœ¨ä¸€èµ·
    nonces: Vec&lt;u64&gt;,
    gas_limits: Vec&lt;u64&gt;,
    gas_prices: Vec&lt;u64&gt;,
    values: Vec&lt;u64&gt;,

    // å†·æ•°æ®åˆ†å¼€
    hashes: Vec&lt;[u8; 32]&gt;,
    signatures: Vec&lt;[u8; 65]&gt;,
}
impl SoATransactions {
    fn sum_gas_limits(&amp;self) -&gt; u64 {
        self.gas_limits.iter().sum() // å®Œç¾ç¼“å­˜åˆ©ç”¨ï¼šä»…åŠ è½½æ‰€éœ€æ•°æ®
    }

    fn get_transaction(&amp;self, index: usize) -&gt; Transaction {
        // å½“éœ€è¦å®Œæ•´å¯¹è±¡æ—¶é‡å»ºï¼ˆå°‘è§ï¼‰
        Transaction {
            nonce: self.nonces[index],
            gas_limit: self.gas_limits[index],
            // ... å…¶ä»–å­—æ®µ
        }
    }
}
```

ç´§å‡‘ç¼–ç ï¼Œå¼€åˆ›äºRethç­‰é¡¹ç›®ä¸­ï¼Œé€šè¿‡ä»…å­˜å‚¨å¿…è¦æ•°æ®å¹¶æŒ‰éœ€è®¡ç®—æ´¾ç”Ÿå­—æ®µï¼Œå°†å†…å­˜ä¼˜åŒ–æå‡åˆ°æè‡´ï¼š

```rust
// æ ‡å‡†ç¼–ç å­˜å‚¨æ‰€æœ‰å†…å®¹
#[derive(Serialize, Deserialize)]
struct StandardReceipt {
    transaction_hash: [u8; 32],    // 32å­—èŠ‚
    transaction_index: u64,        // 8å­—èŠ‚
    block_hash: [u8; 32],         // 32å­—èŠ‚
    block_number: u64,            // 8å­—èŠ‚
    cumulative_gas_used: u64,     // 8å­—èŠ‚
    gas_used: u64,                // 8å­—èŠ‚
    contract_address: Option&lt;[u8; 20]&gt;, // 21å­—èŠ‚
    logs_bloom: [u8; 256],        // 256å­—èŠ‚
    status: u8,                   // 1å­—èŠ‚
    // æ€»è®¡ï¼š~374å­—èŠ‚
}
```

```rust
// ç´§å‡‘ç¼–ç ä»…å­˜å‚¨å¿…è¦æ•°æ®
#[derive(reth_codec::Compact)]
struct CompactReceipt {
    cumulative_gas_used: u64,     // 8å­—èŠ‚
    gas_used: u64,                // 8å­—èŠ‚
    contract_address: Option&lt;[u8; 20]&gt;, // 0-20å­—èŠ‚
    status: u8,                   // 1å­—èŠ‚
    logs: Vec&lt;CompactLog&gt;,        // å¯å˜å¤§å°
    // æ€»è®¡ï¼š~50-100å­—èŠ‚ï¼ˆå‡å°60-75%ï¼‰

    // æ´¾ç”Ÿå­—æ®µæŒ‰éœ€è®¡ç®—ï¼š
    // - transaction_hashï¼šä»ç´¢å¼•æŸ¥æ‰¾
    // - block_hashï¼šä»åŒºå—å·æŸ¥æ‰¾
    // - logs_bloomï¼šä»æ—¥å¿—è®¡ç®—
}
```

## ğŸ“¦ åˆ†é…æ¨¡å¼ï¼šå‡å°‘å †å‹åŠ›

å†…å­˜åˆ†é…æ˜¯æ˜‚è´µçš„ã€‚æ¯æ¬¡åˆ†é…æ¶‰åŠç³»ç»Ÿè°ƒç”¨ã€å…ƒæ•°æ®æ›´æ–°ã€æ½œåœ¨çš„ç¼“å­˜æœªå‘½ä¸­ï¼Œå¹¶å¯¼è‡´éšæ—¶é—´æ¨ç§»çš„å†…å­˜ç¢ç‰‡ã€‚èªæ˜çš„åˆ†é…æ¨¡å¼å¯ä»¥æ¶ˆé™¤å¤§éƒ¨åˆ†å¼€é”€ã€‚

é¢„åˆ†é…æ˜¯æœ€ç®€å•çš„ä¼˜åŒ–â€”â€”å¦‚æœä½ å¤§æ¦‚çŸ¥é“ä½ éœ€è¦å¤šå°‘å†…å­˜ï¼Œè¯·æå‰åˆ†é…ï¼š

```rust
// å­—ç¬¦ä¸²å¢é•¿æ—¶é‡å¤åˆ†é…
fn build_response_naive(items: &amp;[Item]) -&gt; String {
    let mut result = String::new(); // ä»0å®¹é‡å¼€å§‹
    for item in items {
        result.push_str(&amp;format!(&quot;{},&quot;, item)); // å¤šæ¬¡é‡æ–°åˆ†é…
    }
    result
}
```

```rust
// é¢„åˆ†é…å¹¶ä¼°è®¡å®¹é‡
fn build_response_optimized(items: &amp;[Item]) -&gt; String {
    // ä¼°è®¡ï¼šæ¯ä¸ªé¡¹å¹³å‡10ä¸ªå­—ç¬¦+é€—å·
    let estimated_size = items.len() * 11;
    let mut result = String::with_capacity(estimated_size);

    for item in items {
        use std::fmt::Write;
        write!(result, &quot;{},&quot;, item).unwrap(); // ä¸ä¼šå†åˆ†é…
    }
    result
}
```

é«˜çº§ç³»ç»Ÿå¯ä»¥é€šè¿‡ä»å…ˆå‰çš„åˆ†é…ä¸­å­¦ä¹ ï¼Œéšç€æ—¶é—´çš„æ¨ç§»æ”¹å–„ä¼°ç®—ï¼š

```rust
struct AdaptiveStringBuilder {
    last_sizes: VecDeque&lt;usize&gt;,
    max_history: usize,
}
```

```rust
impl AdaptiveStringBuilder {
    fn build_response(&amp;mut self, items: &amp;[Item]) -&gt; String {
        // ä»å…ˆå‰çš„åˆ†é…ä¸­å­¦ä¹ 
        let avg_size = self.last_sizes.iter().sum::&lt;usize&gt;() / self.last_sizes.len().max(1);
        let estimated_size = (avg_size * items.len()).max(64);

        let mut result = String::with_capacity(estimated_size);
        for item in items {
            use std::fmt::Write;
            write!(result, &quot;{},&quot;, item).unwrap();
        }

        // è·Ÿè¸ªå®é™…å¤§å°ä»¥ä¾¿æœªæ¥ä¼°ç®—
        self.last_sizes.push_back(result.len());
        if self.last_sizes.len() &gt; self.max_history {
            self.last_sizes.pop_front();
        }

        result
    }
}
```

å¯¹è±¡æ± é€šè¿‡é‡å¤ä½¿ç”¨ç°æœ‰å®ä¾‹å®Œå…¨æ¶ˆé™¤ç»å¸¸ä½¿ç”¨å¯¹è±¡çš„åˆ†é…å¼€é”€ï¼š

```rust
struct ObjectPool&lt;T&gt; {
    objects: Mutex&lt;Vec&lt;T&gt;&gt;,
    factory: Box&lt;dyn Fn() -&gt; T + Send + Sync&gt;,
}
```

```rust
impl&lt;T&gt; ObjectPool&lt;T&gt; {
    fn get(&amp;self) -&gt; PooledObject&lt;T&gt; {
        let obj = self.objects.lock().unwrap()
            .pop()
            .unwrap_or_else(|| (self.factory)());

        PooledObject {
            object: Some(obj),
            pool: self,
        }
    }

    fn return_object(&amp;self, obj: T) {
        self.objects.lock().unwrap().push(obj);
    }
} // è‡ªåŠ¨åœ¨ä¸¢å¼ƒæ—¶è¿”å›æ± 
struct PooledObject&lt;&#039;a, T&gt; {
    object: Option&lt;T&gt;,
    pool: &amp;&#039;a ObjectPool&lt;T&gt;,
}
impl&lt;T&gt; Drop for PooledObject&lt;&#039;_, T&gt; {
    fn drop(&amp;mut self) {
        if let Some(obj) = self.object.take() {
            self.pool.return_object(obj);
        }
    }
}
```

Arenaåˆ†é…é€šè¿‡åœ¨å•ä¸ªè¿ç»­åŒºåŸŸä¸­åˆ†é…æ‰€æœ‰å¯¹è±¡å¹¶ä¸€æ¬¡æ€§é‡Šæ”¾æ‰€æœ‰å¯¹è±¡ï¼Œä¸ºå…·æœ‰å¯é¢„æµ‹ç”Ÿå‘½å‘¨æœŸçš„å·¥ä½œè´Ÿè½½æä¾›äº†æ›´æ˜¾è‘—çš„æ”¹è¿›ï¼š

```rust
use bumpalo::Bump;
```

```rust
struct RequestProcessor&lt;&#039;arena&gt; {
    arena: &amp;&#039;arena Bump,
}
impl&lt;&#039;arena&gt; RequestProcessor&lt;&#039;arena&gt; {
    fn process_request(&amp;self, data: &amp;[u8]) -&gt; &amp;&#039;arena ProcessedData {
        // æ­¤è¯·æ±‚ä¸­çš„æ‰€æœ‰åˆ†é…éƒ½ä½¿ç”¨arena
        let parsed = self.arena.alloc(parse_data(data));
        let validated = self.arena.alloc(validate(parsed));
        let result = self.arena.alloc(process(validated));

        result // åªè¦arenaå­˜åœ¨å°±å¯ä»¥ä½¿ç”¨
    }
}
fn handle_requests(requests: &amp;[Request]) {
    let arena = Bump::new();
    let processor = RequestProcessor { arena: &amp;arena };

    for request in requests {
        let result = processor.process_request(&amp;request.data);
        send_response(result);
    }

    // å½“arenaè¢«ä¸¢å¼ƒæ—¶ï¼Œæ‰€æœ‰åˆ†é…ä¸€æ¬¡æ€§é‡Šæ”¾
    // æ¯”å•ç‹¬é‡Šæ”¾è¦å¿«å¾—å¤š
}
```

## âš¡ å¹¶è¡Œå¤„ç†æ¨¡å¼ï¼šåˆ©ç”¨å¤šä¸ªæ ¸å¿ƒ

ç°ä»£ç³»ç»Ÿæœ‰å¤šä¸ªCPUæ ¸å¿ƒï¼Œæœªèƒ½æœ‰æ•ˆä½¿ç”¨å®ƒä»¬ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚Rustçš„æ‰€æœ‰æƒç³»ç»Ÿä½¿å¾—å¹¶è¡Œç¼–ç¨‹æ¯”å…¶ä»–è¯­è¨€æ›´å®‰å…¨ã€ç®€å•ã€‚

æ•°æ®å¹¶è¡Œä½¿ç”¨Rayonè‡ªåŠ¨å°†å·¥ä½œåˆ†é…åˆ°å¯ç”¨çš„CPUæ ¸å¿ƒä¸Šï¼Œå‡ ä¹åªéœ€æ›´æ”¹ä»£ç ï¼š

```rust
use rayon::prelude::*;
```

```rust
// å¹¶è¡Œè¿­ä»£å™¨å¤„ç†
fn recover_senders(transactions: &amp;[Transaction]) -&gt; Vec&lt;Address&gt; {
    transactions
        .par_iter() // è‡ªåŠ¨å°†å·¥ä½œåˆ†å‰²åˆ°CPUæ ¸å¿ƒä¸Š
        .map(|tx| {
            // CPUå¯†é›†å‹ECDSAç­¾åæ¢å¤
            recover_signer(tx.signature_hash(), &amp;tx.signature)
        })
        .collect()
}

// å¹¶è¡Œæ‰¹å¤„ç†ï¼Œé‡‡ç”¨æœ€ä½³å—å¤§å°
fn parallel_validation(blocks: &amp;[Block]) -&gt; Result&lt;Vec&lt;ValidationResult&gt;, Error&gt; {
    blocks
        .par_chunks(optimal_chunk_size(blocks.len()))
        .map(|chunk| validate_block_batch(chunk))
        .collect::&lt;Result&lt;Vec&lt;_&gt;, _&gt;&gt;()
        .map(|results| results.into_iter().flatten().collect())
}
fn optimal_chunk_size(total_items: usize) -&gt; usize {
    let num_cpus = rayon::current_num_threads();
    (total_items / num_cpus).max(1).min(1000) // æ¯ä¸ªå—1åˆ°1000é¡¹
}
```

ä½¿ç”¨Tokioçš„ä»»åŠ¡å¹¶è¡Œæ€§æ”¯æŒå¹¶å‘I/Oæ“ä½œå’Œå¤æ‚çš„å¤„ç†ç®¡é“ï¼š

```rust
use tokio::task::JoinSet;
```

```rust
// åŠ¨æ€è´Ÿè½½çš„å·¥ä½œçªƒå–
async fn parallel_state_queries(addresses: Vec&lt;Address&gt;) -&gt; Result&lt;Vec&lt;Account&gt;, Error&gt; {
    let mut set = JoinSet::new();

    // ç”Ÿæˆå¯ä»¥è¢«é—²ç½®çº¿ç¨‹çªƒå–çš„ä»»åŠ¡
    for addr in addresses {
        set.spawn(async move {
            provider.get_account(addr).await
        });
    }

    let mut results = Vec::new();
    while let Some(result) = set.join_next().await {
        results.push(result??);
    }

    Ok(results)
}

// æµæ°´çº¿å¹¶è¡Œå¤„ç†
async fn parallel_pipeline(input: Vec&lt;RawData&gt;) -&gt; Result&lt;Vec&lt;ProcessedData&gt;, Error&gt; {
    let (tx1, mut rx1) = tokio::sync::mpsc::channel(100);
    let (tx2, mut rx2) = tokio::sync::mpsc::channel(100);

    // é˜¶æ®µ1ï¼šè§£ææ•°æ®
    let parse_handle = tokio::spawn(async move {
        for data in input {
            let parsed = parse(data).await?;
            tx1.send(parsed).await.map_err(|_| Error::ChannelClosed)?;
        }
        Ok::&lt;_, Error&gt;(())
    });

    // é˜¶æ®µ2ï¼šéªŒè¯æ•°æ®
    let validate_handle = tokio::spawn(async move {
        while let Some(parsed) = rx1.recv().await {
            let validated = validate(parsed).await?;
            tx2.send(validated).await.map_err(|_| Error::ChannelClosed)?;
        }
        Ok::&lt;_, Error&gt;(())
    });

    // é˜¶æ®µ3ï¼šæ”¶é›†ç»“æœ
    let mut results = Vec::new();
    while let Some(validated) = rx2.recv().await {
        results.push(validated);
    }

    parse_handle.await??;
    validate_handle.await??;

    Ok(results)
}
```

æ— é”ç¼–ç¨‹æ¶ˆé™¤äº†æœ€é«˜æ€§èƒ½åœºæ™¯çš„äº‰ç”¨ï¼š

```rust
use std::sync::atomic::{AtomicU64, Ordering};
use crossbeam::queue::SegQueue;
```

```rust
// æ— é”è®¡æ•°å™¨
struct LockFreeCounter {
    value: AtomicU64,
}
impl LockFreeCounter {
    fn increment(&amp;self) -&gt; u64 {
        self.value.fetch_add(1, Ordering::Relaxed)
    }

    fn get(&amp;self) -&gt; u64 {
        self.value.load(Ordering::Relaxed)
    }
}

// æ— é”é˜Ÿåˆ—ï¼Œé«˜ååé‡åœºæ™¯
struct HighThroughputProcessor {
    input_queue: SegQueue&lt;Task&gt;,
    output_queue: SegQueue&lt;Result&gt;,
}
impl HighThroughputProcessor {
    async fn process_continuously(&amp;self) {
        loop {
            if let Some(task) = self.input_queue.pop() {
                let result = self.process_task(task).await;
                self.output_queue.push(result);
            } else {
                tokio::task::yield_now().await;
            }
        }
    }
}
```

## ğŸ—„ï¸ ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ï¼šä¸å†…å­˜å±‚çº§ååŒå·¥ä½œ

ç†è§£CPUç¼“å­˜å±‚çº§å¯¹äºå®ç°æœ€å¤§æ€§èƒ½è‡³å…³é‡è¦ã€‚L1ç¼“å­˜åœ¨1-2ä¸ªå‘¨æœŸå†…æä¾›æ•°æ®ï¼Œè€Œä¸»å†…å­˜éœ€è¦200-300ä¸ªå‘¨æœŸâ€”â€”å·®å¼‚è¾¾åˆ°100å€ã€‚

ç¼“å­˜æ„è¯†è®¾è®¡å…±åŒå®šä½ä¸€èµ·è®¿é—®çš„é¢‘ç¹æ•°æ®ï¼Œå¹¶åˆ†å¼€å†·çƒ­æ•°æ®è·¯å¾„ï¼š

```rust
// ä¸å‹å¥½çš„ç¼“å­˜ï¼šæ•£å¸ƒåœ¨å¤šä¸ªåˆ†é…ä¸­
struct ScatteredData {
    metadata: Box&lt;Metadata&gt;,     // å•ç‹¬åˆ†é…
    payload: Vec&lt;u8&gt;,           // å•ç‹¬åˆ†é…
    timestamps: Vec&lt;u64&gt;,       // å•ç‹¬åˆ†é…
}
```

```rust
// å‹å¥½çš„ç¼“å­˜ï¼šåœ¨å•ä¸ªåˆ†é…ä¸­å…±åŒå®šä½çš„æ•°æ®
struct ColocatedData {
    // ç»å¸¸ä¸€èµ·åœ¨åŒä¸€ç¼“å­˜è¡Œä¸­è®¿é—®
    metadata: Metadata,         // å†…è”
    payload_len: u32,          // å†…è”
    timestamp_count: u32,      // å†…è”

    // å¯å˜å¤§å°çš„æ•°æ®æœ‰æ•ˆæ‰“åŒ…
    data: Vec&lt;u8&gt;,             // payload + timestampsä¸€èµ·
}
impl ColocatedData {
    fn payload(&amp;self) -&gt; &amp;[u8] {
        &amp;self.data[..self.payload_len as usize]
    }

    fn timestamps(&amp;self) -&gt; &amp;[u64] {
        let start = self.payload_len as usize;
        let timestamp_bytes = &amp;self.data[start..];
        unsafe {
            std::slice::from_raw_parts(
                timestamp_bytes.as_ptr() as *const u64,
                self.timestamp_count as usize
            )
        }
    }
}
```

å¹¶å‘æ•°æ®ç»“æ„æ¶ˆé™¤äº†é”å®šå¼€é”€ï¼ŒåŒæ—¶ä¿æŒå®‰å…¨æ€§ï¼š

```rust
use dashmap::DashMap;
```

```rust
// æ— é”å¹¶å‘å“ˆå¸Œåœ°å›¾
struct ConcurrentCache {
    cache: DashMap&lt;H256, Account&gt;,
    stats: AtomicU64,
}
impl ConcurrentCache {
    fn get(&amp;self, key: &amp;H256) -&gt; Option&lt;Account&gt; {
        let result = self.cache.get(key).map(|entry| entry.clone());

        if result.is_some() {
            self.stats.fetch_add(1, Ordering::Relaxed);
        }

        result
    }

    fn insert(&amp;self, key: H256, value: Account) {
        self.cache.insert(key, value);
    }

    // æ— éœ€é”å®š - å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–/å†™å…¥
}
```

NUMA-awareè®¾è®¡é˜²æ­¢CPUæ ¸å¿ƒä¹‹é—´çš„è™šå‡å…±äº«ï¼š

```rust
use crossbeam::utils::CachePadded;
```

```rust
struct NumaAwareCounter {
    // é˜²æ­¢CPUæ ¸å¿ƒä¹‹é—´çš„è™šå‡å…±äº«
    counters: Vec&lt;CachePadded&lt;AtomicU64&gt;&gt;,
}
impl NumaAwareCounter {
    fn new() -&gt; Self {
        let num_cpus = num_cpus::get();
        let counters = (0..num_cpus)
            .map(|_| CachePadded::new(AtomicU64::new(0)))
            .collect();

        Self { counters }
    }

    fn increment(&amp;self) {
        let cpu_id = get_current_cpu_id() % self.counters.len();
        self.counters[cpu_id].fetch_add(1, Ordering::Relaxed);
    }

    fn total(&amp;self) -&gt; u64 {
        self.counters.iter()
            .map(|counter| counter.load(Ordering::Relaxed))
            .sum()
    }
}
```

## ğŸŒŠ æµåª’ä½“å’Œæƒ°æ€§è¯„ä¼°ï¼šæ— æé™åˆ¶çš„å¤„ç†

åœ¨å¤„ç†ä¸é€‚åˆå†…å­˜çš„å¤§å‹æ•°æ®é›†æ—¶ï¼Œæµåª’ä½“å’Œæƒ°æ€§è¯„ä¼°å˜å¾—è‡³å…³é‡è¦ã€‚è¿™äº›æŠ€æœ¯å…è®¸å¤„ç†ä»»æ„å¤§å°çš„æ•°æ®ï¼ŒåŒæ—¶ä¿æŒæœ‰é™çš„å†…å­˜ä½¿ç”¨ã€‚

æµå¤„ç†å¤§å‹æ•°æ®é›†å¯ä»¥é˜²æ­¢å†…å­˜è€—å°½ï¼š

```rust
use futures::stream::{Stream, StreamExt};
```

```rust
// å°†æ‰€æœ‰å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ - å¤§å‹æ•°æ®é›†æ—¶å±é™©
async fn process_all_transactions() -&gt; Result&lt;Vec&lt;ProcessedTx&gt;, Error&gt; {
    let all_txs = database.load_all_transactions().await?; // å¯èƒ½ä¸ºGB
    let processed = all_txs.into_iter()
        .map(|tx| process_transaction(tx))
        .collect();
    Ok(processed)
}

// ä½¿ç”¨æœ‰é™å†…å­˜çš„æµå¤„ç†
async fn stream_process_transactions() -&gt; impl Stream&lt;Item = Result&lt;ProcessedTx, Error&gt;&gt; {
    database
        .transaction_stream() // æ¯æ¬¡äº§å‡ºä¸€ä¸ªäº¤æ˜“
        .buffer_unordered(100) // æœ€å¤šå¹¶å‘å¤„ç†100ä¸ª
        .map(|tx| async move {
            match tx {
                Ok(transaction) =&gt; Ok(process_transaction(transaction).await),
                Err(e) =&gt; Err(e),
            }
        })
        .buffered(50) // é™åˆ¶å¹¶å‘å¤„ç†
}
```

èƒŒå‹å¤„ç†é˜²æ­¢ä¸‹æ¸¸ç³»ç»Ÿè¢«æ·¹æ²¡ï¼š

```rust
async fn controlled_stream_processing() {
    let mut stream = stream_process_transactions();
    let mut processed_count = 0;

    while let Some(result) = stream.next().await {
        match result {
            Ok(processed_tx) =&gt; {
                send_to_output(processed_tx).await;
                processed_count += 1;

                // å¦‚æœè¾“å‡ºç¼“æ…¢ï¼Œåˆ™æ–½åŠ èƒŒå‹
                if processed_count % 1000 == 0 {
                    tokio::time::sleep(Duration::from_millis(10)).await;
                }
            }
            Err(e) =&gt; log::error!(&quot;Processing error: {}&quot;, e),
        }
    }
}
```

æƒ°æ€§è¯„ä¼°ä¸è®°å¿†åŒ–ä¼šè®¡ç®—ä»…åœ¨éœ€è¦æ—¶çš„æ˜‚è´µå€¼å¹¶ç¼“å­˜ç»“æœï¼š

```rust
struct LazyField&lt;T, F&gt; {
    value: std::cell::OnceCell&lt;T&gt;,
    compute: F,
}
```

```rust
impl&lt;T, F&gt; LazyField&lt;T, F&gt;
where
    F: FnOnce() -&gt; T,
{
    fn new(compute: F) -&gt; Self {
        Self {
            value: std::cell::OnceCell::new(),
            compute,
        }
    }

    fn get(&amp;self) -&gt; &amp;T {
        self.value.get_or_init(|| (self.compute)())
    }
}

// æƒ°æ€§äº¤æ˜“å­—æ®µæŒ‰éœ€è®¡ç®—
struct LazyTransaction {
    hash: H256,
    raw_data: Vec&lt;u8&gt;,

    // æƒ©ç½šè®¡ç®—å»¶è¿Ÿåˆ°éœ€è¦æ—¶
    sender: LazyField&lt;Address, Box&lt;dyn FnOnce() -&gt; Address&gt;&gt;,
    gas_used: LazyField&lt;u64, Box&lt;dyn FnOnce() -&gt; u64&gt;&gt;,
}
impl LazyTransaction {
    fn new(hash: H256, raw_data: Vec&lt;u8&gt;) -&gt; Self {
        let raw_data_clone = raw_data.clone();
        let raw_data_clone2 = raw_data.clone();

        Self {
            hash,
            raw_data,
            sender: LazyField::new(Box::new(move || {
                recover_sender_from_raw(&amp;raw_data_clone) // æ˜‚è´µçš„ECDSAæ¢å¤
            })),
            gas_used: LazyField::new(Box::new(move || {
                calculate_gas_used(&amp;raw_data_clone2) // æ˜‚è´µçš„Gasè®¡ç®—
            })),
        }
    }

    fn sender(&amp;self) -&gt; &amp;Address {
        self.sender.get() // è®¡ç®—ä¸€æ¬¡ï¼Œæ°¸ä¹…ç¼“å­˜
    }
}
```

## ğŸ’¾ æ•°æ®åº“å’ŒI/Oä¼˜åŒ–ï¼šæœ€å°åŒ–ç³»ç»Ÿç“¶é¢ˆ

æ•°æ®åº“æ“ä½œå’Œæ–‡ä»¶I/Oé€šå¸¸ä»£è¡¨åº”ç”¨ç¨‹åºä¸­æœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆã€‚ä¼˜åŒ–è¿™äº›æ“ä½œå¯ä»¥å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚

æ‰¹é‡æ“ä½œå‡å°‘äº†å•ä¸ªæ•°æ®åº“è°ƒç”¨çš„å¼€é”€ï¼š

```rust
// å•ä¸ªæ“ä½œ - æ¯ä¸ªäº¤æ˜“è¿›è¡Œä¸€æ¬¡ç£ç›˜å†™å…¥
async fn save_transactions_slow(txs: &amp;[Transaction]) -&gt; Result&lt;(), Error&gt; {
    for tx in txs {
        database.insert_transaction(tx).await?; // æ¯æ¬¡æ’å…¥ = 1æ¬¡ç£ç›˜å†™å…¥
    }
    Ok(())
}
```

```rust
// æ‰¹é‡æ“ä½œ - æ•´ä¸ªæ‰¹æ¬¡è¿›è¡Œä¸€æ¬¡ç£ç›˜å†™å…¥
async fn save_transactions_fast(txs: &amp;[Transaction]) -&gt; Result&lt;(), Error&gt; {
    let mut batch = database.begin_batch();

    for tx in txs {
        batch.insert_transaction(tx)?; // å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­
    }

    batch.commit().await?; // å•æ¬¡ç£ç›˜å†™å…¥
    Ok(())
}
```

è‡ªé€‚åº”æ‰¹å¤„ç†åœ¨å»¶è¿Ÿå’Œååé‡ä¹‹é—´åŠ¨æ€å¹³è¡¡ï¼š

```rust
struct AdaptiveBatcher {
    pending: Vec&lt;Transaction&gt;,
    max_batch_size: usize,
    max_wait_time: Duration,
    last_flush: Instant,
}
```

```rust
impl AdaptiveBatcher {
    async fn add_transaction(&amp;mut self, tx: Transaction) -&gt; Result&lt;(), Error&gt; {
        self.pending.push(tx);

        let should_flush = self.pending.len() &gt;= self.max_batch_size
            || self.last_flush.elapsed() &gt;= self.max_wait_time;

        if should_flush {
            self.flush().await?;
        }

        Ok(())
    }

    async fn flush(&amp;mut self) -&gt; Result&lt;(), Error&gt; {
        if !self.pending.is_empty() {
            database.batch_insert(&amp;self.pending).await?;
            self.pending.clear();
            self.last_flush = Instant::now();
        }
        Ok(())
    }
}
```

é€‚å½“çš„ç¼“å†²æ¶ˆé™¤è¿‡å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼š

```rust
use tokio::io::{AsyncReadExt, AsyncWriteExt, BufReader, BufWriter};
```

```rust
// æ— ç¼“å†²I/O - æ¯ä¸ªå­—èŠ‚è¿›è¡Œä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨
async fn copy_file_slow(src: &amp;Path, dst: &amp;Path) -&gt; Result&lt;(), Error&gt; {
    let mut src_file = tokio::fs::File::open(src).await?;
    let mut dst_file = tokio::fs::File::create(dst).await?;

    let mut buffer = [0u8; 1]; // æ¯æ¬¡1å­—èŠ‚!
    while src_file.read(&amp;mut buffer).await? &gt; 0 {
        dst_file.write_all(&amp;buffer).await?;
    }

    Ok(())
}

// é€‚å½“çš„ç¼“å†²I/O - é«˜æ•ˆçš„ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨
async fn copy_file_fast(src: &amp;Path, dst: &amp;Path) -&gt; Result&lt;(), Error&gt; {
    let src_file = tokio::fs::File::open(src).await?;
    let dst_file = tokio::fs::File::create(dst).await?;

    let mut reader = BufReader::with_capacity(64 * 1024, src_file);
    let mut writer = BufWriter::with_capacity(64 * 1024, dst_file);

    tokio::io::copy(&amp;mut reader, &amp;mut writer).await?;
    writer.flush().await?;

    Ok(())
}
```

å†…å­˜æ˜ å°„æ–‡ä»¶æä¾›å¯¹å¤§å‹åªè¯»æ•°æ®é›†çš„é›¶æ‹·è´è®¿é—®ï¼š

```rust
use memmap2::Mmap;
```

```rust
struct MmapDatabase {
    mmap: Mmap,
    index: HashMap&lt;u64, usize&gt;, // block_number -&gt; offset
}
impl MmapDatabase {
    fn new(path: &amp;Path) -&gt; Result&lt;Self, Error&gt; {
        let file = std::fs::File::open(path)?;
        let mmap = unsafe { Mmap::map(&amp;file)? };

        let index = Self::build_index(&amp;mmap)?;

        Ok(Self { mmap, index })
    }

    fn get_block(&amp;self, block_number: u64) -&gt; Option&lt;&amp;[u8]&gt; {
        let offset = *self.index.get(&amp;block_number)?;
        let length = u32::from_le_bytes([
            self.mmap[offset],
            self.mmap[offset + 1],
            self.mmap[offset + 2],
            self.mmap[offset + 3],
        ]) as usize;

        Some(&amp;self.mmap[offset + 4..offset + 4 + length]) // é›¶æ‹·è´è¯»å–
    }
}
```

è¿æ¥æ± æœ‰æ•ˆåœ°ç®¡ç†æ•°æ®åº“èµ„æºï¼š

```rust
use deadpool_postgres::{Config, Pool};
```

```rust
struct DatabaseManager {
    pool: Pool,
}
impl DatabaseManager {
    async fn new(database_url: &amp;str) -&gt; Result&lt;Self, Error&gt; {
        let mut cfg = Config::new();
        cfg.url = Some(database_url.to_string());
        cfg.pool = Some(deadpool_postgres::PoolConfig {
            max_size: 20,           // æœ€å¤š20ä¸ªè¿æ¥
            timeouts: deadpool_postgres::Timeouts {
                wait: Some(Duration::from_secs(5)),
                create: Some(Duration::from_secs(5)),
                recycle: Some(Duration::from_secs(5)),
            },
        });

        let pool = cfg.create_pool(Some(Runtime::Tokio1), tokio_postgres::NoTls)?;

        Ok(Self { pool })
    }

    async fn execute_query(&amp;self, query: &amp;str) -&gt; Result&lt;Vec&lt;Row&gt;, Error&gt; {
        let client = self.pool.get().await?; // ä»æ± ä¸­è·å–è¿æ¥
        let rows = client.query(query, &amp;[]).await?;
        Ok(rows) // è¿æ¥è‡ªåŠ¨è¿”å›æ± 
    }
}
```

## ğŸ“Š æ€§èƒ½åˆ†æå’ŒåŸºå‡†æµ‹è¯•ï¼šæµ‹é‡é‡è¦çš„å†…å®¹

æ²¡æœ‰æµ‹é‡çš„ä¼˜åŒ–åªæ˜¯çŒœæµ‹ã€‚ç³»ç»Ÿæ€§çš„æ€§èƒ½åˆ†æå’ŒåŸºå‡†æµ‹è¯•æä¾›äº†åšå‡ºæ˜æ™ºä¼˜åŒ–å†³ç­–æ‰€éœ€çš„æ•°æ®ã€‚

ä½¿ç”¨Criterionè¿›è¡Œå¾®åŸºå‡†æµ‹è¯•èƒ½å®ç°ç²¾ç¡®çš„æ€§èƒ½æµ‹é‡ï¼š

```rust
use criterion::{black_box, criterion_group, criterion_main, Criterion, BenchmarkId};
```

```rust
fn benchmark_signature_recovery(c: &amp;mut Criterion) {
    let mut group = c.benchmark_group(&quot;signature_recovery&quot;);

    // æµ‹è¯•ä¸åŒè¾“å…¥å¤§å°
    for size in [100, 1000, 10000].iter() {
        let transactions = create_test_transactions(*size);

        group.bench_with_input(
            BenchmarkId::new(&quot;sequential&quot;, size),
            &amp;transactions,
            |b, txs| {
                b.iter(|| {
                    for tx in txs {
                        black_box(recover_signer(
                            black_box(tx.signature_hash()),
                            black_box(&amp;tx.signature)
                        ));
                    }
                })
            }
        );

        group.bench_with_input(
            BenchmarkId::new(&quot;parallel&quot;, size),
            &amp;transactions,
            |b, txs| {
                b.iter(|| {
                    black_box(txs.par_iter().map(|tx| {
                        recover_signer(tx.signature_hash(), &amp;tx.signature)
                    }).collect::&lt;Vec&lt;_&gt;&gt;())
                })
            }
        );
    }

    group.finish();
}
```

è¿è¡Œæ—¶æ€§èƒ½åˆ†æä¸ç»“æ„åŒ–æ—¥å¿—ä¸€èµ·æ­ç¤ºäº†ç”Ÿäº§ä¸­çš„æ€§èƒ½ç“¶é¢ˆï¼š

```rust
use tracing::{instrument, info_span, info};
```

```rust
// è‡ªåŠ¨å‡½æ•°è®¡æ—¶å’Œç»“æ„åŒ–æ—¥å¿—è®°å½•
#[instrument(skip(transactions), fields(tx_count = transactions.len()))]
async fn process_block(transactions: &amp;[Transaction]) -&gt; Result&lt;Vec&lt;Receipt&gt;, Error&gt; {
    info!(&quot;Starting block processing&quot;);

    let receipts = {
        let _span = info_span!(&quot;signature_recovery&quot;).entered();
        recover_all_senders(transactions).await?
    };

    let validated = {
        let _span = info_span!(&quot;validation&quot;).entered();
        validate_transactions(&amp;receipts).await?
    };

    info!(&quot;Block processing completed successfully&quot;);
    Ok(validated)
}
```

è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†å¯ä»¥è·Ÿè¸ªæ€§èƒ½å˜åŒ–ï¼š

```rust
use std::sync::atomic::{AtomicU64, Ordering};
```

```rust
static PROCESSED_TRANSACTIONS: AtomicU64 = AtomicU64::new(0);
static PROCESSING_TIME_NANOS: AtomicU64 = AtomicU64::new(0);
#[instrument]
async fn process_transaction(tx: &amp;Transaction) -&gt; Result&lt;Receipt, Error&gt; {
    let start = std::time::Instant::now();

    let result = execute_transaction(tx).await;

    let elapsed = start.elapsed();
    PROCESSED_TRANSACTIONS.fetch_add(1, Ordering::Relaxed);
    PROCESSING_TIME_NANOS.fetch_add(elapsed.as_nanos() as u64, Ordering::Relaxed);

    if PROCESSED_TRANSACTIONS.load(Ordering::Relaxed) % 1000 == 0 {
        let total_processed = PROCESSED_TRANSACTIONS.load(Ordering::Relaxed);
        let total_time = PROCESSING_TIME_NANOS.load(Ordering::Relaxed);

        info!(&quot;Performance: {} tx/s, avg {} Î¼s/tx&quot;,
              total_processed * 1_000_000_000 / total_time,
              (total_time / total_processed) / 1000);
    }

    result
}
```

## âš™ï¸ ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šåˆ©ç”¨Rustçš„ç±»å‹ç³»ç»Ÿ

Rustå¼ºå¤§çš„ç¼–è¯‘æ—¶èƒ½åŠ›å®ç°åœ¨è¿è¡Œæ—¶å®Œå…¨æ¶ˆé™¤å¼€é”€çš„ä¼˜åŒ–ã€‚è¿™äº›æŠ€æœ¯å°†è®¡ç®—å’Œå®‰å…¨æ£€æŸ¥ä»è¿è¡Œæ—¶è½¬ç§»åˆ°äº†ç¼–è¯‘æ—¶ã€‚

å¸¸é‡æ³›å‹æä¾›äº†é›¶æˆæœ¬æŠ½è±¡ï¼Œç”¨äºæ•°ç»„å¤§å°å’Œå…¶ä»–ç¼–è¯‘æ—¶å¸¸é‡ï¼š

```rust
// ç¼–è¯‘æ—¶æ•°ç»„å¤§å°æ¶ˆé™¤èŒƒå›´æ£€æŸ¥
struct FixedRingBuffer&lt;T, const N: usize&gt; {
    data: [Option&lt;T&gt;; N],
    head: usize,
    tail: usize,
}
```

```rust
impl&lt;T, const N: usize&gt; FixedRingBuffer&lt;T, N&gt; {
    const fn new() -&gt; Self {
        Self {
            data: [const { None }; N], // å¸¸é‡é‡å¤
            head: 0,
            tail: 0,
        }
    }

    const fn capacity(&amp;self) -&gt; usize {
        N // ç¼–è¯‘æ—¶å·²çŸ¥ï¼Œæ— è¿è¡Œæ—¶æˆæœ¬
    }

    fn push(&amp;mut self, item: T) -&gt; Result&lt;(), T&gt; {
        if self.is_full() {
            Err(item)
        } else {
            self.data[self.tail] = Some(item);
            self.tail = (self.tail + 1) % N; // æ¨¡è¿ç®—ç”±ç¼–è¯‘å™¨ä¼˜åŒ–
            Ok(())
        }
    }
}

// ä¸åŒå¤§å°çš„ç¼“å†²åŒºä¸ºä¸åŒç±»å‹
type SmallBuffer&lt;T&gt; = FixedRingBuffer&lt;T, 16&gt;;
type LargeBuffer&lt;T&gt; = FixedRingBuffer&lt;T, 1024&gt;;
```

ç¼–è¯‘æ—¶è®¡ç®—æ¶ˆé™¤è¿è¡Œæ—¶è®¡ç®—ï¼š

```rust
const fn compute_optimal_batch_size(max_memory: usize, item_size: usize) -&gt; usize {
    let max_items = max_memory / item_size;
    next_power_of_two(max_items.min(1024))
}
```

```rust
const fn next_power_of_two(n: usize) -&gt; usize {
    if n &lt;= 1 {
        1
    } else {
        1 &lt;&lt; (usize::BITS - (n - 1).leading_zeros())
    }
}
```

// åœ¨ç¼–è¯‘æ—¶è®¡ç®—
const OPTIMAL_BATCH_SIZE: usize = compute_optimal_batch_size(64 * 1024, 128);
```

ç±»å‹çº§ç¼–ç¨‹åœ¨ç¼–è¯‘æ—¶å¼ºåˆ¶çº¦æŸï¼š

```rust
use std::marker::PhantomData;
```

```rust
// ç¼–è¯‘æ—¶çŠ¶æ€è·Ÿè¸ª
trait TransactionState {}
struct Unvalidated;
struct Validated;
struct Executed;
impl TransactionState for Unvalidated {}
impl TransactionState for Validated {}
impl TransactionState for Executed {}
struct Transaction&lt;State: TransactionState&gt; {
    data: TransactionData,
    _state: PhantomData&lt;State&gt;,
}
impl Transaction&lt;Unvalidated&gt; {
    fn new(data: TransactionData) -&gt; Self {
        Self {
            data,
            _state: PhantomData,
        }
    }

    fn validate(self) -&gt; Result&lt;Transaction&lt;Validated&gt;, ValidationError&gt; {
        if self.data.is_valid() {
            Ok(Transaction {
                data: self.data,
                _state: PhantomData,
            })
        } else {
            Err(ValidationError::Invalid)
        }
    }
}
impl Transaction&lt;Validated&gt; {
    fn execute(self) -&gt; Result&lt;(Transaction&lt;Executed&gt;, Receipt), ExecutionError&gt; {
        let receipt = execute_transaction(&amp;self.data)?;

        Ok((
            Transaction {
                data: self.data,
                _state: PhantomData,
            },
            receipt,
        ))
    }
}

// ç¼–è¯‘æ—¶å¼ºåˆ¶æ‰§è¡Œé˜²æ­¢é”™è¯¯ä½¿ç”¨
fn process_transaction(tx: Transaction&lt;Unvalidated&gt;) -&gt; Result&lt;Receipt, ProcessingError&gt; {
    let validated_tx = tx.validate()?; // å¿…é¡»å…ˆéªŒè¯
    let (executed_tx, receipt) = validated_tx.execute()?; // ç„¶åæ‰§è¡Œ

    // ä¸èƒ½æ„å¤–ä½¿ç”¨æœªéªŒè¯äº¤æ˜“è¿›è¡Œæ‰§è¡Œ
    // let receipt = tx.execute(); // âŒ ç¼–è¯‘é”™è¯¯!
    
    Ok(receipt)
}
```

## ğŸ¯ æˆ˜ç•¥åº”ç”¨ï¼šä½•æ—¶ä»¥åŠå¦‚ä½•ä¼˜åŒ–

å¹¶éæ‰€æœ‰ä¼˜åŒ–éƒ½æä¾›ç›¸ç­‰çš„ä»·å€¼ã€‚ç†è§£ä½•æ—¶ä»¥åŠå¦‚ä½•åº”ç”¨æ¯ç§æŠ€æœ¯å¯ä»¥æœ€å¤§åŒ–å½±å“ï¼ŒåŒæ—¶æœ€å°åŒ–å¼€å‘å·¥ä½œã€‚

## æ€§èƒ½å½±å“çŸ©é˜µ

æœ€æœ‰æ•ˆçš„ä¼˜åŒ–ç»“åˆäº†é«˜æ€§èƒ½å½±å“å’Œä½å®ç°åŠªåŠ›ï¼š

**é«˜å½±å“ï¼Œä½åŠªåŠ›ï¼ˆä»è¿™é‡Œå¼€å§‹ï¼‰ï¼š**

- é›¶æ‹·è´æ“ä½œï¼šç”¨å¼•ç”¨æ›¿æ¢æ‹¥æœ‰çš„å€¼
- é¢„åˆ†é…ï¼šå¯¹å·²çŸ¥å¤§å°ä½¿ç”¨`with_capacity()`
- æ‰¹å¤„ç†æ“ä½œï¼šå°†æ•°æ®åº“å’ŒI/Oæ“ä½œåˆ†ç»„
- åŸºæœ¬æ€§èƒ½åˆ†æï¼šä¸ºå…³é”®å‡½æ•°æ·»åŠ æ’è£…

**é«˜å½±å“ï¼Œä¸­ç­‰åŠªåŠ›ï¼ˆä¸‹ä¸€ä¸ªä¼˜å…ˆçº§ï¼‰ï¼š**

- å¹¶è¡Œå¤„ç†ï¼šä½¿ç”¨Rayonæ‰§è¡ŒCPUå¯†é›†å‹å·¥ä½œ
- æµåª’ä½“ï¼šç”¨è¿­ä»£å™¨æ›¿æ¢å¤§æ•°æ®é›†çš„collect()
- å†…å­˜å¸ƒå±€ä¼˜åŒ–ï¼šé‡æ–°ç»„ç»‡çƒ­æ•°æ®ç»“æ„
- æƒ°æ€§è¯„ä¼°ï¼šæ¨è¿Ÿæ˜‚è´µè®¡ç®—

**é«˜å½±å“ï¼Œé«˜åŠªåŠ›ï¼ˆé«˜çº§ï¼‰ï¼š**

- ç¼“å­˜å‹å¥½çš„ç»“æ„ï¼šä¸ºç¼“å­˜å±€éƒ¨æ€§è¿›è¡Œå…¨é¢é‡æ–°è®¾è®¡
- æ— é”å¹¶å‘ï¼šæ›¿æ¢å…³é”®è·¯å¾„ä¸­çš„äº’æ–¥é”
- ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šç±»å‹çº§ç¼–ç¨‹
- è‡ªå®šä¹‰åˆ†é…å™¨ï¼šä¸ºç‰¹å®šç”¨ä¾‹è¿›è¡ŒArenaåˆ†é…

## å†³ç­–æ¡†æ¶

1. **é¦–å…ˆæµ‹é‡**ï¼šä½¿ç”¨æ€§èƒ½åˆ†æç¡®å®šå®é™…ç“¶é¢ˆ
2. **ä»ç®€å•å¼€å§‹**ï¼šé¦–å…ˆåº”ç”¨ä½åŠªåŠ›ã€é«˜å½±å“çš„ä¼˜åŒ–
3. **éªŒè¯æ”¹è¿›**ï¼šåœ¨æ›´æ”¹ä¹‹å‰å’Œä¹‹åè¿›è¡ŒåŸºå‡†æµ‹è¯•
4. **è€ƒè™‘ç»´æŠ¤**ï¼šåœ¨æ€§èƒ½æå‡çš„åŒæ—¶è€ƒè™‘ç»´æŠ¤æˆæœ¬

## ğŸš¨ å¸¸è§é™·é˜±ä¸åæ¨¡å¼

æˆåŠŸçš„ä¼˜åŒ–éœ€è¦é¿å…å¯èƒ½æµªè´¹å·¥ä½œæˆ–ç”šè‡³æŸå®³æ€§èƒ½çš„å¸¸è§é”™è¯¯ã€‚

**è¿‡æ—©ä¼˜åŒ–**ï¼šåœ¨æ²¡æœ‰æµ‹é‡çš„æƒ…å†µä¸‹ä¸è¦ä¼˜åŒ–ã€‚å¯¹å¾ˆå°‘æ‰§è¡Œçš„ä»£ç è¿›è¡Œå¤æ‚ä¼˜åŒ–ä¼šæµªè´¹å¼€å‘æ—¶é—´å¹¶å¢åŠ ç»´æŠ¤è´Ÿæ‹…ã€‚

**è¿‡åº¦å·¥ç¨‹**ï¼šç®€å•ã€ç›´æ¥çš„å®ç°é€šå¸¸ä¼˜äºå¤æ‚çš„æŠ½è±¡ã€‚é’ˆå¯¹å®é™…ç”¨ä¾‹è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä¸æ˜¯ç†è®ºåœºæ™¯ã€‚

**å¿½è§†80/20è§„åˆ™**ï¼šå¤§éƒ¨åˆ†æ€§èƒ½æå‡æ¥è‡ªäºä¼˜åŒ–ä»£ç çš„ä¸€å°éƒ¨åˆ†ã€‚ä½¿ç”¨æ€§èƒ½åˆ†æè¯†åˆ«çƒ­è·¯å¾„ï¼Œå¹¶åœ¨æ­¤é›†ä¸­ç²¾åŠ›ã€‚

**å¾®ä¼˜åŒ–è€Œå¿½è§†ç®—æ³•å¤æ‚æ€§**ï¼šå…·æœ‰å¾®ä¼˜åŒ–çš„O(nÂ²)ç®—æ³•åœ¨å¤§è¾“å…¥ä¸­ä»ç„¶ä¼šè´¥ç»™æœªä¼˜åŒ–çš„O(n log n)ç®—æ³•ã€‚

## ğŸ“ˆ æˆåŠŸæµ‹é‡ï¼šå…³é”®æŒ‡æ ‡å’ŒåŸºå‡†æµ‹è¯•

è·Ÿè¸ªæ­£ç¡®çš„æŒ‡æ ‡ä»¥éªŒè¯ä¼˜åŒ–å·¥ä½œï¼š

**æ€§èƒ½æŒ‡æ ‡ï¼š**

- ååé‡ï¼šæ¯ç§’æ“ä½œæ¬¡æ•°
- å»¶è¿Ÿï¼šå“åº”æ—¶é—´ç™¾åˆ†ä½æ•°ï¼ˆp50ï¼Œp95ï¼Œp99ï¼‰
- èµ„æºä½¿ç”¨ï¼šCPUã€å†…å­˜ã€ç£ç›˜I/O
- å¯æ‰©å±•æ€§ï¼šåœ¨ä¸åŒè´Ÿè½½ä¸‹çš„æ€§èƒ½

**å¼€å‘æŒ‡æ ‡ï¼š**

- ç¼–è¯‘æ—¶é—´ï¼šå¯¹å¼€å‘é€Ÿåº¦çš„å½±å“
- äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ï¼šéƒ¨ç½²å’Œå¯åŠ¨è€ƒè™‘
- ä»£ç å¤æ‚æ€§ï¼šéšæ—¶é—´æ¨ç§»çš„ç»´æŠ¤è´Ÿæ‹…

## ğŸ“ å­¦ä¹ è·¯å¾„ï¼šå»ºç«‹ä¼˜åŒ–ä¸“ä¸šçŸ¥è¯†

**åˆå­¦è€…æ°´å¹³ï¼š**

- æŒæ¡RuståŸºç¡€çŸ¥è¯†ï¼šæ‰€æœ‰æƒã€å€Ÿç”¨ã€ç”Ÿå‘½å‘¨æœŸ
- å­¦ä¹ ä½¿ç”¨`cargo bench`å’Œæ—¥å¿—è¿›è¡ŒåŸºæœ¬æ€§èƒ½åˆ†æ
- ç»ƒä¹ é›¶æ‹·è´æ¨¡å¼å’Œé¢„åˆ†é…
- äº†è§£ä½•æ—¶ä½¿ç”¨å¼•ç”¨ä¸æ‹¥æœ‰çš„å€¼

**ä¸­çº§æ°´å¹³ï¼š**

- å­¦ä¹ Rayonå’ŒTokioçš„å¹¶è¡Œå¤„ç†
- å­¦ä¹ å†…å­˜å¸ƒå±€åŸç†å’Œç¼“å­˜è¡Œä¸º
- ç»ƒä¹ æµåª’ä½“å’Œæƒ°æ€§è¯„ä¼°æ¨¡å¼
- äº†è§£æ•°æ®åº“ä¼˜åŒ–æŠ€æœ¯

**é«˜çº§æ°´å¹³ï¼š**

- æŒæ¡æ— é”ç¼–ç¨‹å’ŒåŸå­æ“ä½œ
- å­¦ä¹ ç‰¹å®šé¢†åŸŸçš„SIMDç¼–ç¨‹
- å®ç°è‡ªå®šä¹‰åˆ†é…å™¨å’Œå†…å­˜ç®¡ç†
- å­¦ä¹ ä½¿ç”¨å¸¸é‡æ³›å‹å’Œå®è¿›è¡Œç¼–è¯‘æ—¶ç¼–ç¨‹

**ä¸“å®¶çº§æ°´å¹³ï¼š**

- ç†è§£ç³»ç»Ÿçº§ä¼˜åŒ–ï¼šNUMAã€CPUæ‹“æ‰‘
- å¼€å‘ç‰¹å®šé¢†åŸŸçš„ä¼˜åŒ–ç­–ç•¥
- æ„å»ºè‡ªå®šä¹‰æ€§èƒ½åˆ†æå’Œä¼˜åŒ–å·¥å…·
- æŒ‡å¯¼ä»–äººå¹¶ä¸ºæ›´å¹¿æ³›çš„ç¤¾åŒºåšå‡ºè´¡çŒ®

## ğŸ”— ç°å®åº”ç”¨ï¼šæ¥è‡ªRethçš„æ•™è®­

è¿™äº›ä¼˜åŒ–æŠ€æœ¯ä¸æ˜¯ç†è®ºçš„â€”â€”é€šè¿‡Rethçš„å®ç°ï¼Œå®ƒä»¬å·²åœ¨ç”Ÿäº§ä¸­å¾—åˆ°éªŒè¯ã€‚Rethå±•ç¤ºäº†ç³»ç»Ÿä¼˜åŒ–çš„åŠ›é‡ï¼š

- **é›¶æ‹·è´**ï¼šåœ¨ä¸å¿…è¦çš„å…‹éš†çš„æƒ…å†µä¸‹å¤„ç†äº¤æ˜“
- **å¹¶è¡Œå¤„ç†**ï¼šç­¾åæ¢å¤åˆ†å¸ƒåœ¨CPUæ ¸å¿ƒä¹‹é—´
- **æµåª’ä½“**ï¼šåŒºå—åŒæ­¥æ— éœ€åŠ è½½æ•´ä¸ªåŒºå—é“¾
- **ç¼“å­˜ä¼˜åŒ–**ï¼šçŠ¶æ€è®¿é—®çš„å¤šçº§ç¼“å­˜
- **æ•°æ®åº“æ‰¹å¤„ç†**ï¼šé«˜æ•ˆçš„MDBXæ“ä½œæœ€å°åŒ–I/O
- **ç¼–è¯‘æ—¶å®‰å…¨**ï¼šç±»å‹å®‰å…¨çš„å…±è¯†çŠ¶æ€è½¬å˜

ç»“æœä¸è¨€è€Œå–»ï¼šåŒæ­¥é€Ÿåº¦æ¯”å…¶ä»–Ethereumå®¢æˆ·ç«¯å¿«2-5å€ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘30-50%ï¼ŒRPCå“åº”æ—¶é—´ä½äºæ¯«ç§’ï¼Œå¹¶èƒ½å¤Ÿæ¯ç§’å¤„ç†è¶…è¿‡10,000ä¸ªè¯·æ±‚ã€‚

## ç»“è®ºï¼šé€šå¾€æ€§èƒ½çš„é“è·¯

è¿™äº›ä¼˜åŒ–æŠ€æœ¯å¦‚æœç³»ç»Ÿåº”ç”¨å¹¶ä»”ç»†æµ‹é‡ï¼Œå¯ä»¥æ”¹å˜ä»»ä½•Ruståº”ç”¨ç¨‹åºçš„æ€§èƒ½ç‰¹å¾ã€‚å…³é”®åŸåˆ™æ˜¯ï¼š

1. **é¦–å…ˆæµ‹é‡**ï¼šä½¿ç”¨æ€§èƒ½åˆ†æç¡®å®šå®é™…ç“¶é¢ˆå†è¿›è¡Œä¼˜åŒ–
2. **ä»ç®€å•å¼€å§‹**ï¼šé¦–å…ˆåº”ç”¨é«˜å½±å“ã€ä½åŠªåŠ›çš„ä¼˜åŒ–
3. **éªŒè¯ä¸€åˆ‡**ï¼šå¯¹æ”¹è¿›è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œä»¥ç¡®ä¿å…¶æä¾›å®é™…ä»·å€¼
4. **å¹³è¡¡æƒè¡¡**ï¼šåœ¨è€ƒè™‘æ€§èƒ½æå‡çš„åŒæ—¶è€ƒè™‘ç»´æŠ¤æˆæœ¬

è®°ä½ï¼Œè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºï¼Œä½†æˆç†Ÿçš„ä¼˜åŒ–æ˜¯æ‰€æœ‰æ€§èƒ½çš„æ ¹æºã€‚ä»æ­£ç¡®ã€ç®€å•çš„ä»£ç å¼€å§‹ï¼Œç„¶ååœ¨æµ‹é‡æ˜¾ç¤ºå®ƒä»¬å°†äº§ç”Ÿæœ€å¤§æ•ˆåº”çš„åœ°æ–¹åº”ç”¨è¿™äº›æŠ€æœ¯ã€‚

Rustçš„é›¶æˆæœ¬æŠ½è±¡ã€å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿå’Œå†…å­˜å®‰å…¨ä¿è¯ä¸ºæ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿæä¾›äº†å“è¶Šçš„åŸºç¡€ã€‚é€šè¿‡æŒæ¡è¿™äº›ä¼˜åŒ–æŠ€æœ¯ï¼Œä½ å¯ä»¥é‡Šæ”¾Rustçš„å…¨éƒ¨æ½œåŠ›ï¼Œå¹¶æ„å»ºå‡ºè®¾ç«‹æ€§èƒ½ä¸æ•ˆç‡æ–°æ ‡å‡†çš„åº”ç”¨ç¨‹åºã€‚

&gt;- åŸæ–‡é“¾æ¥ï¼š [extremelysunnyyk.medium....](https://extremelysunnyyk.medium.com/unofficial-guide-to-rust-optimization-techniques-ec3bd54c5bc0)
&gt;- ç™»é“¾ç¤¾åŒº AI åŠ©æ‰‹ï¼Œä¸ºå¤§å®¶è½¬è¯‘ä¼˜ç§€è‹±æ–‡æ–‡ç« ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸é€šçš„åœ°æ–¹ï¼Œè¿˜è¯·åŒ…æ¶µï½</textarea>
                        <div id="md_view">
                            <p><img src="https://img.learnblockchain.cn/2025/06/04/53243699_image.jpg" alt="" /></p>
<p>Rustä¼˜åŒ–</p>
<p>Rustç‹¬ç‰¹çš„æ‰€æœ‰æƒæ¨¡å‹å’Œé›¶æˆæœ¬æŠ½è±¡ä½¿å…¶æˆä¸ºæ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿçš„å“è¶Šè¯­è¨€ã€‚ç„¶è€Œï¼Œå®ç°æœ€ä½³æ€§èƒ½éœ€è¦ç†è§£å’Œåº”ç”¨ç‰¹å®šçš„ä¼˜åŒ–æŠ€æœ¯ã€‚æœ¬æŒ‡å—å…¨é¢æ¢è®¨äº†æ¨åŠ¨ç”Ÿäº§ç³»ç»Ÿï¼ˆå¦‚Rethï¼ŒEthereumçš„æœ€å¿«æ‰§è¡Œå®¢æˆ·ç«¯ï¼‰çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<h3>åŸºç¡€ï¼šä¸ºä»€ä¹ˆä¼˜åŒ–å¾ˆé‡è¦</h3>
<p>ç°ä»£åº”ç”¨ç¨‹åºï¼Œå°¤å…¶æ˜¯åœ¨åŒºå—é“¾åŸºç¡€è®¾æ–½ã€é‡‘èç³»ç»Ÿå’Œå®æ—¶å¤„ç†ç­‰é¢†åŸŸï¼Œéœ€è¦æç«¯æ€§èƒ½ã€‚ä¼˜åŒ–ä¸æœªä¼˜åŒ–çš„Ruståº”ç”¨ç¨‹åºä¹‹é—´çš„å·®å¼‚å¯èƒ½æ˜¯æ˜¾è‘—çš„â€”â€”æˆ‘ä»¬è°ˆè®ºçš„æ˜¯ååé‡æé«˜10å€ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘50%-90%ï¼Œä»¥åŠå¤„ç†æœ¬æ¥ä¸å¯èƒ½å®Œæˆçš„å·¥ä½œè´Ÿè½½çš„èƒ½åŠ›ã€‚</p>
<p>è¿™äº›ä¼˜åŒ–ä¸ä»…ä»…æ˜¯å­¦æœ¯ç»ƒä¹ ã€‚åœ¨Rethçš„å¼€å‘ä¸­ï¼Œç³»ç»Ÿåœ°åº”ç”¨è¿™äº›æŠ€æœ¯ä½¿åŒæ­¥é€Ÿåº¦æ¯”å…¶ä»–Ethereumå®¢æˆ·ç«¯å¿«2-5å€ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘30-50%ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†è¶…è¿‡10,000ä¸ªRPCè¯·æ±‚æ¯ç§’ã€‚</p>
<h2>ğŸš€ é›¶æ‹·è´æ“ä½œï¼šä½å‚æœå®</h2>
<p>é›¶æ‹·è´æ“ä½œä»£è¡¨äº†Rustä¸­æœ€é«˜å½±å“ã€æœ€ä½åŠªåŠ›çš„ä¼˜åŒ–ä¹‹ä¸€ã€‚æ ¸å¿ƒåŸåˆ™å¾ˆç®€å•ï¼šé€šè¿‡åˆ©ç”¨Rustçš„æ‰€æœ‰æƒç³»ç»Ÿæ¥ä¼ é€’å¼•ç”¨è€Œä¸æ˜¯å¤åˆ¶æ•°æ®ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„æ•°æ®é‡å¤ã€‚</p>
<p>è€ƒè™‘åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶çš„æ€§èƒ½å·®å¼‚ã€‚å¤åˆ¶ä¸€ä¸ª1MBçš„å‘é‡æ¶‰åŠåˆ°åˆ†é…æ–°çš„å†…å­˜ã€å¤åˆ¶æ¯ä¸ªå­—èŠ‚ï¼Œæœ€ç»ˆé‡Šæ”¾åŸå§‹å†…å­˜â€”â€”å¯èƒ½éœ€è¦æˆåƒä¸Šä¸‡çš„CPUå‘¨æœŸå’Œç¼“å­˜å¤±æ•ˆç‡ã€‚ä¼ é€’ä¸€ä¸ªå¼•ç”¨ä»…éœ€è¦8ä¸ªå­—èŠ‚ï¼Œå‡ ä¹æ²¡æœ‰è®¡ç®—å¼€é”€ã€‚</p>
<pre><code class="language-rust">// æ˜‚è´µï¼šå¤åˆ¶1MBçš„æ•°æ®
let large_data = vec![0u8; 1_000_000];
let processed = expensive_copy(large_data); // å¤åˆ¶æ•´ä¸ªå‘é‡</code></pre>
<pre><code class="language-rust">// é«˜æ•ˆï¼šä»…ä¼ é€’ä¸€ä¸ªå¼•ç”¨ï¼ˆ8å­—èŠ‚ï¼‰
let large_data = vec![0u8; 1_000_000];
let processed = zero_copy(&amp;large_data); // ä»…ä¼ é€’æŒ‡é’ˆ</code></pre>
<p>çœŸæ­£çš„åŠ›é‡åœ¨äºè¿­ä»£å™¨é“¾ä¸­ï¼Œåœ¨è¿™é‡Œå¯ä»¥å®Œå…¨æ¶ˆé™¤ä¸­é—´é›†åˆï¼š</p>
<pre><code class="language-rust">// åˆ›å»ºå¤šä¸ªä¸­é—´åˆ†é…
fn process_data_wasteful(items: Vec&amp;lt;Item&gt;) -&gt; Vec&amp;lt;ProcessedItem&gt; {
    let filtered: Vec&amp;lt;Item&gt; = items.into_iter()
        .filter(|item| item.is_valid())
        .collect(); // åˆ†é…#1

    let mapped: Vec&amp;lt;TempItem&gt; = filtered.into_iter()
        .map(|item| transform(item))
        .collect(); // åˆ†é…#2

    mapped.into_iter()
        .map(|temp| finalize(temp))
        .collect() // åˆ†é…#3
}</code></pre>
<pre><code class="language-rust">// é›¶ä¸­é—´åˆ†é…
fn process_data_efficient(items: Vec&amp;lt;Item&gt;) -&gt; Vec&amp;lt;ProcessedItem&gt; {
    items.into_iter()
        .filter(|item| item.is_valid())
        .map(|item| transform(item))
        .map(|temp| finalize(temp))
        .collect() // ä»…ä¸€ä¸ªåˆ†é…
}</code></pre>
<p>æ™ºèƒ½å€Ÿç”¨æ¨¡å¼å°†æ­¤æ¦‚å¿µæ‰©å±•åˆ°APIè®¾è®¡ä¸­ã€‚è®¾è®¡è‰¯å¥½çš„å‡½æ•°åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å€Ÿç”¨æ‰€éœ€å†…å®¹å¹¶è¿”å›å¯¹ç°æœ‰æ•°æ®çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯è·å–æ‰€æœ‰æƒå¹¶å¼ºè¿«è°ƒç”¨è€…å…‹éš†æ•°æ®æˆ–å¤±å»è®¿é—®æƒï¼š</p>
<pre><code class="language-rust">// å¼ºè¿«è°ƒç”¨è€…æ”¾å¼ƒæ‰€æœ‰æƒ
fn analyze_transactions_bad(txs: Vec&amp;lt;Transaction&gt;) -&gt; Report {
    Report::new(txs) // è°ƒç”¨è€…å¤±å»å¯¹txsçš„è®¿é—®
}</code></pre>
<pre><code class="language-rust">// å…è®¸è°ƒç”¨è€…ä¿ç•™æ‰€æœ‰æƒ
fn analyze_transactions_good(txs: &amp;[Transaction]) -&gt; Report {
    Report::from_slice(txs) // è°ƒç”¨è€…ä»ç„¶å¯ä»¥ä½¿ç”¨txs
}

// ç”šè‡³æ›´å¥½ï¼šå°½å¯èƒ½è¿”å›å¼•ç”¨
fn find_largest_transaction(txs: &amp;[Transaction]) -&gt; Option&amp;lt;&amp;Transaction&gt; {
    txs.iter().max_by_key(|tx| tx.value) // è¿”å›å¯¹ç°æœ‰æ•°æ®çš„å¼•ç”¨
}</code></pre>
<h2>ğŸ§  å†…å­˜å¸ƒå±€ä¼˜åŒ–ï¼šä¸ç¡¬ä»¶ååŒå·¥ä½œ</h2>
<p>ç°ä»£CPUå¹¶ä¸é€å­—èŠ‚åœ°è®¿é—®å†…å­˜â€”â€”å®ƒä»¬ä»¥64å­—èŠ‚çš„ç¼“å­˜è¡Œè·å–æ•°æ®ã€‚ç†è§£è¿™ä¸€ç¡¬ä»¶ç°å®èƒ½å¤Ÿé€šè¿‡ä»”ç»†çš„æ•°æ®ç»“æ„è®¾è®¡å®ç°æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚</p>
<p>ç³Ÿç³•çš„å†…å­˜å¸ƒå±€æµªè´¹äº†å®è´µçš„ç¼“å­˜ç©ºé—´ï¼Œå¹¶è¿«ä½¿ä¸å¿…è¦çš„å†…å­˜è®¿é—®ã€‚è€ƒè™‘ä¸€ä¸ªè·¨è¶Šå¤šä¸ªç¼“å­˜è¡Œçš„ä¸é«˜æ•ˆäº¤æ˜“ç»“æ„ï¼š</p>
<pre><code class="language-rust">// ç³Ÿç³•çš„ç¼“å­˜å¸ƒå±€ - è·¨è¶Šå¤šä¸ªç¼“å­˜è¡Œï¼Œæµªè´¹
struct BadTransaction {
    hash: [u8; 32],        // 32å­—èŠ‚
    signature: [u8; 65],   // 65å­—èŠ‚ - è·¨è¶Šç¼“å­˜è¡Œè¾¹ç•Œ
    nonce: u64,            // 8å­—èŠ‚
    gas_limit: u64,        // 8å­—èŠ‚
}</code></pre>
<pre><code class="language-rust">// ä¼˜åŒ–å¸ƒå±€ - æŒ‰è®¿é—®æ¨¡å¼ç»„ç»‡æ•°æ®
#[repr(C)] // å¯é¢„æµ‹çš„å¸ƒå±€
struct GoodTransaction {
    // çƒ­æ•°æ®ï¼šç»å¸¸ä¸€èµ·è®¿é—®ï¼ˆ32å­—èŠ‚=åŠä¸ªç¼“å­˜è¡Œï¼‰
    nonce: u64,            // 8å­—èŠ‚
    gas_limit: u64,        // 8å­—èŠ‚
    gas_price: u64,        // 8å­—èŠ‚
    value: u64,            // 8å­—èŠ‚

    // æ¸©æš–æ•°æ®ï¼šå¶å°”è®¿é—®ï¼ˆ32å­—èŠ‚=åŠä¸ªç¼“å­˜è¡Œï¼‰
    to: [u8; 20],          // 20å­—èŠ‚
    _padding: [u8; 12],    // 12å­—èŠ‚çš„å¡«å……ä»¥å¯¹é½

    // å†·æ•°æ®ï¼šå¾ˆå°‘è®¿é—®ï¼ˆå•ç‹¬çš„ç¼“å­˜è¡Œï¼‰
    hash: [u8; 32],        // 32å­—èŠ‚
    signature: [u8; 65],   // 65å­—èŠ‚
}</code></pre>
<p>æ•°ç»„ç»“æ„ï¼ˆSoAï¼‰æ¨¡å¼æ›´è¿›ä¸€æ­¥ï¼Œå®Œå…¨å°†çƒ­æ•°æ®å’Œå†·æ•°æ®åˆ†å¼€ï¼Œä»¥è¿›è¡Œåªéœ€ç‰¹å®šå­—æ®µçš„æ“ä½œï¼š</p>
<pre><code class="language-rust">// ç»“æ„æ•°ç»„ - ä¸ºå•ä¸ªå­—æ®µåŠ è½½æ•´ä¸ªç»“æ„
struct AoSTransactions {
    transactions: Vec&amp;lt;Transaction&gt;, // æ¯ä¸ªäº¤æ˜“100+å­—èŠ‚
}</code></pre>
<pre><code class="language-rust">impl AoSTransactions {
    fn sum_gas_limits(&amp;self) -&gt; u64 {
        self.transactions.iter()
            .map(|tx| tx.gas_limit) // ä¸º8å­—èŠ‚å­—æ®µåŠ è½½æ•´ä¸ª100å­—èŠ‚ç»“æ„
            .sum()
    }
}

// ç»“æ„æ•°ç»„ - é’ˆå¯¹ç‰¹å®šæ“ä½œçš„å®Œç¾ç¼“å­˜åˆ©ç”¨
struct SoATransactions {
    // çƒ­æ•°æ®èšé›†åœ¨ä¸€èµ·
    nonces: Vec&amp;lt;u64&gt;,
    gas_limits: Vec&amp;lt;u64&gt;,
    gas_prices: Vec&amp;lt;u64&gt;,
    values: Vec&amp;lt;u64&gt;,

    // å†·æ•°æ®åˆ†å¼€
    hashes: Vec&amp;lt;[u8; 32]&gt;,
    signatures: Vec&amp;lt;[u8; 65]&gt;,
}
impl SoATransactions {
    fn sum_gas_limits(&amp;self) -&gt; u64 {
        self.gas_limits.iter().sum() // å®Œç¾ç¼“å­˜åˆ©ç”¨ï¼šä»…åŠ è½½æ‰€éœ€æ•°æ®
    }

    fn get_transaction(&amp;self, index: usize) -&gt; Transaction {
        // å½“éœ€è¦å®Œæ•´å¯¹è±¡æ—¶é‡å»ºï¼ˆå°‘è§ï¼‰
        Transaction {
            nonce: self.nonces[index],
            gas_limit: self.gas_limits[index],
            // ... å…¶ä»–å­—æ®µ
        }
    }
}</code></pre>
<p>ç´§å‡‘ç¼–ç ï¼Œå¼€åˆ›äºRethç­‰é¡¹ç›®ä¸­ï¼Œé€šè¿‡ä»…å­˜å‚¨å¿…è¦æ•°æ®å¹¶æŒ‰éœ€è®¡ç®—æ´¾ç”Ÿå­—æ®µï¼Œå°†å†…å­˜ä¼˜åŒ–æå‡åˆ°æè‡´ï¼š</p>
<pre><code class="language-rust">// æ ‡å‡†ç¼–ç å­˜å‚¨æ‰€æœ‰å†…å®¹
#[derive(Serialize, Deserialize)]
struct StandardReceipt {
    transaction_hash: [u8; 32],    // 32å­—èŠ‚
    transaction_index: u64,        // 8å­—èŠ‚
    block_hash: [u8; 32],         // 32å­—èŠ‚
    block_number: u64,            // 8å­—èŠ‚
    cumulative_gas_used: u64,     // 8å­—èŠ‚
    gas_used: u64,                // 8å­—èŠ‚
    contract_address: Option&amp;lt;[u8; 20]&gt;, // 21å­—èŠ‚
    logs_bloom: [u8; 256],        // 256å­—èŠ‚
    status: u8,                   // 1å­—èŠ‚
    // æ€»è®¡ï¼š~374å­—èŠ‚
}</code></pre>
<pre><code class="language-rust">// ç´§å‡‘ç¼–ç ä»…å­˜å‚¨å¿…è¦æ•°æ®
#[derive(reth_codec::Compact)]
struct CompactReceipt {
    cumulative_gas_used: u64,     // 8å­—èŠ‚
    gas_used: u64,                // 8å­—èŠ‚
    contract_address: Option&amp;lt;[u8; 20]&gt;, // 0-20å­—èŠ‚
    status: u8,                   // 1å­—èŠ‚
    logs: Vec&amp;lt;CompactLog&gt;,        // å¯å˜å¤§å°
    // æ€»è®¡ï¼š~50-100å­—èŠ‚ï¼ˆå‡å°60-75%ï¼‰

    // æ´¾ç”Ÿå­—æ®µæŒ‰éœ€è®¡ç®—ï¼š
    // - transaction_hashï¼šä»ç´¢å¼•æŸ¥æ‰¾
    // - block_hashï¼šä»åŒºå—å·æŸ¥æ‰¾
    // - logs_bloomï¼šä»æ—¥å¿—è®¡ç®—
}</code></pre>
<h2>ğŸ“¦ åˆ†é…æ¨¡å¼ï¼šå‡å°‘å †å‹åŠ›</h2>
<p>å†…å­˜åˆ†é…æ˜¯æ˜‚è´µçš„ã€‚æ¯æ¬¡åˆ†é…æ¶‰åŠç³»ç»Ÿè°ƒç”¨ã€å…ƒæ•°æ®æ›´æ–°ã€æ½œåœ¨çš„ç¼“å­˜æœªå‘½ä¸­ï¼Œå¹¶å¯¼è‡´éšæ—¶é—´æ¨ç§»çš„å†…å­˜ç¢ç‰‡ã€‚èªæ˜çš„åˆ†é…æ¨¡å¼å¯ä»¥æ¶ˆé™¤å¤§éƒ¨åˆ†å¼€é”€ã€‚</p>
<p>é¢„åˆ†é…æ˜¯æœ€ç®€å•çš„ä¼˜åŒ–â€”â€”å¦‚æœä½ å¤§æ¦‚çŸ¥é“ä½ éœ€è¦å¤šå°‘å†…å­˜ï¼Œè¯·æå‰åˆ†é…ï¼š</p>
<pre><code class="language-rust">// å­—ç¬¦ä¸²å¢é•¿æ—¶é‡å¤åˆ†é…
fn build_response_naive(items: &amp;[Item]) -&gt; String {
    let mut result = String::new(); // ä»0å®¹é‡å¼€å§‹
    for item in items {
        result.push_str(&amp;format!("{},", item)); // å¤šæ¬¡é‡æ–°åˆ†é…
    }
    result
}</code></pre>
<pre><code class="language-rust">// é¢„åˆ†é…å¹¶ä¼°è®¡å®¹é‡
fn build_response_optimized(items: &amp;[Item]) -&gt; String {
    // ä¼°è®¡ï¼šæ¯ä¸ªé¡¹å¹³å‡10ä¸ªå­—ç¬¦+é€—å·
    let estimated_size = items.len() * 11;
    let mut result = String::with_capacity(estimated_size);

    for item in items {
        use std::fmt::Write;
        write!(result, "{},", item).unwrap(); // ä¸ä¼šå†åˆ†é…
    }
    result
}</code></pre>
<p>é«˜çº§ç³»ç»Ÿå¯ä»¥é€šè¿‡ä»å…ˆå‰çš„åˆ†é…ä¸­å­¦ä¹ ï¼Œéšç€æ—¶é—´çš„æ¨ç§»æ”¹å–„ä¼°ç®—ï¼š</p>
<pre><code class="language-rust">struct AdaptiveStringBuilder {
    last_sizes: VecDeque&amp;lt;usize&gt;,
    max_history: usize,
}</code></pre>
<pre><code class="language-rust">impl AdaptiveStringBuilder {
    fn build_response(&amp;mut self, items: &amp;[Item]) -&gt; String {
        // ä»å…ˆå‰çš„åˆ†é…ä¸­å­¦ä¹ 
        let avg_size = self.last_sizes.iter().sum::&amp;lt;usize&gt;() / self.last_sizes.len().max(1);
        let estimated_size = (avg_size * items.len()).max(64);

        let mut result = String::with_capacity(estimated_size);
        for item in items {
            use std::fmt::Write;
            write!(result, "{},", item).unwrap();
        }

        // è·Ÿè¸ªå®é™…å¤§å°ä»¥ä¾¿æœªæ¥ä¼°ç®—
        self.last_sizes.push_back(result.len());
        if self.last_sizes.len() &gt; self.max_history {
            self.last_sizes.pop_front();
        }

        result
    }
}</code></pre>
<p>å¯¹è±¡æ± é€šè¿‡é‡å¤ä½¿ç”¨ç°æœ‰å®ä¾‹å®Œå…¨æ¶ˆé™¤ç»å¸¸ä½¿ç”¨å¯¹è±¡çš„åˆ†é…å¼€é”€ï¼š</p>
<pre><code class="language-rust">struct ObjectPool&amp;lt;T&gt; {
    objects: Mutex&amp;lt;Vec&amp;lt;T&gt;&gt;,
    factory: Box&amp;lt;dyn Fn() -&gt; T + Send + Sync&gt;,
}</code></pre>
<pre><code class="language-rust">impl&amp;lt;T&gt; ObjectPool&amp;lt;T&gt; {
    fn get(&amp;self) -&gt; PooledObject&amp;lt;T&gt; {
        let obj = self.objects.lock().unwrap()
            .pop()
            .unwrap_or_else(|| (self.factory)());

        PooledObject {
            object: Some(obj),
            pool: self,
        }
    }

    fn return_object(&amp;self, obj: T) {
        self.objects.lock().unwrap().push(obj);
    }
} // è‡ªåŠ¨åœ¨ä¸¢å¼ƒæ—¶è¿”å›æ± 
struct PooledObject&amp;lt;'a, T&gt; {
    object: Option&amp;lt;T&gt;,
    pool: &amp;'a ObjectPool&amp;lt;T&gt;,
}
impl&amp;lt;T&gt; Drop for PooledObject&amp;lt;'_, T&gt; {
    fn drop(&amp;mut self) {
        if let Some(obj) = self.object.take() {
            self.pool.return_object(obj);
        }
    }
}</code></pre>
<p>Arenaåˆ†é…é€šè¿‡åœ¨å•ä¸ªè¿ç»­åŒºåŸŸä¸­åˆ†é…æ‰€æœ‰å¯¹è±¡å¹¶ä¸€æ¬¡æ€§é‡Šæ”¾æ‰€æœ‰å¯¹è±¡ï¼Œä¸ºå…·æœ‰å¯é¢„æµ‹ç”Ÿå‘½å‘¨æœŸçš„å·¥ä½œè´Ÿè½½æä¾›äº†æ›´æ˜¾è‘—çš„æ”¹è¿›ï¼š</p>
<pre><code class="language-rust">use bumpalo::Bump;</code></pre>
<pre><code class="language-rust">struct RequestProcessor&amp;lt;'arena&gt; {
    arena: &amp;'arena Bump,
}
impl&amp;lt;'arena&gt; RequestProcessor&amp;lt;'arena&gt; {
    fn process_request(&amp;self, data: &amp;[u8]) -&gt; &amp;'arena ProcessedData {
        // æ­¤è¯·æ±‚ä¸­çš„æ‰€æœ‰åˆ†é…éƒ½ä½¿ç”¨arena
        let parsed = self.arena.alloc(parse_data(data));
        let validated = self.arena.alloc(validate(parsed));
        let result = self.arena.alloc(process(validated));

        result // åªè¦arenaå­˜åœ¨å°±å¯ä»¥ä½¿ç”¨
    }
}
fn handle_requests(requests: &amp;[Request]) {
    let arena = Bump::new();
    let processor = RequestProcessor { arena: &amp;arena };

    for request in requests {
        let result = processor.process_request(&amp;request.data);
        send_response(result);
    }

    // å½“arenaè¢«ä¸¢å¼ƒæ—¶ï¼Œæ‰€æœ‰åˆ†é…ä¸€æ¬¡æ€§é‡Šæ”¾
    // æ¯”å•ç‹¬é‡Šæ”¾è¦å¿«å¾—å¤š
}</code></pre>
<h2>âš¡ å¹¶è¡Œå¤„ç†æ¨¡å¼ï¼šåˆ©ç”¨å¤šä¸ªæ ¸å¿ƒ</h2>
<p>ç°ä»£ç³»ç»Ÿæœ‰å¤šä¸ªCPUæ ¸å¿ƒï¼Œæœªèƒ½æœ‰æ•ˆä½¿ç”¨å®ƒä»¬ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚Rustçš„æ‰€æœ‰æƒç³»ç»Ÿä½¿å¾—å¹¶è¡Œç¼–ç¨‹æ¯”å…¶ä»–è¯­è¨€æ›´å®‰å…¨ã€ç®€å•ã€‚</p>
<p>æ•°æ®å¹¶è¡Œä½¿ç”¨Rayonè‡ªåŠ¨å°†å·¥ä½œåˆ†é…åˆ°å¯ç”¨çš„CPUæ ¸å¿ƒä¸Šï¼Œå‡ ä¹åªéœ€æ›´æ”¹ä»£ç ï¼š</p>
<pre><code class="language-rust">use rayon::prelude::*;</code></pre>
<pre><code class="language-rust">// å¹¶è¡Œè¿­ä»£å™¨å¤„ç†
fn recover_senders(transactions: &amp;[Transaction]) -&gt; Vec&amp;lt;Address&gt; {
    transactions
        .par_iter() // è‡ªåŠ¨å°†å·¥ä½œåˆ†å‰²åˆ°CPUæ ¸å¿ƒä¸Š
        .map(|tx| {
            // CPUå¯†é›†å‹ECDSAç­¾åæ¢å¤
            recover_signer(tx.signature_hash(), &amp;tx.signature)
        })
        .collect()
}

// å¹¶è¡Œæ‰¹å¤„ç†ï¼Œé‡‡ç”¨æœ€ä½³å—å¤§å°
fn parallel_validation(blocks: &amp;[Block]) -&gt; Result&amp;lt;Vec&amp;lt;ValidationResult&gt;, Error&gt; {
    blocks
        .par_chunks(optimal_chunk_size(blocks.len()))
        .map(|chunk| validate_block_batch(chunk))
        .collect::&amp;lt;Result&amp;lt;Vec&amp;lt;_&gt;, _&gt;&gt;()
        .map(|results| results.into_iter().flatten().collect())
}
fn optimal_chunk_size(total_items: usize) -&gt; usize {
    let num_cpus = rayon::current_num_threads();
    (total_items / num_cpus).max(1).min(1000) // æ¯ä¸ªå—1åˆ°1000é¡¹
}</code></pre>
<p>ä½¿ç”¨Tokioçš„ä»»åŠ¡å¹¶è¡Œæ€§æ”¯æŒå¹¶å‘I/Oæ“ä½œå’Œå¤æ‚çš„å¤„ç†ç®¡é“ï¼š</p>
<pre><code class="language-rust">use tokio::task::JoinSet;</code></pre>
<pre><code class="language-rust">// åŠ¨æ€è´Ÿè½½çš„å·¥ä½œçªƒå–
async fn parallel_state_queries(addresses: Vec&amp;lt;Address&gt;) -&gt; Result&amp;lt;Vec&amp;lt;Account&gt;, Error&gt; {
    let mut set = JoinSet::new();

    // ç”Ÿæˆå¯ä»¥è¢«é—²ç½®çº¿ç¨‹çªƒå–çš„ä»»åŠ¡
    for addr in addresses {
        set.spawn(async move {
            provider.get_account(addr).await
        });
    }

    let mut results = Vec::new();
    while let Some(result) = set.join_next().await {
        results.push(result??);
    }

    Ok(results)
}

// æµæ°´çº¿å¹¶è¡Œå¤„ç†
async fn parallel_pipeline(input: Vec&amp;lt;RawData&gt;) -&gt; Result&amp;lt;Vec&amp;lt;ProcessedData&gt;, Error&gt; {
    let (tx1, mut rx1) = tokio::sync::mpsc::channel(100);
    let (tx2, mut rx2) = tokio::sync::mpsc::channel(100);

    // é˜¶æ®µ1ï¼šè§£ææ•°æ®
    let parse_handle = tokio::spawn(async move {
        for data in input {
            let parsed = parse(data).await?;
            tx1.send(parsed).await.map_err(|_| Error::ChannelClosed)?;
        }
        Ok::&amp;lt;_, Error&gt;(())
    });

    // é˜¶æ®µ2ï¼šéªŒè¯æ•°æ®
    let validate_handle = tokio::spawn(async move {
        while let Some(parsed) = rx1.recv().await {
            let validated = validate(parsed).await?;
            tx2.send(validated).await.map_err(|_| Error::ChannelClosed)?;
        }
        Ok::&amp;lt;_, Error&gt;(())
    });

    // é˜¶æ®µ3ï¼šæ”¶é›†ç»“æœ
    let mut results = Vec::new();
    while let Some(validated) = rx2.recv().await {
        results.push(validated);
    }

    parse_handle.await??;
    validate_handle.await??;

    Ok(results)
}</code></pre>
<p>æ— é”ç¼–ç¨‹æ¶ˆé™¤äº†æœ€é«˜æ€§èƒ½åœºæ™¯çš„äº‰ç”¨ï¼š</p>
<pre><code class="language-rust">use std::sync::atomic::{AtomicU64, Ordering};
use crossbeam::queue::SegQueue;</code></pre>
<pre><code class="language-rust">// æ— é”è®¡æ•°å™¨
struct LockFreeCounter {
    value: AtomicU64,
}
impl LockFreeCounter {
    fn increment(&amp;self) -&gt; u64 {
        self.value.fetch_add(1, Ordering::Relaxed)
    }

    fn get(&amp;self) -&gt; u64 {
        self.value.load(Ordering::Relaxed)
    }
}

// æ— é”é˜Ÿåˆ—ï¼Œé«˜ååé‡åœºæ™¯
struct HighThroughputProcessor {
    input_queue: SegQueue&amp;lt;Task&gt;,
    output_queue: SegQueue&amp;lt;Result&gt;,
}
impl HighThroughputProcessor {
    async fn process_continuously(&amp;self) {
        loop {
            if let Some(task) = self.input_queue.pop() {
                let result = self.process_task(task).await;
                self.output_queue.push(result);
            } else {
                tokio::task::yield_now().await;
            }
        }
    }
}</code></pre>
<h2>ğŸ—„ï¸ ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ï¼šä¸å†…å­˜å±‚çº§ååŒå·¥ä½œ</h2>
<p>ç†è§£CPUç¼“å­˜å±‚çº§å¯¹äºå®ç°æœ€å¤§æ€§èƒ½è‡³å…³é‡è¦ã€‚L1ç¼“å­˜åœ¨1-2ä¸ªå‘¨æœŸå†…æä¾›æ•°æ®ï¼Œè€Œä¸»å†…å­˜éœ€è¦200-300ä¸ªå‘¨æœŸâ€”â€”å·®å¼‚è¾¾åˆ°100å€ã€‚</p>
<p>ç¼“å­˜æ„è¯†è®¾è®¡å…±åŒå®šä½ä¸€èµ·è®¿é—®çš„é¢‘ç¹æ•°æ®ï¼Œå¹¶åˆ†å¼€å†·çƒ­æ•°æ®è·¯å¾„ï¼š</p>
<pre><code class="language-rust">// ä¸å‹å¥½çš„ç¼“å­˜ï¼šæ•£å¸ƒåœ¨å¤šä¸ªåˆ†é…ä¸­
struct ScatteredData {
    metadata: Box&amp;lt;Metadata&gt;,     // å•ç‹¬åˆ†é…
    payload: Vec&amp;lt;u8&gt;,           // å•ç‹¬åˆ†é…
    timestamps: Vec&amp;lt;u64&gt;,       // å•ç‹¬åˆ†é…
}</code></pre>
<pre><code class="language-rust">// å‹å¥½çš„ç¼“å­˜ï¼šåœ¨å•ä¸ªåˆ†é…ä¸­å…±åŒå®šä½çš„æ•°æ®
struct ColocatedData {
    // ç»å¸¸ä¸€èµ·åœ¨åŒä¸€ç¼“å­˜è¡Œä¸­è®¿é—®
    metadata: Metadata,         // å†…è”
    payload_len: u32,          // å†…è”
    timestamp_count: u32,      // å†…è”

    // å¯å˜å¤§å°çš„æ•°æ®æœ‰æ•ˆæ‰“åŒ…
    data: Vec&amp;lt;u8&gt;,             // payload + timestampsä¸€èµ·
}
impl ColocatedData {
    fn payload(&amp;self) -&gt; &amp;[u8] {
        &amp;self.data[..self.payload_len as usize]
    }

    fn timestamps(&amp;self) -&gt; &amp;[u64] {
        let start = self.payload_len as usize;
        let timestamp_bytes = &amp;self.data[start..];
        unsafe {
            std::slice::from_raw_parts(
                timestamp_bytes.as_ptr() as *const u64,
                self.timestamp_count as usize
            )
        }
    }
}</code></pre>
<p>å¹¶å‘æ•°æ®ç»“æ„æ¶ˆé™¤äº†é”å®šå¼€é”€ï¼ŒåŒæ—¶ä¿æŒå®‰å…¨æ€§ï¼š</p>
<pre><code class="language-rust">use dashmap::DashMap;</code></pre>
<pre><code class="language-rust">// æ— é”å¹¶å‘å“ˆå¸Œåœ°å›¾
struct ConcurrentCache {
    cache: DashMap&amp;lt;H256, Account&gt;,
    stats: AtomicU64,
}
impl ConcurrentCache {
    fn get(&amp;self, key: &amp;H256) -&gt; Option&amp;lt;Account&gt; {
        let result = self.cache.get(key).map(|entry| entry.clone());

        if result.is_some() {
            self.stats.fetch_add(1, Ordering::Relaxed);
        }

        result
    }

    fn insert(&amp;self, key: H256, value: Account) {
        self.cache.insert(key, value);
    }

    // æ— éœ€é”å®š - å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–/å†™å…¥
}</code></pre>
<p>NUMA-awareè®¾è®¡é˜²æ­¢CPUæ ¸å¿ƒä¹‹é—´çš„è™šå‡å…±äº«ï¼š</p>
<pre><code class="language-rust">use crossbeam::utils::CachePadded;</code></pre>
<pre><code class="language-rust">struct NumaAwareCounter {
    // é˜²æ­¢CPUæ ¸å¿ƒä¹‹é—´çš„è™šå‡å…±äº«
    counters: Vec&amp;lt;CachePadded&amp;lt;AtomicU64&gt;&gt;,
}
impl NumaAwareCounter {
    fn new() -&gt; Self {
        let num_cpus = num_cpus::get();
        let counters = (0..num_cpus)
            .map(|_| CachePadded::new(AtomicU64::new(0)))
            .collect();

        Self { counters }
    }

    fn increment(&amp;self) {
        let cpu_id = get_current_cpu_id() % self.counters.len();
        self.counters[cpu_id].fetch_add(1, Ordering::Relaxed);
    }

    fn total(&amp;self) -&gt; u64 {
        self.counters.iter()
            .map(|counter| counter.load(Ordering::Relaxed))
            .sum()
    }
}</code></pre>
<h2>ğŸŒŠ æµåª’ä½“å’Œæƒ°æ€§è¯„ä¼°ï¼šæ— æé™åˆ¶çš„å¤„ç†</h2>
<p>åœ¨å¤„ç†ä¸é€‚åˆå†…å­˜çš„å¤§å‹æ•°æ®é›†æ—¶ï¼Œæµåª’ä½“å’Œæƒ°æ€§è¯„ä¼°å˜å¾—è‡³å…³é‡è¦ã€‚è¿™äº›æŠ€æœ¯å…è®¸å¤„ç†ä»»æ„å¤§å°çš„æ•°æ®ï¼ŒåŒæ—¶ä¿æŒæœ‰é™çš„å†…å­˜ä½¿ç”¨ã€‚</p>
<p>æµå¤„ç†å¤§å‹æ•°æ®é›†å¯ä»¥é˜²æ­¢å†…å­˜è€—å°½ï¼š</p>
<pre><code class="language-rust">use futures::stream::{Stream, StreamExt};</code></pre>
<pre><code class="language-rust">// å°†æ‰€æœ‰å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ - å¤§å‹æ•°æ®é›†æ—¶å±é™©
async fn process_all_transactions() -&gt; Result&amp;lt;Vec&amp;lt;ProcessedTx&gt;, Error&gt; {
    let all_txs = database.load_all_transactions().await?; // å¯èƒ½ä¸ºGB
    let processed = all_txs.into_iter()
        .map(|tx| process_transaction(tx))
        .collect();
    Ok(processed)
}

// ä½¿ç”¨æœ‰é™å†…å­˜çš„æµå¤„ç†
async fn stream_process_transactions() -&gt; impl Stream&amp;lt;Item = Result&amp;lt;ProcessedTx, Error&gt;&gt; {
    database
        .transaction_stream() // æ¯æ¬¡äº§å‡ºä¸€ä¸ªäº¤æ˜“
        .buffer_unordered(100) // æœ€å¤šå¹¶å‘å¤„ç†100ä¸ª
        .map(|tx| async move {
            match tx {
                Ok(transaction) =&gt; Ok(process_transaction(transaction).await),
                Err(e) =&gt; Err(e),
            }
        })
        .buffered(50) // é™åˆ¶å¹¶å‘å¤„ç†
}</code></pre>
<p>èƒŒå‹å¤„ç†é˜²æ­¢ä¸‹æ¸¸ç³»ç»Ÿè¢«æ·¹æ²¡ï¼š</p>
<pre><code class="language-rust">async fn controlled_stream_processing() {
    let mut stream = stream_process_transactions();
    let mut processed_count = 0;

    while let Some(result) = stream.next().await {
        match result {
            Ok(processed_tx) =&gt; {
                send_to_output(processed_tx).await;
                processed_count += 1;

                // å¦‚æœè¾“å‡ºç¼“æ…¢ï¼Œåˆ™æ–½åŠ èƒŒå‹
                if processed_count % 1000 == 0 {
                    tokio::time::sleep(Duration::from_millis(10)).await;
                }
            }
            Err(e) =&gt; log::error!("Processing error: {}", e),
        }
    }
}</code></pre>
<p>æƒ°æ€§è¯„ä¼°ä¸è®°å¿†åŒ–ä¼šè®¡ç®—ä»…åœ¨éœ€è¦æ—¶çš„æ˜‚è´µå€¼å¹¶ç¼“å­˜ç»“æœï¼š</p>
<pre><code class="language-rust">struct LazyField&amp;lt;T, F&gt; {
    value: std::cell::OnceCell&amp;lt;T&gt;,
    compute: F,
}</code></pre>
<pre><code class="language-rust">impl&amp;lt;T, F&gt; LazyField&amp;lt;T, F&gt;
where
    F: FnOnce() -&gt; T,
{
    fn new(compute: F) -&gt; Self {
        Self {
            value: std::cell::OnceCell::new(),
            compute,
        }
    }

    fn get(&amp;self) -&gt; &amp;T {
        self.value.get_or_init(|| (self.compute)())
    }
}

// æƒ°æ€§äº¤æ˜“å­—æ®µæŒ‰éœ€è®¡ç®—
struct LazyTransaction {
    hash: H256,
    raw_data: Vec&amp;lt;u8&gt;,

    // æƒ©ç½šè®¡ç®—å»¶è¿Ÿåˆ°éœ€è¦æ—¶
    sender: LazyField&amp;lt;Address, Box&amp;lt;dyn FnOnce() -&gt; Address&gt;&gt;,
    gas_used: LazyField&amp;lt;u64, Box&amp;lt;dyn FnOnce() -&gt; u64&gt;&gt;,
}
impl LazyTransaction {
    fn new(hash: H256, raw_data: Vec&amp;lt;u8&gt;) -&gt; Self {
        let raw_data_clone = raw_data.clone();
        let raw_data_clone2 = raw_data.clone();

        Self {
            hash,
            raw_data,
            sender: LazyField::new(Box::new(move || {
                recover_sender_from_raw(&amp;raw_data_clone) // æ˜‚è´µçš„ECDSAæ¢å¤
            })),
            gas_used: LazyField::new(Box::new(move || {
                calculate_gas_used(&amp;raw_data_clone2) // æ˜‚è´µçš„Gasè®¡ç®—
            })),
        }
    }

    fn sender(&amp;self) -&gt; &amp;Address {
        self.sender.get() // è®¡ç®—ä¸€æ¬¡ï¼Œæ°¸ä¹…ç¼“å­˜
    }
}</code></pre>
<h2>ğŸ’¾ æ•°æ®åº“å’ŒI/Oä¼˜åŒ–ï¼šæœ€å°åŒ–ç³»ç»Ÿç“¶é¢ˆ</h2>
<p>æ•°æ®åº“æ“ä½œå’Œæ–‡ä»¶I/Oé€šå¸¸ä»£è¡¨åº”ç”¨ç¨‹åºä¸­æœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆã€‚ä¼˜åŒ–è¿™äº›æ“ä½œå¯ä»¥å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚</p>
<p>æ‰¹é‡æ“ä½œå‡å°‘äº†å•ä¸ªæ•°æ®åº“è°ƒç”¨çš„å¼€é”€ï¼š</p>
<pre><code class="language-rust">// å•ä¸ªæ“ä½œ - æ¯ä¸ªäº¤æ˜“è¿›è¡Œä¸€æ¬¡ç£ç›˜å†™å…¥
async fn save_transactions_slow(txs: &amp;[Transaction]) -&gt; Result&amp;lt;(), Error&gt; {
    for tx in txs {
        database.insert_transaction(tx).await?; // æ¯æ¬¡æ’å…¥ = 1æ¬¡ç£ç›˜å†™å…¥
    }
    Ok(())
}</code></pre>
<pre><code class="language-rust">// æ‰¹é‡æ“ä½œ - æ•´ä¸ªæ‰¹æ¬¡è¿›è¡Œä¸€æ¬¡ç£ç›˜å†™å…¥
async fn save_transactions_fast(txs: &amp;[Transaction]) -&gt; Result&amp;lt;(), Error&gt; {
    let mut batch = database.begin_batch();

    for tx in txs {
        batch.insert_transaction(tx)?; // å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­
    }

    batch.commit().await?; // å•æ¬¡ç£ç›˜å†™å…¥
    Ok(())
}</code></pre>
<p>è‡ªé€‚åº”æ‰¹å¤„ç†åœ¨å»¶è¿Ÿå’Œååé‡ä¹‹é—´åŠ¨æ€å¹³è¡¡ï¼š</p>
<pre><code class="language-rust">struct AdaptiveBatcher {
    pending: Vec&amp;lt;Transaction&gt;,
    max_batch_size: usize,
    max_wait_time: Duration,
    last_flush: Instant,
}</code></pre>
<pre><code class="language-rust">impl AdaptiveBatcher {
    async fn add_transaction(&amp;mut self, tx: Transaction) -&gt; Result&amp;lt;(), Error&gt; {
        self.pending.push(tx);

        let should_flush = self.pending.len() &gt;= self.max_batch_size
            || self.last_flush.elapsed() &gt;= self.max_wait_time;

        if should_flush {
            self.flush().await?;
        }

        Ok(())
    }

    async fn flush(&amp;mut self) -&gt; Result&amp;lt;(), Error&gt; {
        if !self.pending.is_empty() {
            database.batch_insert(&amp;self.pending).await?;
            self.pending.clear();
            self.last_flush = Instant::now();
        }
        Ok(())
    }
}</code></pre>
<p>é€‚å½“çš„ç¼“å†²æ¶ˆé™¤è¿‡å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼š</p>
<pre><code class="language-rust">use tokio::io::{AsyncReadExt, AsyncWriteExt, BufReader, BufWriter};</code></pre>
<pre><code class="language-rust">// æ— ç¼“å†²I/O - æ¯ä¸ªå­—èŠ‚è¿›è¡Œä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨
async fn copy_file_slow(src: &amp;Path, dst: &amp;Path) -&gt; Result&amp;lt;(), Error&gt; {
    let mut src_file = tokio::fs::File::open(src).await?;
    let mut dst_file = tokio::fs::File::create(dst).await?;

    let mut buffer = [0u8; 1]; // æ¯æ¬¡1å­—èŠ‚!
    while src_file.read(&amp;mut buffer).await? &gt; 0 {
        dst_file.write_all(&amp;buffer).await?;
    }

    Ok(())
}

// é€‚å½“çš„ç¼“å†²I/O - é«˜æ•ˆçš„ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨
async fn copy_file_fast(src: &amp;Path, dst: &amp;Path) -&gt; Result&amp;lt;(), Error&gt; {
    let src_file = tokio::fs::File::open(src).await?;
    let dst_file = tokio::fs::File::create(dst).await?;

    let mut reader = BufReader::with_capacity(64 * 1024, src_file);
    let mut writer = BufWriter::with_capacity(64 * 1024, dst_file);

    tokio::io::copy(&amp;mut reader, &amp;mut writer).await?;
    writer.flush().await?;

    Ok(())
}</code></pre>
<p>å†…å­˜æ˜ å°„æ–‡ä»¶æä¾›å¯¹å¤§å‹åªè¯»æ•°æ®é›†çš„é›¶æ‹·è´è®¿é—®ï¼š</p>
<pre><code class="language-rust">use memmap2::Mmap;</code></pre>
<pre><code class="language-rust">struct MmapDatabase {
    mmap: Mmap,
    index: HashMap&amp;lt;u64, usize&gt;, // block_number -&gt; offset
}
impl MmapDatabase {
    fn new(path: &amp;Path) -&gt; Result&amp;lt;Self, Error&gt; {
        let file = std::fs::File::open(path)?;
        let mmap = unsafe { Mmap::map(&amp;file)? };

        let index = Self::build_index(&amp;mmap)?;

        Ok(Self { mmap, index })
    }

    fn get_block(&amp;self, block_number: u64) -&gt; Option&amp;lt;&amp;[u8]&gt; {
        let offset = *self.index.get(&amp;block_number)?;
        let length = u32::from_le_bytes([
            self.mmap[offset],
            self.mmap[offset + 1],
            self.mmap[offset + 2],
            self.mmap[offset + 3],
        ]) as usize;

        Some(&amp;self.mmap[offset + 4..offset + 4 + length]) // é›¶æ‹·è´è¯»å–
    }
}</code></pre>
<p>è¿æ¥æ± æœ‰æ•ˆåœ°ç®¡ç†æ•°æ®åº“èµ„æºï¼š</p>
<pre><code class="language-rust">use deadpool_postgres::{Config, Pool};</code></pre>
<pre><code class="language-rust">struct DatabaseManager {
    pool: Pool,
}
impl DatabaseManager {
    async fn new(database_url: &amp;str) -&gt; Result&amp;lt;Self, Error&gt; {
        let mut cfg = Config::new();
        cfg.url = Some(database_url.to_string());
        cfg.pool = Some(deadpool_postgres::PoolConfig {
            max_size: 20,           // æœ€å¤š20ä¸ªè¿æ¥
            timeouts: deadpool_postgres::Timeouts {
                wait: Some(Duration::from_secs(5)),
                create: Some(Duration::from_secs(5)),
                recycle: Some(Duration::from_secs(5)),
            },
        });

        let pool = cfg.create_pool(Some(Runtime::Tokio1), tokio_postgres::NoTls)?;

        Ok(Self { pool })
    }

    async fn execute_query(&amp;self, query: &amp;str) -&gt; Result&amp;lt;Vec&amp;lt;Row&gt;, Error&gt; {
        let client = self.pool.get().await?; // ä»æ± ä¸­è·å–è¿æ¥
        let rows = client.query(query, &amp;[]).await?;
        Ok(rows) // è¿æ¥è‡ªåŠ¨è¿”å›æ± 
    }
}</code></pre>
<h2>ğŸ“Š æ€§èƒ½åˆ†æå’ŒåŸºå‡†æµ‹è¯•ï¼šæµ‹é‡é‡è¦çš„å†…å®¹</h2>
<p>æ²¡æœ‰æµ‹é‡çš„ä¼˜åŒ–åªæ˜¯çŒœæµ‹ã€‚ç³»ç»Ÿæ€§çš„æ€§èƒ½åˆ†æå’ŒåŸºå‡†æµ‹è¯•æä¾›äº†åšå‡ºæ˜æ™ºä¼˜åŒ–å†³ç­–æ‰€éœ€çš„æ•°æ®ã€‚</p>
<p>ä½¿ç”¨Criterionè¿›è¡Œå¾®åŸºå‡†æµ‹è¯•èƒ½å®ç°ç²¾ç¡®çš„æ€§èƒ½æµ‹é‡ï¼š</p>
<pre><code class="language-rust">use criterion::{black_box, criterion_group, criterion_main, Criterion, BenchmarkId};</code></pre>
<pre><code class="language-rust">fn benchmark_signature_recovery(c: &amp;mut Criterion) {
    let mut group = c.benchmark_group("signature_recovery");

    // æµ‹è¯•ä¸åŒè¾“å…¥å¤§å°
    for size in [100, 1000, 10000].iter() {
        let transactions = create_test_transactions(*size);

        group.bench_with_input(
            BenchmarkId::new("sequential", size),
            &amp;transactions,
            |b, txs| {
                b.iter(|| {
                    for tx in txs {
                        black_box(recover_signer(
                            black_box(tx.signature_hash()),
                            black_box(&amp;tx.signature)
                        ));
                    }
                })
            }
        );

        group.bench_with_input(
            BenchmarkId::new("parallel", size),
            &amp;transactions,
            |b, txs| {
                b.iter(|| {
                    black_box(txs.par_iter().map(|tx| {
                        recover_signer(tx.signature_hash(), &amp;tx.signature)
                    }).collect::&amp;lt;Vec&amp;lt;_&gt;&gt;())
                })
            }
        );
    }

    group.finish();
}</code></pre>
<p>è¿è¡Œæ—¶æ€§èƒ½åˆ†æä¸ç»“æ„åŒ–æ—¥å¿—ä¸€èµ·æ­ç¤ºäº†ç”Ÿäº§ä¸­çš„æ€§èƒ½ç“¶é¢ˆï¼š</p>
<pre><code class="language-rust">use tracing::{instrument, info_span, info};</code></pre>
<pre><code class="language-rust">// è‡ªåŠ¨å‡½æ•°è®¡æ—¶å’Œç»“æ„åŒ–æ—¥å¿—è®°å½•
#[instrument(skip(transactions), fields(tx_count = transactions.len()))]
async fn process_block(transactions: &amp;[Transaction]) -&gt; Result&amp;lt;Vec&amp;lt;Receipt&gt;, Error&gt; {
    info!("Starting block processing");

    let receipts = {
        let _span = info_span!("signature_recovery").entered();
        recover_all_senders(transactions).await?
    };

    let validated = {
        let _span = info_span!("validation").entered();
        validate_transactions(&amp;receipts).await?
    };

    info!("Block processing completed successfully");
    Ok(validated)
}</code></pre>
<p>è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†å¯ä»¥è·Ÿè¸ªæ€§èƒ½å˜åŒ–ï¼š</p>
<pre><code class="language-rust">use std::sync::atomic::{AtomicU64, Ordering};</code></pre>
<pre><code class="language-rust">static PROCESSED_TRANSACTIONS: AtomicU64 = AtomicU64::new(0);
static PROCESSING_TIME_NANOS: AtomicU64 = AtomicU64::new(0);
#[instrument]
async fn process_transaction(tx: &amp;Transaction) -&gt; Result&amp;lt;Receipt, Error&gt; {
    let start = std::time::Instant::now();

    let result = execute_transaction(tx).await;

    let elapsed = start.elapsed();
    PROCESSED_TRANSACTIONS.fetch_add(1, Ordering::Relaxed);
    PROCESSING_TIME_NANOS.fetch_add(elapsed.as_nanos() as u64, Ordering::Relaxed);

    if PROCESSED_TRANSACTIONS.load(Ordering::Relaxed) % 1000 == 0 {
        let total_processed = PROCESSED_TRANSACTIONS.load(Ordering::Relaxed);
        let total_time = PROCESSING_TIME_NANOS.load(Ordering::Relaxed);

        info!("Performance: {} tx/s, avg {} Î¼s/tx",
              total_processed * 1_000_000_000 / total_time,
              (total_time / total_processed) / 1000);
    }

    result
}</code></pre>
<h2>âš™ï¸ ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šåˆ©ç”¨Rustçš„ç±»å‹ç³»ç»Ÿ</h2>
<p>Rustå¼ºå¤§çš„ç¼–è¯‘æ—¶èƒ½åŠ›å®ç°åœ¨è¿è¡Œæ—¶å®Œå…¨æ¶ˆé™¤å¼€é”€çš„ä¼˜åŒ–ã€‚è¿™äº›æŠ€æœ¯å°†è®¡ç®—å’Œå®‰å…¨æ£€æŸ¥ä»è¿è¡Œæ—¶è½¬ç§»åˆ°äº†ç¼–è¯‘æ—¶ã€‚</p>
<p>å¸¸é‡æ³›å‹æä¾›äº†é›¶æˆæœ¬æŠ½è±¡ï¼Œç”¨äºæ•°ç»„å¤§å°å’Œå…¶ä»–ç¼–è¯‘æ—¶å¸¸é‡ï¼š</p>
<pre><code class="language-rust">// ç¼–è¯‘æ—¶æ•°ç»„å¤§å°æ¶ˆé™¤èŒƒå›´æ£€æŸ¥
struct FixedRingBuffer&amp;lt;T, const N: usize&gt; {
    data: [Option&amp;lt;T&gt;; N],
    head: usize,
    tail: usize,
}</code></pre>
<pre><code class="language-rust">impl&amp;lt;T, const N: usize&gt; FixedRingBuffer&amp;lt;T, N&gt; {
    const fn new() -&gt; Self {
        Self {
            data: [const { None }; N], // å¸¸é‡é‡å¤
            head: 0,
            tail: 0,
        }
    }

    const fn capacity(&amp;self) -&gt; usize {
        N // ç¼–è¯‘æ—¶å·²çŸ¥ï¼Œæ— è¿è¡Œæ—¶æˆæœ¬
    }

    fn push(&amp;mut self, item: T) -&gt; Result&amp;lt;(), T&gt; {
        if self.is_full() {
            Err(item)
        } else {
            self.data[self.tail] = Some(item);
            self.tail = (self.tail + 1) % N; // æ¨¡è¿ç®—ç”±ç¼–è¯‘å™¨ä¼˜åŒ–
            Ok(())
        }
    }
}

// ä¸åŒå¤§å°çš„ç¼“å†²åŒºä¸ºä¸åŒç±»å‹
type SmallBuffer&amp;lt;T&gt; = FixedRingBuffer&amp;lt;T, 16&gt;;
type LargeBuffer&amp;lt;T&gt; = FixedRingBuffer&amp;lt;T, 1024&gt;;</code></pre>
<p>ç¼–è¯‘æ—¶è®¡ç®—æ¶ˆé™¤è¿è¡Œæ—¶è®¡ç®—ï¼š</p>
<pre><code class="language-rust">const fn compute_optimal_batch_size(max_memory: usize, item_size: usize) -&gt; usize {
    let max_items = max_memory / item_size;
    next_power_of_two(max_items.min(1024))
}</code></pre>
<pre><code class="language-rust">const fn next_power_of_two(n: usize) -&gt; usize {
    if n &amp;lt;= 1 {
        1
    } else {
        1 &amp;lt;&amp;lt; (usize::BITS - (n - 1).leading_zeros())
    }
}</code></pre>
<p>// åœ¨ç¼–è¯‘æ—¶è®¡ç®—
const OPTIMAL_BATCH_SIZE: usize = compute_optimal_batch_size(64 * 1024, 128);</p>
<pre><code>
ç±»å‹çº§ç¼–ç¨‹åœ¨ç¼–è¯‘æ—¶å¼ºåˆ¶çº¦æŸï¼š

```rust
use std::marker::PhantomData;</code></pre>
<pre><code class="language-rust">// ç¼–è¯‘æ—¶çŠ¶æ€è·Ÿè¸ª
trait TransactionState {}
struct Unvalidated;
struct Validated;
struct Executed;
impl TransactionState for Unvalidated {}
impl TransactionState for Validated {}
impl TransactionState for Executed {}
struct Transaction&amp;lt;State: TransactionState&gt; {
    data: TransactionData,
    _state: PhantomData&amp;lt;State&gt;,
}
impl Transaction&amp;lt;Unvalidated&gt; {
    fn new(data: TransactionData) -&gt; Self {
        Self {
            data,
            _state: PhantomData,
        }
    }

    fn validate(self) -&gt; Result&amp;lt;Transaction&amp;lt;Validated&gt;, ValidationError&gt; {
        if self.data.is_valid() {
            Ok(Transaction {
                data: self.data,
                _state: PhantomData,
            })
        } else {
            Err(ValidationError::Invalid)
        }
    }
}
impl Transaction&amp;lt;Validated&gt; {
    fn execute(self) -&gt; Result&amp;lt;(Transaction&amp;lt;Executed&gt;, Receipt), ExecutionError&gt; {
        let receipt = execute_transaction(&amp;self.data)?;

        Ok((
            Transaction {
                data: self.data,
                _state: PhantomData,
            },
            receipt,
        ))
    }
}

// ç¼–è¯‘æ—¶å¼ºåˆ¶æ‰§è¡Œé˜²æ­¢é”™è¯¯ä½¿ç”¨
fn process_transaction(tx: Transaction&amp;lt;Unvalidated&gt;) -&gt; Result&amp;lt;Receipt, ProcessingError&gt; {
    let validated_tx = tx.validate()?; // å¿…é¡»å…ˆéªŒè¯
    let (executed_tx, receipt) = validated_tx.execute()?; // ç„¶åæ‰§è¡Œ

    // ä¸èƒ½æ„å¤–ä½¿ç”¨æœªéªŒè¯äº¤æ˜“è¿›è¡Œæ‰§è¡Œ
    // let receipt = tx.execute(); // âŒ ç¼–è¯‘é”™è¯¯!

    Ok(receipt)
}</code></pre>
<h2>ğŸ¯ æˆ˜ç•¥åº”ç”¨ï¼šä½•æ—¶ä»¥åŠå¦‚ä½•ä¼˜åŒ–</h2>
<p>å¹¶éæ‰€æœ‰ä¼˜åŒ–éƒ½æä¾›ç›¸ç­‰çš„ä»·å€¼ã€‚ç†è§£ä½•æ—¶ä»¥åŠå¦‚ä½•åº”ç”¨æ¯ç§æŠ€æœ¯å¯ä»¥æœ€å¤§åŒ–å½±å“ï¼ŒåŒæ—¶æœ€å°åŒ–å¼€å‘å·¥ä½œã€‚</p>
<h2>æ€§èƒ½å½±å“çŸ©é˜µ</h2>
<p>æœ€æœ‰æ•ˆçš„ä¼˜åŒ–ç»“åˆäº†é«˜æ€§èƒ½å½±å“å’Œä½å®ç°åŠªåŠ›ï¼š</p>
<p><strong>é«˜å½±å“ï¼Œä½åŠªåŠ›ï¼ˆä»è¿™é‡Œå¼€å§‹ï¼‰ï¼š</strong></p>
<ul>
<li>é›¶æ‹·è´æ“ä½œï¼šç”¨å¼•ç”¨æ›¿æ¢æ‹¥æœ‰çš„å€¼</li>
<li>é¢„åˆ†é…ï¼šå¯¹å·²çŸ¥å¤§å°ä½¿ç”¨<code>with_capacity()</code></li>
<li>æ‰¹å¤„ç†æ“ä½œï¼šå°†æ•°æ®åº“å’ŒI/Oæ“ä½œåˆ†ç»„</li>
<li>åŸºæœ¬æ€§èƒ½åˆ†æï¼šä¸ºå…³é”®å‡½æ•°æ·»åŠ æ’è£…</li>
</ul>
<p><strong>é«˜å½±å“ï¼Œä¸­ç­‰åŠªåŠ›ï¼ˆä¸‹ä¸€ä¸ªä¼˜å…ˆçº§ï¼‰ï¼š</strong></p>
<ul>
<li>å¹¶è¡Œå¤„ç†ï¼šä½¿ç”¨Rayonæ‰§è¡ŒCPUå¯†é›†å‹å·¥ä½œ</li>
<li>æµåª’ä½“ï¼šç”¨è¿­ä»£å™¨æ›¿æ¢å¤§æ•°æ®é›†çš„collect()</li>
<li>å†…å­˜å¸ƒå±€ä¼˜åŒ–ï¼šé‡æ–°ç»„ç»‡çƒ­æ•°æ®ç»“æ„</li>
<li>æƒ°æ€§è¯„ä¼°ï¼šæ¨è¿Ÿæ˜‚è´µè®¡ç®—</li>
</ul>
<p><strong>é«˜å½±å“ï¼Œé«˜åŠªåŠ›ï¼ˆé«˜çº§ï¼‰ï¼š</strong></p>
<ul>
<li>ç¼“å­˜å‹å¥½çš„ç»“æ„ï¼šä¸ºç¼“å­˜å±€éƒ¨æ€§è¿›è¡Œå…¨é¢é‡æ–°è®¾è®¡</li>
<li>æ— é”å¹¶å‘ï¼šæ›¿æ¢å…³é”®è·¯å¾„ä¸­çš„äº’æ–¥é”</li>
<li>ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šç±»å‹çº§ç¼–ç¨‹</li>
<li>è‡ªå®šä¹‰åˆ†é…å™¨ï¼šä¸ºç‰¹å®šç”¨ä¾‹è¿›è¡ŒArenaåˆ†é…</li>
</ul>
<h2>å†³ç­–æ¡†æ¶</h2>
<ol>
<li><strong>é¦–å…ˆæµ‹é‡</strong>ï¼šä½¿ç”¨æ€§èƒ½åˆ†æç¡®å®šå®é™…ç“¶é¢ˆ</li>
<li><strong>ä»ç®€å•å¼€å§‹</strong>ï¼šé¦–å…ˆåº”ç”¨ä½åŠªåŠ›ã€é«˜å½±å“çš„ä¼˜åŒ–</li>
<li><strong>éªŒè¯æ”¹è¿›</strong>ï¼šåœ¨æ›´æ”¹ä¹‹å‰å’Œä¹‹åè¿›è¡ŒåŸºå‡†æµ‹è¯•</li>
<li><strong>è€ƒè™‘ç»´æŠ¤</strong>ï¼šåœ¨æ€§èƒ½æå‡çš„åŒæ—¶è€ƒè™‘ç»´æŠ¤æˆæœ¬</li>
</ol>
<h2>ğŸš¨ å¸¸è§é™·é˜±ä¸åæ¨¡å¼</h2>
<p>æˆåŠŸçš„ä¼˜åŒ–éœ€è¦é¿å…å¯èƒ½æµªè´¹å·¥ä½œæˆ–ç”šè‡³æŸå®³æ€§èƒ½çš„å¸¸è§é”™è¯¯ã€‚</p>
<p><strong>è¿‡æ—©ä¼˜åŒ–</strong>ï¼šåœ¨æ²¡æœ‰æµ‹é‡çš„æƒ…å†µä¸‹ä¸è¦ä¼˜åŒ–ã€‚å¯¹å¾ˆå°‘æ‰§è¡Œçš„ä»£ç è¿›è¡Œå¤æ‚ä¼˜åŒ–ä¼šæµªè´¹å¼€å‘æ—¶é—´å¹¶å¢åŠ ç»´æŠ¤è´Ÿæ‹…ã€‚</p>
<p><strong>è¿‡åº¦å·¥ç¨‹</strong>ï¼šç®€å•ã€ç›´æ¥çš„å®ç°é€šå¸¸ä¼˜äºå¤æ‚çš„æŠ½è±¡ã€‚é’ˆå¯¹å®é™…ç”¨ä¾‹è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä¸æ˜¯ç†è®ºåœºæ™¯ã€‚</p>
<p><strong>å¿½è§†80/20è§„åˆ™</strong>ï¼šå¤§éƒ¨åˆ†æ€§èƒ½æå‡æ¥è‡ªäºä¼˜åŒ–ä»£ç çš„ä¸€å°éƒ¨åˆ†ã€‚ä½¿ç”¨æ€§èƒ½åˆ†æè¯†åˆ«çƒ­è·¯å¾„ï¼Œå¹¶åœ¨æ­¤é›†ä¸­ç²¾åŠ›ã€‚</p>
<p><strong>å¾®ä¼˜åŒ–è€Œå¿½è§†ç®—æ³•å¤æ‚æ€§</strong>ï¼šå…·æœ‰å¾®ä¼˜åŒ–çš„O(nÂ²)ç®—æ³•åœ¨å¤§è¾“å…¥ä¸­ä»ç„¶ä¼šè´¥ç»™æœªä¼˜åŒ–çš„O(n log n)ç®—æ³•ã€‚</p>
<h2>ğŸ“ˆ æˆåŠŸæµ‹é‡ï¼šå…³é”®æŒ‡æ ‡å’ŒåŸºå‡†æµ‹è¯•</h2>
<p>è·Ÿè¸ªæ­£ç¡®çš„æŒ‡æ ‡ä»¥éªŒè¯ä¼˜åŒ–å·¥ä½œï¼š</p>
<p><strong>æ€§èƒ½æŒ‡æ ‡ï¼š</strong></p>
<ul>
<li>ååé‡ï¼šæ¯ç§’æ“ä½œæ¬¡æ•°</li>
<li>å»¶è¿Ÿï¼šå“åº”æ—¶é—´ç™¾åˆ†ä½æ•°ï¼ˆp50ï¼Œp95ï¼Œp99ï¼‰</li>
<li>èµ„æºä½¿ç”¨ï¼šCPUã€å†…å­˜ã€ç£ç›˜I/O</li>
<li>å¯æ‰©å±•æ€§ï¼šåœ¨ä¸åŒè´Ÿè½½ä¸‹çš„æ€§èƒ½</li>
</ul>
<p><strong>å¼€å‘æŒ‡æ ‡ï¼š</strong></p>
<ul>
<li>ç¼–è¯‘æ—¶é—´ï¼šå¯¹å¼€å‘é€Ÿåº¦çš„å½±å“</li>
<li>äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ï¼šéƒ¨ç½²å’Œå¯åŠ¨è€ƒè™‘</li>
<li>ä»£ç å¤æ‚æ€§ï¼šéšæ—¶é—´æ¨ç§»çš„ç»´æŠ¤è´Ÿæ‹…</li>
</ul>
<h2>ğŸ“ å­¦ä¹ è·¯å¾„ï¼šå»ºç«‹ä¼˜åŒ–ä¸“ä¸šçŸ¥è¯†</h2>
<p><strong>åˆå­¦è€…æ°´å¹³ï¼š</strong></p>
<ul>
<li>æŒæ¡RuståŸºç¡€çŸ¥è¯†ï¼šæ‰€æœ‰æƒã€å€Ÿç”¨ã€ç”Ÿå‘½å‘¨æœŸ</li>
<li>å­¦ä¹ ä½¿ç”¨<code>cargo bench</code>å’Œæ—¥å¿—è¿›è¡ŒåŸºæœ¬æ€§èƒ½åˆ†æ</li>
<li>ç»ƒä¹ é›¶æ‹·è´æ¨¡å¼å’Œé¢„åˆ†é…</li>
<li>äº†è§£ä½•æ—¶ä½¿ç”¨å¼•ç”¨ä¸æ‹¥æœ‰çš„å€¼</li>
</ul>
<p><strong>ä¸­çº§æ°´å¹³ï¼š</strong></p>
<ul>
<li>å­¦ä¹ Rayonå’ŒTokioçš„å¹¶è¡Œå¤„ç†</li>
<li>å­¦ä¹ å†…å­˜å¸ƒå±€åŸç†å’Œç¼“å­˜è¡Œä¸º</li>
<li>ç»ƒä¹ æµåª’ä½“å’Œæƒ°æ€§è¯„ä¼°æ¨¡å¼</li>
<li>äº†è§£æ•°æ®åº“ä¼˜åŒ–æŠ€æœ¯</li>
</ul>
<p><strong>é«˜çº§æ°´å¹³ï¼š</strong></p>
<ul>
<li>æŒæ¡æ— é”ç¼–ç¨‹å’ŒåŸå­æ“ä½œ</li>
<li>å­¦ä¹ ç‰¹å®šé¢†åŸŸçš„SIMDç¼–ç¨‹</li>
<li>å®ç°è‡ªå®šä¹‰åˆ†é…å™¨å’Œå†…å­˜ç®¡ç†</li>
<li>å­¦ä¹ ä½¿ç”¨å¸¸é‡æ³›å‹å’Œå®è¿›è¡Œç¼–è¯‘æ—¶ç¼–ç¨‹</li>
</ul>
<p><strong>ä¸“å®¶çº§æ°´å¹³ï¼š</strong></p>
<ul>
<li>ç†è§£ç³»ç»Ÿçº§ä¼˜åŒ–ï¼šNUMAã€CPUæ‹“æ‰‘</li>
<li>å¼€å‘ç‰¹å®šé¢†åŸŸçš„ä¼˜åŒ–ç­–ç•¥</li>
<li>æ„å»ºè‡ªå®šä¹‰æ€§èƒ½åˆ†æå’Œä¼˜åŒ–å·¥å…·</li>
<li>æŒ‡å¯¼ä»–äººå¹¶ä¸ºæ›´å¹¿æ³›çš„ç¤¾åŒºåšå‡ºè´¡çŒ®</li>
</ul>
<h2>ğŸ”— ç°å®åº”ç”¨ï¼šæ¥è‡ªRethçš„æ•™è®­</h2>
<p>è¿™äº›ä¼˜åŒ–æŠ€æœ¯ä¸æ˜¯ç†è®ºçš„â€”â€”é€šè¿‡Rethçš„å®ç°ï¼Œå®ƒä»¬å·²åœ¨ç”Ÿäº§ä¸­å¾—åˆ°éªŒè¯ã€‚Rethå±•ç¤ºäº†ç³»ç»Ÿä¼˜åŒ–çš„åŠ›é‡ï¼š</p>
<ul>
<li><strong>é›¶æ‹·è´</strong>ï¼šåœ¨ä¸å¿…è¦çš„å…‹éš†çš„æƒ…å†µä¸‹å¤„ç†äº¤æ˜“</li>
<li><strong>å¹¶è¡Œå¤„ç†</strong>ï¼šç­¾åæ¢å¤åˆ†å¸ƒåœ¨CPUæ ¸å¿ƒä¹‹é—´</li>
<li><strong>æµåª’ä½“</strong>ï¼šåŒºå—åŒæ­¥æ— éœ€åŠ è½½æ•´ä¸ªåŒºå—é“¾</li>
<li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šçŠ¶æ€è®¿é—®çš„å¤šçº§ç¼“å­˜</li>
<li><strong>æ•°æ®åº“æ‰¹å¤„ç†</strong>ï¼šé«˜æ•ˆçš„MDBXæ“ä½œæœ€å°åŒ–I/O</li>
<li><strong>ç¼–è¯‘æ—¶å®‰å…¨</strong>ï¼šç±»å‹å®‰å…¨çš„å…±è¯†çŠ¶æ€è½¬å˜</li>
</ul>
<p>ç»“æœä¸è¨€è€Œå–»ï¼šåŒæ­¥é€Ÿåº¦æ¯”å…¶ä»–Ethereumå®¢æˆ·ç«¯å¿«2-5å€ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘30-50%ï¼ŒRPCå“åº”æ—¶é—´ä½äºæ¯«ç§’ï¼Œå¹¶èƒ½å¤Ÿæ¯ç§’å¤„ç†è¶…è¿‡10,000ä¸ªè¯·æ±‚ã€‚</p>
<h2>ç»“è®ºï¼šé€šå¾€æ€§èƒ½çš„é“è·¯</h2>
<p>è¿™äº›ä¼˜åŒ–æŠ€æœ¯å¦‚æœç³»ç»Ÿåº”ç”¨å¹¶ä»”ç»†æµ‹é‡ï¼Œå¯ä»¥æ”¹å˜ä»»ä½•Ruståº”ç”¨ç¨‹åºçš„æ€§èƒ½ç‰¹å¾ã€‚å…³é”®åŸåˆ™æ˜¯ï¼š</p>
<ol>
<li><strong>é¦–å…ˆæµ‹é‡</strong>ï¼šä½¿ç”¨æ€§èƒ½åˆ†æç¡®å®šå®é™…ç“¶é¢ˆå†è¿›è¡Œä¼˜åŒ–</li>
<li><strong>ä»ç®€å•å¼€å§‹</strong>ï¼šé¦–å…ˆåº”ç”¨é«˜å½±å“ã€ä½åŠªåŠ›çš„ä¼˜åŒ–</li>
<li><strong>éªŒè¯ä¸€åˆ‡</strong>ï¼šå¯¹æ”¹è¿›è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œä»¥ç¡®ä¿å…¶æä¾›å®é™…ä»·å€¼</li>
<li><strong>å¹³è¡¡æƒè¡¡</strong>ï¼šåœ¨è€ƒè™‘æ€§èƒ½æå‡çš„åŒæ—¶è€ƒè™‘ç»´æŠ¤æˆæœ¬</li>
</ol>
<p>è®°ä½ï¼Œè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºï¼Œä½†æˆç†Ÿçš„ä¼˜åŒ–æ˜¯æ‰€æœ‰æ€§èƒ½çš„æ ¹æºã€‚ä»æ­£ç¡®ã€ç®€å•çš„ä»£ç å¼€å§‹ï¼Œç„¶ååœ¨æµ‹é‡æ˜¾ç¤ºå®ƒä»¬å°†äº§ç”Ÿæœ€å¤§æ•ˆåº”çš„åœ°æ–¹åº”ç”¨è¿™äº›æŠ€æœ¯ã€‚</p>
<p>Rustçš„é›¶æˆæœ¬æŠ½è±¡ã€å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿå’Œå†…å­˜å®‰å…¨ä¿è¯ä¸ºæ„å»ºé«˜æ€§èƒ½ç³»ç»Ÿæä¾›äº†å“è¶Šçš„åŸºç¡€ã€‚é€šè¿‡æŒæ¡è¿™äº›ä¼˜åŒ–æŠ€æœ¯ï¼Œä½ å¯ä»¥é‡Šæ”¾Rustçš„å…¨éƒ¨æ½œåŠ›ï¼Œå¹¶æ„å»ºå‡ºè®¾ç«‹æ€§èƒ½ä¸æ•ˆç‡æ–°æ ‡å‡†çš„åº”ç”¨ç¨‹åºã€‚</p>
<blockquote>
<ul>
<li>åŸæ–‡é“¾æ¥ï¼š <a href="https://extremelysunnyyk.medium.com/unofficial-guide-to-rust-optimization-techniques-ec3bd54c5bc0">extremelysunnyyk.medium....</a></li>
<li>ç™»é“¾ç¤¾åŒº AI åŠ©æ‰‹ï¼Œä¸ºå¤§å®¶è½¬è¯‘ä¼˜ç§€è‹±æ–‡æ–‡ç« ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸é€šçš„åœ°æ–¹ï¼Œè¿˜è¯·åŒ…æ¶µï½</li>
</ul>
</blockquote>                        </div>
                    
                    
                    <div class="post-opt mt-30" style="font-size: 12px;color: #686968">
                        <ul class="list-inline text-muted mb-20">
                            <li>
                                                                                                            <a class="tag" href="https://extremelysunnyyk.medium.com/unofficial-guide-to-rust-optimization-techniques-ec3bd54c5bc0" target="_blank" style="color: #0767c8;background-color: transparent;border: 1px solid #0767c8;box-sizing: border-box;line-height: 22px;">ç¿»è¯‘</a>
                                                                                                </li>


                            <li style="color: #686968" id="article-coins" data-coins_num="125">å­¦åˆ†: 125</li>
                            <li></li>
                                                            <li style="color: #686968">åˆ†ç±»: <a style="font-size: 12px;" class="tag-grey" href="https://learnblockchain.cn/categories/rust" target="_blank">Rust </a></li>
                                                        <li></li>
                                                            <li style="color: #686968">æ ‡ç­¾:
                                                                                                                        <a style="font-size: 12px;"  class="tag" href="https://learnblockchain.cn/tags/Rust">Rust</a>&nbsp;
                                                                                                                                                                <a style="font-size: 12px;"  class="tag" href="https://learnblockchain.cn/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">æ€§èƒ½ä¼˜åŒ–</a>&nbsp;
                                                                                                                                                                <a style="font-size: 12px;"  class="tag" href="https://learnblockchain.cn/tags/%E9%9B%B6%E6%8B%B7%E8%B4%9D">é›¶æ‹·è´</a>&nbsp;
                                                                                                                                                                <a style="font-size: 12px;"  class="tag" href="https://learnblockchain.cn/tags/%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80">å†…å­˜å¸ƒå±€</a>&nbsp;
                                                                                                                                                                <a style="font-size: 12px;"  class="tag" href="https://learnblockchain.cn/tags/%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86">å¹¶è¡Œå¤„ç†</a>&nbsp;
                                                                                                                                                                <a style="font-size: 12px;"  class="tag" href="https://learnblockchain.cn/tags/%E7%BC%93%E5%AD%98">ç¼“å­˜</a>&nbsp;
                                                                                                            </li>
                                                                                                            </ul>

                                            </div>
                </div>
                            </div>

            <div><div style="position: absolute;width: 100%;left: 0;background: linear-gradient(180deg, #FAFAFA 0%, #FFFFFF 100%);height:5px"></div></div>

            <div class="feature_container">
                <div class="feature">
                    <div id="support_button" data-source_id="15814" data-source_type="article"  data-support_num="1">
                        <div></div>
                        <span>ç‚¹èµ 1</span>
                    </div>

                    <div id="collect_button" data-loading-text="åŠ è½½ä¸­..." data-collection_num="1" data-source_type = "article" data-source_id = "15814">
                                                    <div></div>
                            <span>æ”¶è— 1</span>
                                            </div>

                    <input id="article_share_link" style="position: absolute; top: 0; left: 0; opacity: 0; z-index: -10;" value="https://learnblockchain.cn/article/15814">

                    <div style="position: relative;">
                        <div id="share_button">
                            <div></div>
                            <span>åˆ†äº«</span>
                        </div>
                        <div class="share" style="display: none;">
                            <div>
                                <div class="share_link">
                                    <img src="/css/default/copy_link.svg">
                                    <span>å¤åˆ¶é“¾æ¥</span>
                                </div>
                                <div class="share_twitter">
                                    <img src="/css/default/twitter.svg">
                                    <span>Twitteråˆ†äº«</span>
                                </div>
                                <div class="share_weixin">
                                    <img src="/css/default/weixin.svg">
                                    <span>å¾®ä¿¡æ‰«ç åˆ†äº«</span>
                                </div>
                                <div id="qrcode"></div>

                                <span class="shape_out"></span>
                                <span class="shape_in"></span>
                            </div>
                        </div>
                    </div>
                </div>

                                    <div class="mt-20">
                        æœ¬æ–‡å‚ä¸<a class="" href="https://learnblockchain.cn/site/coins">ç™»é“¾ç¤¾åŒºå†™ä½œæ¿€åŠ±è®¡åˆ’</a> ï¼Œå¥½æ–‡å¥½æ”¶ç›Šï¼Œæ¬¢è¿æ­£åœ¨é˜…è¯»çš„ä½ ä¹ŸåŠ å…¥ã€‚
                    </div>
                            </div>

            <div><div style="position: absolute;width: 100%;left: 0;background-color: #f6f6f6;height:15px"></div></div>

            <div class="widget-relation" style="padding-top: 25px;border-top:none;">
                                <div class="row mt-10">
                    <div class="col-xs-12 col-md-6">
                        <ul class="widget-links list-unstyled">
                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust è¿›é˜¶ï¼ˆä¸ƒï¼‰ï¼šä¸ºä»€ä¹ˆ Rust é¡¹ç›®ã€Œå‰æœŸæ…¢ï¼ŒåæœŸå‡ ä¹ä¸å‡ºäº‹ã€" href="https://learnblockchain.cn/article/22550">Rust è¿›é˜¶ï¼ˆä¸ƒï¼‰ï¼šä¸ºä»€ä¹ˆ Rust é¡¹ç›®ã€Œå‰æœŸæ…¢ï¼ŒåæœŸå‡ ä¹ä¸å‡ºäº‹ã€</a>
                                                                                <small class="text-muted">163 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="ä»é›¶æ‰“é€ ç»å…¸æŠ¤çœ¼åŠ©æ‰‹æ¡Œé¢ç¨‹åºï¼šTauri å®æˆ˜æŒ‡å—" href="https://learnblockchain.cn/article/22533">ä»é›¶æ‰“é€ ç»å…¸æŠ¤çœ¼åŠ©æ‰‹æ¡Œé¢ç¨‹åºï¼šTauri å®æˆ˜æŒ‡å—</a>
                                                                                <small class="text-muted">274 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust è¿›é˜¶ï¼ˆå…­ï¼‰ï¼šå“ªäº›æ€§èƒ½é—®é¢˜ï¼Œæ˜¯ Rustã€Œç‹¬æœ‰çš„ã€" href="https://learnblockchain.cn/article/22514">Rust è¿›é˜¶ï¼ˆå…­ï¼‰ï¼šå“ªäº›æ€§èƒ½é—®é¢˜ï¼Œæ˜¯ Rustã€Œç‹¬æœ‰çš„ã€</a>
                                                                                <small class="text-muted">294 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust è¿›é˜¶ï¼ˆäº”ï¼‰ï¼šæ‰€æœ‰æƒï¼Œå…¶å®æ˜¯ä¸€ç§ã€Œèµ„æºè°ƒåº¦æ¨¡å‹ã€" href="https://learnblockchain.cn/article/22510">Rust è¿›é˜¶ï¼ˆäº”ï¼‰ï¼šæ‰€æœ‰æƒï¼Œå…¶å®æ˜¯ä¸€ç§ã€Œèµ„æºè°ƒåº¦æ¨¡å‹ã€</a>
                                                                                <small class="text-muted">345 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust è¿›é˜¶ï¼ˆå››ï¼‰ï¼šasync Rust çš„çœŸå®æ€§èƒ½æ¨¡å‹" href="https://learnblockchain.cn/article/22323">Rust è¿›é˜¶ï¼ˆå››ï¼‰ï¼šasync Rust çš„çœŸå®æ€§èƒ½æ¨¡å‹</a>
                                                                                <small class="text-muted">418 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust è¿›é˜¶ï¼ˆä¸‰ï¼‰ï¼šä¸ºä»€ä¹ˆå†™ä¹…äº†ï¼Œä½ ä¼šå¼€å§‹â€œå…ˆè®¾è®¡ç±»å‹â€" href="https://learnblockchain.cn/article/22302">Rust è¿›é˜¶ï¼ˆä¸‰ï¼‰ï¼šä¸ºä»€ä¹ˆå†™ä¹…äº†ï¼Œä½ ä¼šå¼€å§‹â€œå…ˆè®¾è®¡ç±»å‹â€</a>
                                                                                <small class="text-muted">499 æµè§ˆ</small>
                                    </li>
                                                                                    </ul>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <ul class="widget-links list-unstyled">
                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust è¿›é˜¶ï¼ˆäºŒï¼‰ï¼šå½“ä½ å¼€å§‹å†™å¤æ‚ç³»ç»Ÿï¼ŒRust ä¼šé€¼ä½ æ€è€ƒä»€ä¹ˆ" href="https://learnblockchain.cn/article/22297">Rust è¿›é˜¶ï¼ˆäºŒï¼‰ï¼šå½“ä½ å¼€å§‹å†™å¤æ‚ç³»ç»Ÿï¼ŒRust ä¼šé€¼ä½ æ€è€ƒä»€ä¹ˆ</a>
                                                                                <small class="text-muted">565 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust è¿›é˜¶ï¼ˆä¸€ï¼‰ï¼šä½ å¯èƒ½æ²¡çœŸæ­£ç”¨è¿‡çš„è¯­è¨€èƒ½åŠ›" href="https://learnblockchain.cn/article/22291">Rust è¿›é˜¶ï¼ˆä¸€ï¼‰ï¼šä½ å¯èƒ½æ²¡çœŸæ­£ç”¨è¿‡çš„è¯­è¨€èƒ½åŠ›</a>
                                                                                <small class="text-muted">546 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="ç”¨ Web æŠ€æœ¯ + Rust æ„å»ºæ¡Œé¢ Appï¼šä¸ºä»€ä¹ˆæ¨è Tauri" href="https://learnblockchain.cn/article/22219">ç”¨ Web æŠ€æœ¯ + Rust æ„å»ºæ¡Œé¢ Appï¼šä¸ºä»€ä¹ˆæ¨è Tauri</a>
                                                                                <small class="text-muted">342 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="å¦‚ä½•ä½¿ç”¨ LiteSVM æµ‹è¯• Solana ç¨‹åº" href="https://learnblockchain.cn/article/21985">å¦‚ä½•ä½¿ç”¨ LiteSVM æµ‹è¯• Solana ç¨‹åº</a>
                                                                                <small class="text-muted">588 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rust å¼‚æ­¥ç¼–ç¨‹é™·é˜±ï¼šTokio çš„ tokio::sleep å’Œ thread::sleep åˆ°åº•æœ‰ä½•å¤©å£¤ä¹‹åˆ«ï¼Ÿ" href="https://learnblockchain.cn/article/21603">Rust å¼‚æ­¥ç¼–ç¨‹é™·é˜±ï¼šTokio çš„ tokio::sleep å’Œ thread::sleep åˆ°åº•æœ‰ä½•å¤©å£¤ä¹‹åˆ«ï¼Ÿ</a>
                                                                                <small class="text-muted">1046 æµè§ˆ</small>
                                    </li>
                                                                                                                                <li class="widget-links-item">
                                                                                    <a title="Rustå¼‚æ­¥ç¼–ç¨‹å®æˆ˜ï¼šå½»åº•ææ‡‚å¹¶å‘ã€å¹¶è¡Œä¸Tokioä»»åŠ¡è°ƒåº¦" href="https://learnblockchain.cn/article/21597">Rustå¼‚æ­¥ç¼–ç¨‹å®æˆ˜ï¼šå½»åº•ææ‡‚å¹¶å‘ã€å¹¶è¡Œä¸Tokioä»»åŠ¡è°ƒåº¦</a>
                                                                                <small class="text-muted">1045 æµè§ˆ</small>
                                    </li>
                                                                                    </ul>
                    </div>
                </div>

            </div>
            <div class="widget-answers mt-15">
                <h2 class="h4 post-title">0 æ¡è¯„è®º</h2>
                <div class="collapse widget-comments mb-20" id="comments-article-15814" data-source_type="article" data-source_id="15814">
    <div class="widget-comment-list"></div>
            <div class="widget-comment-form row">
            <div class="col-md-12">
                è¯·å…ˆ <a  href="https://learnblockchain.cn/login">ç™»å½•</a> åè¯„è®º
            </div>
        </div>
    </div>
            </div>

        </div>

        <div class="col-xs-12 col-md-3 side">
            <div class="widget-box" style="display: flex;flex-direction: column;gap: 5px;margin-top: 0;">
                <div style="display: flex;gap: 15px;flex-shrink: 0;">
                    <div>
                                                    <a style="display: inline-block;width: 64px;height: 64px; margin-bottom: 10px;" class="text-left" href="https://learnblockchain.cn/extremelysunnyyk"><img class="avatar-64" src="https://learnblockchain.cn/image/avatar/26148_big.jpg?oViocjOH" alt="Yong kang Chia"></a>
                                            </div>

                    <div style="flex-shrink: 0;max-width: 35%;">
                        <div style="margin-top: 1px;line-height: 1;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                            <b style="margin-right: 15px;font-size: 18px;">Yong kang Chia</b>
                        </div>

                        <div style="line-height: 1;margin-block: 4px 4px;">
                                                    </div>

                        <div>
                            <span class="space-header-item" style="margin-right: 5px;">
                                                                    <span style="display: inline-block;">
                                        <img style="width: 17px;" src="/css/default/github_gra.svg">
                                    </span>
                                                            </span>

                            <span class="space-header-item" style="margin-right: 5px;">
                                                                    <a target="_blank" href=" https://twitter.com/ExtremelySunnYK " style="display: inline-block;">
                                        <img style="width: 17px;" src="/css/default/twitter.svg">
                                    </a>
                                                            </span>
                        </div>
                    </div>

                    <div style="width: 100%;display: flex;justify-content: flex-end;gap: 10px;margin-top: 4px;">

                        
                                                    <div style="width: 64px;width: 64px;flex-shrink: 0;display: flex;justify-content: center;">
                                <button type="button" class="btn btn-success followerUser article_index_button1" data-source_type = "user" data-source_id = "26148"  data-show_num="false" data-toggle="tooltip" data-placement="left" title="" data-original-title="å…³æ³¨åå°†è·å¾—æ›´æ–°æé†’">å…³æ³¨</button>
                            </div>
                                            </div>
                </div>

                <div style="display: flex;gap: 15px;margin-bottom: 10px;">

                                            <a style="text-decoration: none !important;" href="https://learnblockchain.cn/extremelysunnyyk/credits"><b style="color: #0767c8;font-size: 15px;cursor: pointer;">è´¡çŒ®å€¼: 165</b></a>

                        <a style="text-decoration: none !important;" href="https://learnblockchain.cn/extremelysunnyyk/coins"><b style="color: #f0ad4e;font-size: 15px;cursor: pointer;">å­¦åˆ†: 307</b></a>
                                    </div>

                <div style="display: flex;align-items: center;gap: 15px;">

                                            <div style="height: 55px;font-size: 13px;color: #999;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical;"> æ±Ÿæ¹–åªæœ‰ä»–çš„å¤§åï¼Œæ²¡æœ‰ä»–çš„ä»‹ç»ã€‚  </div>
                                    </div>
            </div>

            <div id="toc-container">
            
            <div class="widget-box hidden-xs mt-30" >
                <h2 class="widget-box-title">
                    æ–‡ç« ç›®å½•
                </h2>

                <div class="" id="toc-content">
                </div>
            </div>

                            <div class="widget-box" style="padding: 0;">
                    <a style="display: block; width: 100%;" title="çº¿ä¸‹é›†è®­è¥" href="https://learnblockchain.cn/openspace/1" target="_blank">
                        <img style="object-fit: cover; width: 100%; border-radius: 3px;" src="https://img.learnblockchain.cn/banners/xQc7wOXX6667cd172abc0.png">
                    </a>
                </div>
            
            </div>

        </div>
    </div>
    </div>
</div>



<footer id="footer">
    <div class="container">

                    <div class="row hidden-xs">

                <dl class="col-sm-2">
                    <dt> å…³äº </dt>
                    <dd><a href="/article/265" target="_blank">å…³äºæˆ‘ä»¬</a></dd>
                    <dd><a href="/article/297" target="_blank">ç¤¾åŒºå…¬çº¦</a></dd>
                    <dd><a href="/article/298" target="_blank">å­¦åˆ†è§„åˆ™</a></dd>
                    <dd>
                        <a href="https://github.com/lbc-team" rel="nofollow norefferrer"  title="Github" target="_blank" > Github</a>
                    </dd>

                </dl>

                <dl class="col-sm-2 site-link">
                    <dt>ä¼™ä¼´ä»¬</dt>
                    <dd><a data-toggle="tooltip" data-placement="top" title="å»ä¸­å¿ƒåŒ–å­¦ä¹ åŠæŠ€èƒ½è®¤è¯å¹³å°" href="https://decert.me/" target="_blank">DeCert</a></dd>
                    <dd><a data-toggle="tooltip" data-placement="top" title="ä¸ºåŒºå—é“¾å¼€å‘è€…å‡†å¤‡çš„å¼€æºå·¥å…·ç®±" href="https://chaintool.tech/" target="_blank">ChainTool</a></dd>
                    <dd><a data-toggle="tooltip" data-placement="top" title="èµ„åŠ©å…¨çƒåè¯­ç¤¾åŒºå…¬å…±ç‰©å“çš„æèµ å‹åŸºé‡‘" href="https://www.gccofficial.org/" target="_blank">GCC</a></dd>
                    <dd><a data-toggle="tooltip" data-placement="top" title="UpChain" href="https://www.upchain.pro" target="_blank">UpChain</a></dd>
                </dl>

                <dl class="col-sm-2 text-center">
                    <dt>åˆä½œ</dt>
                    <dd><a href="/article/4458" target="_blank">å¹¿å‘ŠæŠ•æ”¾</a></dd>
                    <dd><a href="/courses" target="_blank">å‘å¸ƒè¯¾ç¨‹</a></dd>
                    <dd><a href="/article/5650" target="_blank">è”ç³»æˆ‘ä»¬</a></dd>
                    <dd><a href="/friends/" target="_blank">å‹æƒ…é“¾æ¥</a></dd>
                </dl>

                <dl class="col-sm-2 text-center">
                    <dt>å…³æ³¨ç¤¾åŒº</dt>
                    <dd><a href="https://discord.gg/hRZrM92hfw" target="_blank">Discord</a></dd>
                    <dd><a href="https://twitter.com/UpchainDAO" target="_blank">Twitter</a></dd>
                    <dd><a href="https://www.youtube.com/@upchain" target="_blank">Youtube</a></dd>
                    <dd><a href="https://space.bilibili.com/581611011" target="_blank">B ç«™</a></dd>
                </dl>

                <dl class="col-sm-2 text-center">
                    <dt>å…¬ä¼—å·</dt>

                    <dd >
                        <img src="https://img.learnblockchain.cn/qrcode/dlsq-qrcode.jpg" class="app-qrcode">
                        <div>
                            <p>å…³æ³¨ä¸é”™è¿‡åŠ¨æ€</p>
                        </div>
                    </dd>
                </dl>


                <dl class="col-sm-2 text-center" id="license">
                    <dt>å¾®ä¿¡ç¾¤</dt>
                    <dd class="text-center">
                        <img src="https://img.learnblockchain.cn/attachments/2024/03/LXatRfGs65e58b8734830.png" class="app-qrcode">
                        <div>
                            <p>åŠ å…¥æŠ€æœ¯åœˆå­</p>
                        </div>
                    </dd>
                </dl>
            </div>
                <div class="copyright mt-5">
            Â©2025 <a href="https://learnblockchain.cn"> ç™»é“¾ç¤¾åŒº </a> ç‰ˆæƒæ‰€æœ‰ <span class="span-line">|</span>

            Powered By <a href="http://www.tipask.com" rel="noopener external nofollow" target="_blank">Tipask3.5</a><span class="span-line">|</span>
            <script type="text/javascript" src="https://s22.cnzz.com/z_stat.php?id=1265946080&web_id=1265946080"></script>
        </div>
        <div class="copyright">

            <a href="http://www.beian.gov.cn" rel="noopener external nofollow" target="_blank">
                <img src="https://img.learnblockchain.cn/pics/20201202144947.png" style="vertical-align:middle;margin-right:2px;">
                ç²¤å…¬ç½‘å®‰å¤‡ 44049102496617å· </a>
                            <a href="http://beian.miit.gov.cn" rel="noopener external nofollow" target="_blank">ç²¤ICPå¤‡17140514å·</a>
                <a href="https://dxzhgl.miit.gov.cn/dxxzsp/xkz/xkzgl/resource/qiyesearch.jsp?num=%25E7%25B2%25A4B2-20230927&type=xuke" rel="noopener external nofollow" target="_blank">ç²¤B2-20230927</a>
                <a href="https://img.learnblockchain.cn/attachments/2023/09/8FoWAmn064fe6378cea88.jpg" rel="noopener nofollow" target="_blank">å¢å€¼ç”µä¿¡ä¸šåŠ¡ç»è¥è®¸å¯è¯</a>
                    </div>

    </div>
</footer>



<div class="modal fade" id="sendTo_message_model" tabindex="-1"  role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">å‘é€ç§ä¿¡</h4>
            </div>
            <div class="modal-body">
                <div id="docs_recommend" style="margin-bottom: 15px;font-weight: 700; display:none;">è¯·å°†æ–‡æ¡£é“¾æ¥å‘ç»™æ™“å¨œï¼Œæˆ‘ä»¬ä¼šå°½å¿«å®‰æ’ä¸Šæ¶ï¼Œæ„Ÿè°¢æ‚¨çš„æ¨èï¼</div>
                <form name="messageForm" id="sendTo_message_form">
                    <input type="hidden"  name="_token" value="jokfUyyJMDiQe9I2LxlcAZg08OkWW3lVx3Ps5qJZ">
                    <input type="hidden" id="to_user_id" name="to_user_id" value="0" />
                    <div class="form-group">
                        <label for="to_user_name" class="control-label">å‘ç»™:</label>
                        <span id="to_user_name"></span>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="control-label">å†…å®¹:</label>
                        <textarea class="form-control" id="message-text" name="content"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" id="sendTo_submit">å‘é€</button>
            </div>
        </div>
    </div>
</div>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://img.learnblockchain.cn/static/js/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://img.learnblockchain.cn/static/css/bootstrap/js/bootstrap.min.js"></script>

<script type="text/javascript">
    var is_login = Boolean("");

    // $(document).ready(function() {
    //     $(".release_button").hover(
    //         function(){
    //             $('.release').show()
    //         },

    //         function(){
    //             $('.release').hide()
    //         }
    //     )

    //     $(".release").hover(
    //         function(){
    //             $('.release').show()
    //         },

    //         function(){
    //             $('.release').hide()
    //         }
    //     )

    //     $(".release a").hover(
    //         function(){
    //             $(this).find(".image").hide()
    //             $(this).find(".image_hover").show()
    //         },

    //         function(){
    //             $(this).find(".image_hover").hide()
    //             $(this).find(".image").show()
    //         }
    //     )
    // })
    

</script>
<script src="https://learnblockchain.cn/js/global.js?v=20250704"></script>
    <div class="modal fade" id="send_report_model"  role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="reportModalLabel">ä¸¾æŠ¥æ­¤æ–‡ç« </h4>
            </div>
            <div class="modal-body">
                <form name="reportForm" id="report_form" method="post" action="https://learnblockchain.cn/report">
                    <input type="hidden"  name="_token" value="jokfUyyJMDiQe9I2LxlcAZg08OkWW3lVx3Ps5qJZ">
                    <input type="hidden"  name="source_type" value="">
                    <input type="hidden"  name="source_id" value="">
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="1">
                                åƒåœ¾å¹¿å‘Šä¿¡æ¯ï¼š
                                <span class="text-muted">å¹¿å‘Šã€æ¨å¹¿ã€æµ‹è¯•ç­‰å†…å®¹</span>
                            </label>
                        </div>
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="2">
                                è¿è§„å†…å®¹ï¼š
                                <span class="text-muted">è‰²æƒ…ã€æš´åŠ›ã€è¡€è…¥ã€æ•æ„Ÿä¿¡æ¯ç­‰å†…å®¹</span>
                            </label>
                        </div>
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="3">
                                ä¸å‹å–„å†…å®¹ï¼š
                                <span class="text-muted">äººèº«æ”»å‡»ã€æŒ‘è¡…è¾±éª‚ã€æ¶æ„è¡Œä¸º</span>
                            </label>
                        </div>
                                            <div class="radio">
                            <label>
                                <input type="radio" name="report_type" class="reportRadioItem" value="99">
                                å…¶ä»–åŸå› ï¼š
                                <span class="text-muted">è¯·è¡¥å……è¯´æ˜</span>
                            </label>
                        </div>
                                        <div class="form-group" id="report_reason">
                        <label for="message-text" class="control-label">ä¸¾æŠ¥åŸå› :</label>
                        <textarea class="form-control" id="message-text" name="reason"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" id="report_submit_button">ä¸¾æŠ¥</button>
            </div>
        </div>
    </div>
</div>    <div class="modal fade in" id="payment-qrcode-modal-article-15814" tabindex="-1" role="" aria-labelledby="exampleModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                <h4 class="modal-title text-center" id="exampleModalLabel">
                    <img class="avatar-64" src="https://learnblockchain.cn/image/avatar/26148_middle.jpg" alt="Yong kang Chia"></a>
                </h4>
            </div>

            <div class="modal-body text-center">
                <p class="text-md">å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚ä½ çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</p>
                <img class="payment-qrcode" src="https://learnblockchain.cn/image/show" alt="" style="height:300px"><hr>
            </div>

        </div>
    </div>
</div>
    <script src="https://learnblockchain.cn/static/js/mdtoc/md-toc.js?v=3"></script>
    <script type="text/javascript" src="https://learnblockchain.cn/static/js/fancybox/jquery.fancybox.min.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/qrcode.min.js"></script>

    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-breaks/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-math-ssr/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-frontmatter/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-gemoji/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-gfm/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-highlight/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-medium-zoom/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/plugin-mermaid/index.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/bytemd%401.20.2/locales/zh_Hans.js"></script>
    <script type="text/javascript" src="https://learnblockchain.cn/static/js/blockchain@0.2.js"></script>
    <script src="https://img.learnblockchain.cn/static/js/ethers/ethers-5.2.umd.min.js" type="application/javascript"></script>
    <script src="https://img.learnblockchain.cn/static/js/crypto.js"></script>


    
    <script type="text/javascript">
        $(document).ready(function() {
            var column_id = "0";
            var article_id = "15814";
            var invite_code = ""

            var href = window.location.href

            if(href.indexOf('#') != -1){
                window.location.hash = '#æ‹›è˜å‘å¸ƒæ¥å£';
            }

            if("") {
                var message = ""
                if(message.includes("æ–‡ç« å‘å¸ƒæˆåŠŸ")){
                    localStorage.removeItem('bytemd_create_article')
                                    }
            }

            var qrcode = new QRCode(document.getElementById("qrcode"), {
                width: 66,
                height: 66,
                correctLevel : QRCode.CorrectLevel.M
            });

            qrcode.makeCode(window.location.href);

            var plugins = [
                bytemdPluginBreaks(),
                bytemdPluginMathSsr(),
                bytemdPluginFrontmatter(),
                bytemdPluginGemoji(),
                bytemdPluginGfm(),
                bytemdPluginHighlight(),
                bytemdPluginMediumZoom(),
                bytemdPluginMermaid()
            ]

            document.getElementById("md_view").textContent = ''

            var Viewer = new bytemd.Viewer({
                target: document.getElementById("md_view"),
                props: {
                    value: document.getElementById('md_view_content').textContent,
                    plugins: plugins
                }
            });

            $("h1,h2,h3,h4,h5,h6").attr("id", function(i, v){
                return $(this).text(); 
            });

            const youtubeRegExp = /^\s*(https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11}))\s*$/;
            const bilibiliRegExp = /^\s*(https?:\/\/(?:www\.)?bilibili\.com\/video\/([a-zA-Z0-9_-]+)\/?)\s*$/;
            const mp4RegExp = /^\s*(https?:\/\/.+\.mp4)\s*$/;

            $('p').each(function() {
                const $p = $(this);
                const $a = $p.find('a');

                if ($a.length === 1 && $p.contents().filter(function() {
                    return this.nodeType === 3 && $.trim(this.nodeValue) !== '';
                }).length === 0) {
                    const href = $a.attr('href').trim();
                    const text = $a.text().trim();
                    let match;

                    if (href !== text) {
                        return;
                    }

                    match = href.match(youtubeRegExp);
                    if (match) {
                        const videoId = match[2];
                        const iframe = `
                            <iframe style="display: block; margin: auto; width: 70%; aspect-ratio: 16 / 9;"
                            src="https://www.youtube.com/embed/${videoId}" 
                            frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
                            </iframe>
                        `;
                        $p.replaceWith(iframe);
                        return;
                    }

                    match = href.match(bilibiliRegExp);
                    if (match) {
                        const bvId = match[2];
                        const iframe = `
                            <iframe style="display: block; margin: auto; width: 70%; aspect-ratio: 16 / 9;"
                            src="https://player.bilibili.com/player.html?bvid=${bvId}&page=1&autoplay=0" 
                            scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
                            </iframe>
                        `;
                        $p.replaceWith(iframe);
                        return;
                    }

                    match = href.match(mp4RegExp);
                    if (match) {
                        const videoSrc = match[1];
                        const videoPlayer = `
                            <video style="display: block; margin: auto; width: 70%; aspect-ratio: 16 / 9;" controls>
                                <source src="${videoSrc}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        `;
                        $p.replaceWith(videoPlayer);
                    }
                }
            });

            var textElement = '<textarea></textarea>'
            var spanElement = `<span class="copyTooltip"><img src="https://learnblockchain.cn/css/default/copy.svg"></span>`

            $(".markdown-body pre").hover(
                function(){
                    $(this).children(".copyTooltip").show()
                },
                function(){
                    $(this).children(".copyTooltip").hide()
                }
            )

            $('.markdown-body img[title]').each(function() {
                var altText = $(this).attr('title');
                if (altText) {
                    $(this).after('<p style="font-size: 14px;color: #999;text-align: center;">' + altText + '</p>');
                }
            });

            
            $(".markdown-body pre").prepend(textElement,spanElement);

            $(".markdown-body .copyTooltip").click(function(){
                $(this).prev().val($(this).next().text())
                $(this).prev().select();
                document.execCommand("Copy")
            });

            if (typeof window.ethereum !== 'undefined' && window.ethereum) {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                // è·å–ç”¨æˆ·çš„ä»¥å¤ªåŠåœ°å€
                async function getUserAddress() {
                    try {
                        const accounts = await provider.listAccounts();
                        if (accounts.length === 0) {
                            $('#mint_nft').hide()
                            $('#connection').show()
                        } else {
                            $('#connection').hide()
                            $('#mint_nft').show()
                        }
                    } catch(e){
                        console.log(e)
                    }
                }

                getUserAddress();
            }

            $('#connection').click(function(){
                initAccountChain(async (userAddr, curChainId) => {
                    if(userAddr){
                        $('#connection').hide()
                        $('#mint_nft').show()
                    }
                })
            })

            if("") {
                $.get('/column/'+ column_id +'/articles/' + article_id, function (res) {
                    $("#articleList").html(res)

                    var listContainer = $('#articleList'),
                    scrollToContainer = listContainer.find('.activeArticle');
                    listContainer.scrollTop(
                        scrollToContainer.offset().top - listContainer.offset().top + listContainer.scrollTop() - 58
                    );
                    var idList = new Array();
                    var hrefList = new Array();
                    var titleList = new Array();
                    $(".articleLink").each(function(i) {
                        idList[i] = $(this).data('id');
                        hrefList[i] = $(this).attr('href')
                        titleList[i] = $(this).text()
                    });
                    for(var i=0; i<idList.length; i++) {
                        if(idList[i] == article_id){
                            var p = i - 1
                            var n = i + 1
                            $("#previous-button").attr("href", hrefList[p])
                            $("#next-button").attr("href", hrefList[n])
                            if(titleList[p] == null) {
                                $("#previous-button").text("")
                            } else {
                                $("#previous-button").text("Â« " + "ä¸Šä¸€ç¯‡: " + titleList[p])
                            }
                            if(titleList[n] == null) {
                                $("#next-button").text("")
                            } else {
                                $("#next-button").text("ä¸‹ä¸€ç¯‡: " + titleList[n] + " Â»")
                            }
                        }
                    }
                });
            }

            /*è¯„è®ºé»˜è®¤å±•å¼€*/
            load_comments('article',article_id);
            $("#comments-article-"+article_id).collapse('show');

            var hastoc = false;

            var check = function(){
                try {
                    if($('.markdown-body').html() && !hastoc){
                        var div = document.createElement('div');
                        div.innerHTML = $('.markdown-body').html();
                        new Toc(div,{
                            'level':3,
                            'top':200,
                            'class':'toc',
                            'targetId':'toc-content'
                        } );
                        hastoc = true;
                    }
                    else {
                        setTimeout(check, 100); // check again in a second
                    }
                } catch(error) {
                    console.error('ç›®å½•ç”Ÿæˆé”™è¯¯:', error);
                }
            }

            check();
            var toc = $("#toc-container");
            var article_content_height = $('#article_content').outerHeight();

            var maxTop = article_content_height - window.innerHeight;

            window.onscroll = function() {

                var top = $(document).scrollTop();
                if(top < 115) {
                    top = 15;
                } else {
                    top = top -  100;
                    if(top > maxTop) {
                        top = maxTop;
                    }
                }

                toc.css('margin-top', top );
            }


            /*è¯„è®ºæäº¤*/
            $(".comment-btn").click(function(){
                $('.comment-btn').attr('disabled', 'disabled');
                var source_id = $(this).data('source_id');
                var source_type = $(this).data('source_type');
                var to_user_id = $(this).data('to_user_id');
                var token = $(this).data('token');
                var content = $("#comment-"+source_type+"-content-"+source_id).val();
                var review = 0

                var rc = "å‘ç¥¨,V2Ray,Shadowsocks,å¸åœˆ,åœˆå­,çŸ¿åœˆ,é“¾åœˆ,éŸ­èœ,æŠ•èµ„,æœŸè´§,ç‰›å¸‚,ç†Šå¸‚,Kçº¿,kçº¿,K çº¿,è¡Œæƒ…,å‡å€¼,æš´åˆ©,åƒå€å¸,ç™¾å€å¸,é•¿çº¿,çŸ­çº¿,é£å£,å¸ä»·,å¸æ°‘,è´­å…¥,çœ‹å¥½,å¸ƒä»“,æ¸…ä»“,è´¢å¯Œ,æ”¿åºœ,ç°è‰²ç»æµ,åƒåœ¾,å‚»é€¼,å¦ˆé€¼,æ”¾å±,å°¼ç›,åµ,æ¢¯å­,ç¿»å¢™,ç§‘å­¦ä¸Šç½‘,å¸å‹,ç°äº§".split(",");
                for (var i=0; i < rc.length; i++) {
                    if(content.indexOf(rc[i], 0) >= 0 ) {
                        review = 1
                        break;
                    }
                }

                add_comment(token,source_type,source_id,content,to_user_id,review);
                $("#comment-content-"+source_id+"").val('');
            });


            /*æ–‡ç« æ¨è*/
            $("#support_button").click(function() {

                var btn_support = $(this);
                var source_type = btn_support.data('source_type');
                var source_id = btn_support.data('source_id');
                var support_num = parseInt(btn_support.data('support_num'));

                var li_article_coins = $('#article-coins');
                var coins = parseInt(li_article_coins.data('coins_num'));

                $.get('/support/' + source_type + '/' + source_id, function (res) {
                    if(res.code!=0){
                        alert(res.message);
                        return false;
                    }
                    if (res.code==0  && res.message == 'success') {
                        support_num++;
                        if("3" == 0){
                            coins += parseInt(Math.abs("-1"));
                        } else {
                            coins += parseInt("2");
                        }
                        
                    }

                    $("#support_button div").addClass('active')
                    btn_support.children("span").html('å·²èµ ' + support_num);
                    btn_support.data('support_num', support_num);

                    li_article_coins.html('å­¦åˆ† ' + coins);
                    li_article_coins.data('coins_num', coins);

                });
            });

            let loading = false;


            /*æ”¶è—é—®é¢˜æˆ–æ–‡ç« */
            $("#collect_button").click(function(){
                if(loading){
                    return
                }

                loading = true;

                $("#collect_button span").html('åŠ è½½ä¸­...');
                var collection_num = parseInt($("#collect_button").data('collection_num'));
                var source_type = $(this).data('source_type');
                var source_id = $(this).data('source_id');
                $.get('/collect/'+source_type+'/'+source_id,function(msg){
                    if(msg=='collected'){
                        collection_num++;
                        $("#collect_button div").addClass('active');
                        $("#collect_button span").html('å·²æ”¶è— ' + collection_num);
                    }else if(msg=='uncollect'){
                        collection_num--;
                        $("#collect_button div").removeClass('active');
                        $("#collect_button span").html('æ”¶è— ' + collection_num);
                    } else {
                        alert(msg.message);
                        $("#collect_button span").html('æ”¶è— ' + collection_num);
                    }

                    loading = false;

                    $("#collect_button").data('collection_num', collection_num)
                });
            });

            /*è´­ä¹°æ–‡ç« */
            $("#btn-buy-article").click(function(){
                var price = '0';
                if( parseInt(price) > 0  && !confirm('è´­ä¹°å†…å®¹éœ€è¦èŠ±è´¹ï¿¥0.00('+price+'ä¸ªå­¦åˆ†)ï¼Œç¡®å®šç»§ç»­ï¼Ÿ')){
                    return false;
                }
                document.location = "/article/buy/"+ article_id +"?invite_code=" + invite_code;
            });
            /*è´­ä¹°ä¸“æ */
            $(".btn-buy-column").click(function(){
                            });

            $("#hashCopy").click(function(){
                let copyText = document.getElementById("textCopyInput")
                copyText.select()
                document.execCommand('copy')
            })

            $('#copy').click(function(){
                let url = document.querySelector('#copy_discord');
                url.select(); // é€‰æ‹©å¯¹è±¡
                document.execCommand('Copy'); // æ‰§è¡Œæµè§ˆå™¨å¤åˆ¶å‘½ä»¤
                alert("Discordæ ‡ç­¾å·²å¤åˆ¶ï¼Œå¯å‰å¾€Discordæ·»åŠ å¥½å‹");
            })

            $("html").click(function(){
                $(".share").hide()
            })

            $(".share").click(function(even){
                even.stopPropagation();
            })

            $("#share_button").click(function(even){
                even.stopPropagation();
                $(".share").toggle()
            })

            $('.share_twitter').click(function(){
                let timestamp = new Date().getTime();
                let text = "èè¯»: Rust ä¼˜åŒ–æŠ€æœ¯éå®˜æ–¹æŒ‡å—\n--\nè½¬è‡ª #ç™»é“¾ç¤¾åŒº @UpchainDAO"
                let link = "https://twitter.com/intent/tweet?url=" + window.location.href + "&text=" + encodeURIComponent(text)
                                    let author = "ExtremelySunnYK".replace('https://twitter.com/','')
                    if(author.substr(0, 1) == '@'){
                        author = author.slice(1)
                    }
                    text = "èè¯»: Rust ä¼˜åŒ–æŠ€æœ¯éå®˜æ–¹æŒ‡å—\n--\nè½¬è‡ª@" + author + "åœ¨ #ç™»é“¾ç¤¾åŒº @UpchainDAOçš„åˆ†äº«"
                    link = "https://twitter.com/intent/tweet?url=" + window.location.href + "&text=" + encodeURIComponent(text)
                                window.open(link)
            })

            $('.share_link').click(function(){
                let url = document.querySelector('#article_share_link');
                url.select(); // é€‰æ‹©å¯¹è±¡
                document.execCommand('Copy');
                alert("é“¾æ¥å·²å¤åˆ¶")
            })

            $(".mint_toggle").click(function(){
                $('.article_mint_div3').slideToggle();
                let currentRotation = $(this).data('rotation') || 0;
                currentRotation += 180;

                $(this).css({
                    'transform': 'rotate(' + currentRotation + 'deg)'
                });

                $(this).data('rotation', currentRotation);
            })

            $(".free_access").click(async function(){
                $('#mint').hide()
                $('#airdrop').show()
            })

            $('#mint_modal').on('hidden.bs.modal', function() {
                $('#airdrop').hide()
                $('#mint').show()
            });

            $("#mint_nft").click(async function(){

                $('#mint_nft').hide()
                $('#mint_loading').show()

                // let imageIpfs = imageIpfsUpload()
                let r = await $.get('/article/getJsonHash/15814');

                if (r.code > 0) {
                    alert(r.message);
                    $('#mint_loading').hide()
                    $('#mint_nft').show()
                    return
                }

                let uri = r.message
                let tokenId = '15814';
                let origType;

                if('2' == 1) {
                    origType = 0
                } else if('2' == 2) {
                    origType = 1
                }

                initAccountChain(async (userAddr, curChainId) => {
                    if(!userAddr){
                        $('#mint_loading').hide()
                        $('#mint_nft').show()
                    }

                    userAddr = ethers.utils.getAddress(userAddr)
                    console.log('userAddr', userAddr)
                    // è·å–ç­¾å hash 
                    let res = await $.get('/article/getNFTHash/' + tokenId + '/' + userAddr + '/' + uri);
                    if (res.code > 0) {
                        alert(res.message);
                        $('#mint_loading').hide()
                        $('#mint_nft').show()
                        return
                    }

                    let signature = res.message;

                    let POPAddr = '0x6f772e254Ef50e9b462915b66404009c73766350'
                    let chainId = '0x89'

                    // polygon  0x89
                    if (curChainId != chainId) {
                        await switchChain(chainId)
                    }

                    if (await window.ethereum.request({ method: 'eth_chainId' }) == chainId ) {
                        let signer = new ethers.providers.Web3Provider(ethereum).getSigner()
                        let ABI = [
                            "function mint(uint tokenId, address to, uint8 origType, string memory uri, bytes memory signature)"
                        ]
                        let pop = new ethers.Contract(POPAddr, ABI, signer);

                        uri = 'ipfs://' + uri

                        try{
                            let tx = await pop.mint(tokenId, userAddr, origType, uri, signature, {value: 0});
                            console.log(tx.hash);
                            await tx.wait();

                            let link
                            if(chainId == 137) {
                                link = 'https://opensea.io/assets/matic/' + POPAddr + '/' + article_id
                            }

                            if(chainId == 80001) {
                                link = 'https://testnets.opensea.io/assets/mumbai/' + POPAddr + '/' + article_id
                            }

                            $(".minting").hide();
                            $(".minted").show();
                            $('#mint_modal').modal('show');
                            $('.opensea_link').attr('href', link)
                            $('.decert_link').attr('href', 'https://decert.me/' + userAddr)

                        } catch(e) {
                            console.log('mint: ', e)
                            if(e.data && e.data.message && e.data.message.includes('token already minted')) {
                                location.reload();
                            } else if(e.message && e.message.includes('User denied transaction signature')) {
                                alert('äº¤æ˜“è¢«æ‹’ç»');
                            } else {
                                alert('é“¸é€ å¤±è´¥,è¯·ç¨åå†è¯•');
                            }
                            $("#show_mint_modal").attr("disabled",false);

                            $('#mint_loading').hide()
                            $('#mint_nft').show()
                        }
                    } else {
                        alert('ç½‘ç»œåˆ‡æ¢å¤±è´¥, è¯·æ‰“å¼€metamaskç¡®è®¤');

                        $('#mint_loading').hide()
                        $('#mint_nft').show()
                    }
                });

                })

                
        });

        async function createImage() {
            let r = await $.get('/createImage/15814');
            $('.nft_logo').attr('src', r.base64Image)
            $('.nft_loading').hide()
            $('.nft_logo').show()
        }

        function editTimeVerify() {
                            alert('ä½ å·²è¶…è¿‡æ–‡ç« å¯ç¼–è¾‘çš„æœ€å¤§æ—¶é•¿ï¼Œä¸èƒ½è¿›è¡Œç¼–è¾‘äº†ã€‚å¦‚æœ‰ç–‘é—®è¯·è”ç³»ç®¡ç†å‘˜!')
                    }

    </script>



</body>
</html>
